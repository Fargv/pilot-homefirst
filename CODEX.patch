diff --git a/backend/src/kitchen/models/KitchenShoppingList.js b/backend/src/kitchen/models/KitchenShoppingList.js
index e6334b0f89ba91f1b5ca54b075d3a355bfc74f15..2fbfcbfa7504ac0463bebedad801e0d341a502b9 100644
--- a/backend/src/kitchen/models/KitchenShoppingList.js
+++ b/backend/src/kitchen/models/KitchenShoppingList.js
@@ -1,30 +1,31 @@
 import mongoose from "mongoose";
 
 const ShoppingItemSchema = new mongoose.Schema(
   {
-    ingredientId: { type: mongoose.Schema.Types.ObjectId, ref: "KitchenIngredient", default: null },
+    itemId: { type: mongoose.Schema.Types.ObjectId, default: () => new mongoose.Types.ObjectId() },
+    ingredientId: { type: mongoose.Schema.Types.ObjectId, ref: "KitchenIngredient", default: null },
     categoryId: { type: mongoose.Schema.Types.ObjectId, ref: "Category", default: null },
     displayName: { type: String, required: true, trim: true },
     canonicalName: { type: String, required: true, index: true },
     quantity: { type: Number, default: null },
     unit: { type: String, default: null },
     occurrences: { type: Number, default: 1 },
     fromDishes: { type: [mongoose.Schema.Types.ObjectId], ref: "KitchenDish", default: [] },
     status: { type: String, enum: ["pending", "purchased"], default: "pending" },
     purchasedBy: { type: mongoose.Schema.Types.ObjectId, ref: "KitchenUser", default: null },
     purchasedAt: { type: Date, default: null },
     storeId: { type: mongoose.Schema.Types.ObjectId, ref: "Store", default: null }
   },
   { _id: false }
 );
 
 const KitchenShoppingListSchema = new mongoose.Schema(
   {
     weekStart: { type: Date, required: true },
     householdId: { type: mongoose.Schema.Types.ObjectId, ref: "Household", index: true },
     items: { type: [ShoppingItemSchema], default: [] }
   },
   { timestamps: true }
 );
 
 KitchenShoppingListSchema.index(
diff --git a/backend/src/kitchen/routes/shopping.js b/backend/src/kitchen/routes/shopping.js
index 9950bc9dbd14b3c7739c98b9f3906c396747dee7..6a81210baed9f7571c8469def67b9a660f7f8615 100644
--- a/backend/src/kitchen/routes/shopping.js
+++ b/backend/src/kitchen/routes/shopping.js
@@ -1,566 +1,602 @@
-import express from "express";
-import { Category } from "../models/Category.js";
-import { Store } from "../models/Store.js";
-import { KitchenIngredient } from "../models/KitchenIngredient.js";
-import { KitchenUser } from "../models/KitchenUser.js";
-import { requireAuth, requireDiod } from "../middleware.js";
-import { formatDateISO, getWeekStart, parseISODate } from "../utils/dates.js";
-import {
-  buildScopedFilter,
-  getEffectiveHouseholdId,
-  handleHouseholdError
-} from "../householdScope.js";
-import { ensureShoppingList, rebuildShoppingList, repairShoppingListItems } from "../shoppingService.js";
-import { CATALOG_SCOPES } from "../utils/catalogScopes.js";
-import { normalizeIngredientName } from "../utils/normalize.js";
-import {
-  DEFAULT_CATEGORY_COLOR_BG,
-  DEFAULT_CATEGORY_COLOR_TEXT,
-  DEFAULT_CATEGORY_NAME,
-  DEFAULT_CATEGORY_SLUG,
-  ensureDefaultCategory
-} from "../utils/categoryMatching.js";
-
-const router = express.Router();
-
-function logShoppingError(context, error, extra = {}) {
-  console.error(`[kitchen][shopping] ${context}`, {
-    ...extra,
-    message: error?.message,
-    stack: error?.stack
-  });
-}
-
-
-function normalizeStoreName(value = "") {
-  return String(value).trim().toLowerCase();
-}
-
-function sortStores(stores = []) {
-  return [...stores].sort((a, b) => {
-    const orderA = Number.isFinite(a.order) ? a.order : Number.POSITIVE_INFINITY;
-    const orderB = Number.isFinite(b.order) ? b.order : Number.POSITIVE_INFINITY;
-    if (orderA !== orderB) return orderA - orderB;
-    return String(a.name || "").localeCompare(String(b.name || ""), "es", { sensitivity: "base" });
-  });
-}
-
-function buildStoreVisibilityFilter(effectiveHouseholdId, extraFilter = {}) {
-  return {
-    ...extraFilter,
-    $or: [
-      { scope: "master", householdId: null },
-      { scope: "household", householdId: effectiveHouseholdId }
-    ]
-  };
-}
-
-function buildCategoryVisibilityFilter(effectiveHouseholdId, extraFilter = {}) {
-  return {
-    ...extraFilter,
-    $or: [
-      { scope: CATALOG_SCOPES.MASTER, householdId: null },
-      { scope: CATALOG_SCOPES.HOUSEHOLD, householdId: effectiveHouseholdId },
-      { scope: CATALOG_SCOPES.OVERRIDE, householdId: effectiveHouseholdId }
-    ]
-  };
-}
-
-function toDateGroup(value) {
-  if (!value) return "sin-fecha";
-  return new Date(value).toISOString().slice(0, 10);
-}
-
-function isValidObjectId(value) {
-  return Boolean(value) && /^[a-f\d]{24}$/i.test(String(value));
-}
-
-function compareCategoryGroups(a, b) {
-  const orderA = Number.isFinite(a?.categoryInfo?.order) ? a.categoryInfo.order : Number.POSITIVE_INFINITY;
-  const orderB = Number.isFinite(b?.categoryInfo?.order) ? b.categoryInfo.order : Number.POSITIVE_INFINITY;
-  if (orderA !== orderB) return orderA - orderB;
-  return String(a?.categoryInfo?.name || "").localeCompare(String(b?.categoryInfo?.name || ""), "es", { sensitivity: "base" });
-}
-
-function compareShoppingItems(a, b) {
-  const left = String(a?.canonicalName || a?.displayName || "");
-  const right = String(b?.canonicalName || b?.displayName || "");
-  return left.localeCompare(right, "es", { sensitivity: "base" });
-}
-
-function normalizeShoppingItemForResponse(item, purchaserById) {
-  const normalized = item.toObject ? item.toObject() : { ...item };
-  return {
-    ...normalized,
-    categoryId: normalized.categoryId || null,
-    storeId: normalized.storeId || null,
-    purchasedBy: normalized.purchasedBy || null,
-    purchasedAt: normalized.purchasedAt || null,
-    purchasedByName: normalized.purchasedBy && isValidObjectId(normalized.purchasedBy)
-      ? purchaserById.get(String(normalized.purchasedBy)) || "Usuario"
-      : null
-  };
-}
-
-async function getShoppingPayload(weekStartDate, effectiveHouseholdId) {
-  const list = await ensureShoppingList(weekStartDate, effectiveHouseholdId);
-
-  const fallbackCategory = await ensureDefaultCategory({
-    Category,
-    householdId: effectiveHouseholdId
-  });
-  await repairShoppingListItems(list, effectiveHouseholdId, {
-    fallbackCategory,
-    context: "getShoppingPayload"
-  });
-
-  const categories = await Category.find(buildCategoryVisibilityFilter(effectiveHouseholdId, { isArchived: { $ne: true } })).select(
-    "_id name slug colorBg colorText order"
-  );
-  const stores = sortStores(
-    await Store.find(buildStoreVisibilityFilter(effectiveHouseholdId, { active: true }))
-      .select("_id name order scope householdId")
-      .lean()
-  );
-
-  const storeById = new Map(stores.map((store) => [String(store._id), store.name]));
-  const categoryById = new Map(categories.map((category) => [String(category._id), category]));
-  const purchaserIds = Array.from(new Set(
-    list.items
-      .map((item) => item.purchasedBy)
-      .filter((value) => isValidObjectId(value))
-      .map((value) => String(value))
-  ));
-  const purchasers = purchaserIds.length
-    ? await KitchenUser.find(buildScopedFilter(effectiveHouseholdId, { _id: { $in: purchaserIds } })).select("_id displayName")
-    : [];
-  const purchaserById = new Map(purchasers.map((person) => [String(person._id), person.displayName]));
-
-  const pendingByCategory = list.items
-    .filter((item) => item.status === "pending")
-    .reduce((acc, item) => {
-      const key = item.categoryId ? String(item.categoryId) : "uncategorized";
-      const resolvedCategory = item.categoryId
-        ? categoryById.get(String(item.categoryId)) || null
-        : fallbackCategory || null;
-
-      if (!acc.has(key)) {
-        acc.set(key, {
-          categoryId: resolvedCategory?._id || item.categoryId || null,
-          categoryInfo: {
-            name: resolvedCategory?.name || DEFAULT_CATEGORY_NAME,
-            slug: resolvedCategory?.slug || DEFAULT_CATEGORY_SLUG,
-            colorBg: resolvedCategory?.colorBg || DEFAULT_CATEGORY_COLOR_BG,
-            colorText: resolvedCategory?.colorText || DEFAULT_CATEGORY_COLOR_TEXT,
-            order: Number.isFinite(resolvedCategory?.order) ? resolvedCategory.order : null
-          },
-          items: []
-        });
-      }
-      acc.get(key).items.push(normalizeShoppingItemForResponse(item, purchaserById));
-      return acc;
-    }, new Map());
-
-  const purchasedByStoreDay = list.items
-    .filter((item) => item.status === "purchased")
-    .reduce((acc, item) => {
-      const dateKey = toDateGroup(item.purchasedAt);
-      const storeKey = item.storeId ? String(item.storeId) : "no-store";
-      const key = `${dateKey}::${storeKey}`;
-      if (!acc.has(key)) {
-        const purchasedByName = item.purchasedBy && isValidObjectId(item.purchasedBy)
-          ? purchaserById.get(String(item.purchasedBy)) || "Usuario"
-          : "Usuario";
-        acc.set(key, {
-          storeId: item.storeId || null,
-          storeName: item.storeId ? storeById.get(String(item.storeId)) || "Supermercado no definido" : "Supermercado no definido",
-          purchasedDate: dateKey,
-          startedAt: item.purchasedAt,
-          purchasedByName,
-          items: []
-        });
-      }
-      acc.get(key).items.push(normalizeShoppingItemForResponse(item, purchaserById));
-      return acc;
-    }, new Map());
-
-  return {
-    list,
-    stores,
-    pendingByCategory: Array.from(pendingByCategory.values())
-      .map((group) => ({
-        ...group,
-        items: [...group.items].sort(compareShoppingItems)
-      }))
-      .sort(compareCategoryGroups),
-    purchasedByStoreDay: Array.from(purchasedByStoreDay.values()).sort(
-      (a, b) => new Date(b.startedAt || 0).getTime() - new Date(a.startedAt || 0).getTime()
-    ).map((group) => ({
-      ...group,
-      items: [...group.items].sort(compareShoppingItems)
-    }))
-  };
-}
-
-async function validateStoreSelection(storeId, effectiveHouseholdId) {
-  if (!storeId) return null;
-  const store = await Store.findOne(buildStoreVisibilityFilter(effectiveHouseholdId, { _id: storeId, active: true }))
-    .select("_id")
-    .lean();
-  return store ? store._id : null;
-}
-
-router.get("/:weekStart", requireAuth, async (req, res) => {
-  try {
-    const weekStart = parseISODate(req.params.weekStart);
-    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
-
-    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
-    const monday = getWeekStart(weekStart);
-    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
-
-    res.json({ ok: true, weekStart: formatDateISO(monday), ...payload });
-  } catch (error) {
-    const handled = handleHouseholdError(res, error);
-    if (handled) return handled;
-    logShoppingError("get-list", error, { weekStart: req.params.weekStart, userId: String(req.kitchenUser?._id || "") });
-    return res.status(500).json({ ok: false, error: "No se pudo cargar la lista de compra." });
-  }
-});
-
-router.post("/:weekStart/rebuild", requireAuth, async (req, res) => {
-  try {
-    const weekStart = parseISODate(req.params.weekStart);
-    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
-
-    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
-    const monday = getWeekStart(weekStart);
-    await rebuildShoppingList(monday, effectiveHouseholdId);
-    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
-
-    res.json({ ok: true, ...payload });
-  } catch (error) {
-    const handled = handleHouseholdError(res, error);
-    if (handled) return handled;
-    logShoppingError("rebuild", error, { weekStart: req.params.weekStart, userId: String(req.kitchenUser?._id || "") });
-    if (error?.name === "ValidationError" || error?.name === "CastError") {
-      return res.status(400).json({ ok: false, error: "Datos inválidos al reconstruir la lista." });
-    }
-    return res.status(500).json({ ok: false, error: "No se pudo reconstruir la lista de compra." });
-  }
-});
-
-
-router.post("/:weekStart/items/manual", requireAuth, async (req, res) => {
-  try {
-    const weekStart = parseISODate(req.params.weekStart);
-    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
-
-    const { ingredientId, categoryId, storeId, occurrences } = req.body || {};
-    if (!ingredientId || !categoryId) {
-      return res.status(400).json({ ok: false, error: "Debes indicar ingrediente y categoría." });
-    }
-
-    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
-    const monday = getWeekStart(weekStart);
-    const list = await ensureShoppingList(monday, effectiveHouseholdId);
-
-    const ingredient = await KitchenIngredient.findOne({
-      _id: ingredientId,
-      isArchived: { $ne: true },
-      active: true,
-      $or: [
-        { scope: CATALOG_SCOPES.MASTER, householdId: null },
-        { scope: CATALOG_SCOPES.HOUSEHOLD, householdId: effectiveHouseholdId },
-        { scope: CATALOG_SCOPES.OVERRIDE, householdId: effectiveHouseholdId }
-      ]
-    }).select("_id name canonicalName categoryId");
-
-    if (!ingredient) {
-      return res.status(404).json({ ok: false, error: "Ingrediente no encontrado." });
-    }
-
-    const category = await Category.findOne(buildCategoryVisibilityFilter(effectiveHouseholdId, {
-      _id: categoryId,
-      active: true,
-      isArchived: { $ne: true }
-    })).select("_id");
-
-    if (!category) {
-      return res.status(404).json({ ok: false, error: "Categoría no encontrada." });
-    }
-
-    list.items.push({
-      ingredientId: ingredient._id,
-      categoryId: category._id,
-      displayName: ingredient.name,
-      canonicalName: normalizeIngredientName(ingredient.canonicalName || ingredient.name),
-      occurrences: Number.isFinite(Number(occurrences)) && Number(occurrences) > 0 ? Number(occurrences) : 1,
-      status: "pending",
-      storeId: await validateStoreSelection(storeId, effectiveHouseholdId),
-      fromDishes: []
-    });
-
-    await list.save();
-
-    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
-    return res.status(201).json({ ok: true, ...payload });
-  } catch (error) {
-    const handled = handleHouseholdError(res, error);
-    if (handled) return handled;
-    return res.status(500).json({ ok: false, error: "No se pudo añadir el item manual." });
-  }
-});
-
-router.put("/:weekStart/item", requireAuth, async (req, res) => {
-  try {
-    const weekStart = parseISODate(req.params.weekStart);
-    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
-
-    const { canonicalName, status, ingredientId, storeId } = req.body;
-    if (!canonicalName && !ingredientId) {
-      return res.status(400).json({ ok: false, error: "Ingrediente inválido." });
-    }
-
-    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
-    const monday = getWeekStart(weekStart);
-    const list = await ensureShoppingList(monday, effectiveHouseholdId);
-    await repairShoppingListItems(list, effectiveHouseholdId, {
-      context: "update-item"
-    });
-
-    const item = list.items.find((current) => {
-      if (ingredientId && current.ingredientId) return String(current.ingredientId) === String(ingredientId);
-      return current.canonicalName === canonicalName;
-    });
-
-    if (!item) return res.status(404).json({ ok: false, error: "Ingrediente no encontrado en la lista." });
-
-    const normalizedStatus = status === "purchased" ? "purchased" : "pending";
-    item.status = normalizedStatus;
-    if (normalizedStatus === "purchased") {
-      const validatedStoreId = await validateStoreSelection(storeId, effectiveHouseholdId);
-      item.purchasedBy = req.kitchenUser._id;
-      item.purchasedAt = new Date();
-      item.storeId = validatedStoreId;
-    } else {
-      item.purchasedBy = null;
-      item.purchasedAt = null;
-      item.storeId = null;
-    }
-
-    await list.save();
-    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
-    res.json({ ok: true, ...payload });
-  } catch (error) {
-    const handled = handleHouseholdError(res, error);
-    if (handled) return handled;
-    return res.status(500).json({ ok: false, error: "No se pudo actualizar la lista de compra." });
-  }
-});
-
-router.put("/:weekStart/item/store", requireAuth, async (req, res) => {
-  try {
-    const weekStart = parseISODate(req.params.weekStart);
-    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
-
-    const { canonicalName, ingredientId, storeId } = req.body;
-    if (!canonicalName && !ingredientId) {
-      return res.status(400).json({ ok: false, error: "Ingrediente inválido." });
-    }
-
-    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
-    const monday = getWeekStart(weekStart);
-    const list = await ensureShoppingList(monday, effectiveHouseholdId);
-    await repairShoppingListItems(list, effectiveHouseholdId, {
-      context: "update-item-store"
-    });
-
-    const item = list.items.find((current) => {
-      if (ingredientId && current.ingredientId) return String(current.ingredientId) === String(ingredientId);
-      return current.canonicalName === canonicalName;
-    });
-
-    if (!item || item.status !== "purchased") {
-      return res.status(404).json({ ok: false, error: "Ingrediente comprado no encontrado." });
-    }
-
-    item.storeId = await validateStoreSelection(storeId, effectiveHouseholdId);
-    await list.save();
-
-    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
-    return res.json({ ok: true, ...payload });
-  } catch (error) {
-    const handled = handleHouseholdError(res, error);
-    if (handled) return handled;
-    return res.status(500).json({ ok: false, error: "No se pudo actualizar el supermercado." });
-  }
-});
-
-router.put("/:weekStart/items/status", requireAuth, async (req, res) => {
-  try {
-    const weekStart = parseISODate(req.params.weekStart);
-    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
-
-    const normalizedStatus = req.body?.status === "purchased" ? "purchased" : req.body?.status === "pending" ? "pending" : null;
-    if (!normalizedStatus) {
-      return res.status(400).json({ ok: false, error: "Estado inválido." });
-    }
-
-    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
-    const monday = getWeekStart(weekStart);
-    const list = await ensureShoppingList(monday, effectiveHouseholdId);
-    await repairShoppingListItems(list, effectiveHouseholdId, {
-      context: "bulk-update-status"
-    });
-
-    let changed = false;
-    if (normalizedStatus === "purchased") {
-      const validatedStoreId = await validateStoreSelection(req.body?.storeId, effectiveHouseholdId);
-      const now = new Date();
-      for (const item of list.items) {
-        if (item.status !== "pending") continue;
-        item.status = "purchased";
-        item.purchasedBy = req.kitchenUser._id;
-        item.purchasedAt = now;
-        item.storeId = validatedStoreId;
-        changed = true;
-      }
-    } else {
-      for (const item of list.items) {
-        if (item.status !== "purchased") continue;
-        item.status = "pending";
-        item.purchasedBy = null;
-        item.purchasedAt = null;
-        item.storeId = null;
-        changed = true;
-      }
-    }
-
-    if (changed) {
-      await list.save();
-    }
-
-    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
-    return res.json({ ok: true, updated: changed, ...payload });
-  } catch (error) {
-    const handled = handleHouseholdError(res, error);
-    if (handled) return handled;
-    return res.status(500).json({ ok: false, error: "No se pudo actualizar el estado en bloque." });
-  }
-});
-
-router.post("/:weekStart/purchased/assign-store", requireAuth, async (req, res) => {
-  try {
-    const weekStart = parseISODate(req.params.weekStart);
-    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
-
-    const { storeId } = req.body;
-    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
-    const monday = getWeekStart(weekStart);
-    const list = await ensureShoppingList(monday, effectiveHouseholdId);
-    await repairShoppingListItems(list, effectiveHouseholdId, {
-      context: "assign-store"
-    });
-    const validatedStoreId = await validateStoreSelection(storeId, effectiveHouseholdId);
-
-    const today = new Date().toISOString().slice(0, 10);
-    let changed = false;
-    for (const item of list.items) {
-      if (item.status !== "purchased" || item.storeId || !item.purchasedAt) continue;
-      if (toDateGroup(item.purchasedAt) !== today) continue;
-      item.storeId = validatedStoreId;
-      changed = true;
-    }
-
-    if (changed) await list.save();
-
-    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
-    return res.json({ ok: true, updated: changed, ...payload });
-  } catch (error) {
-    const handled = handleHouseholdError(res, error);
-    if (handled) return handled;
-    return res.status(500).json({ ok: false, error: "No se pudo asignar el supermercado." });
-  }
-});
-
-router.post("/stores", requireAuth, async (req, res) => {
-  try {
-    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
-    const name = String(req.body?.name || "").trim();
-    if (!name) return res.status(400).json({ ok: false, error: "Debes indicar un nombre." });
-    const canonicalName = normalizeStoreName(name);
-
-    const store = await Store.findOneAndUpdate(
-      { scope: "household", householdId: effectiveHouseholdId, canonicalName },
-      { $setOnInsert: { scope: "household", householdId: effectiveHouseholdId, name, canonicalName } },
-      { new: true, upsert: true }
-    );
-
-    return res.status(201).json({ ok: true, store });
-  } catch (error) {
-    const handled = handleHouseholdError(res, error);
-    if (handled) return handled;
-    return res.status(500).json({ ok: false, error: "No se pudo crear la tienda." });
-  }
-});
-
-router.get("/stores/master", requireAuth, requireDiod, async (req, res) => {
-  const stores = sortStores(
-    await Store.find({ scope: "master", householdId: null }).select("_id name canonicalName active order scope")
-  );
-  return res.json({ ok: true, stores });
-});
-
-router.post("/stores/master", requireAuth, requireDiod, async (req, res) => {
-  const name = String(req.body?.name || "").trim();
-  if (!name) return res.status(400).json({ ok: false, error: "Debes indicar un nombre." });
-  const canonicalName = normalizeStoreName(name);
-  const requestedOrder = Number(req.body?.order);
-
-  const store = await Store.findOneAndUpdate(
-    { scope: "master", householdId: null, canonicalName },
-    {
-      $set: {
-        name,
-        canonicalName,
-        active: req.body?.active !== false,
-        order: Number.isFinite(requestedOrder) ? requestedOrder : null,
-        scope: "master",
-        householdId: null
-      }
-    },
-    { new: true, upsert: true }
-  );
-  return res.status(201).json({ ok: true, store });
-});
-
-router.put("/stores/master/:storeId", requireAuth, requireDiod, async (req, res) => {
-  const store = await Store.findOne({ _id: req.params.storeId, scope: "master", householdId: null });
-  if (!store) return res.status(404).json({ ok: false, error: "Supermercado no encontrado." });
-
-  if (req.body?.name !== undefined) {
-    const name = String(req.body.name || "").trim();
-    if (!name) return res.status(400).json({ ok: false, error: "Nombre inválido." });
-    store.name = name;
-    store.canonicalName = normalizeStoreName(name);
-  }
-  if (req.body?.active !== undefined) store.active = Boolean(req.body.active);
-  if (req.body?.order !== undefined) {
-    const requestedOrder = Number(req.body.order);
-    store.order = Number.isFinite(requestedOrder) ? requestedOrder : null;
-  }
-
-  await store.save();
-  return res.json({ ok: true, store });
-});
-
-router.delete("/stores/master/:storeId", requireAuth, requireDiod, async (req, res) => {
-  const store = await Store.findOne({ _id: req.params.storeId, scope: "master", householdId: null });
-  if (!store) return res.status(404).json({ ok: false, error: "Supermercado no encontrado." });
-  store.active = false;
-  await store.save();
-  return res.json({ ok: true, store });
-});
-
-export default router;
+import express from "express";
+import { Category } from "../models/Category.js";
+import { Store } from "../models/Store.js";
+import { KitchenIngredient } from "../models/KitchenIngredient.js";
+import { KitchenUser } from "../models/KitchenUser.js";
+import { requireAuth, requireDiod } from "../middleware.js";
+import { formatDateISO, getWeekStart, parseISODate } from "../utils/dates.js";
+import {
+  buildScopedFilter,
+  getEffectiveHouseholdId,
+  handleHouseholdError
+} from "../householdScope.js";
+import { ensureShoppingList, rebuildShoppingList, repairShoppingListItems } from "../shoppingService.js";
+import { CATALOG_SCOPES } from "../utils/catalogScopes.js";
+import { normalizeIngredientName } from "../utils/normalize.js";
+import {
+  DEFAULT_CATEGORY_COLOR_BG,
+  DEFAULT_CATEGORY_COLOR_TEXT,
+  DEFAULT_CATEGORY_NAME,
+  DEFAULT_CATEGORY_SLUG,
+  ensureDefaultCategory
+} from "../utils/categoryMatching.js";
+
+const router = express.Router();
+
+function logShoppingError(context, error, extra = {}) {
+  console.error(`[kitchen][shopping] ${context}`, {
+    ...extra,
+    message: error?.message,
+    stack: error?.stack
+  });
+}
+
+
+function normalizeStoreName(value = "") {
+  return String(value).trim().toLowerCase();
+}
+
+function sortStores(stores = []) {
+  return [...stores].sort((a, b) => {
+    const orderA = Number.isFinite(a.order) ? a.order : Number.POSITIVE_INFINITY;
+    const orderB = Number.isFinite(b.order) ? b.order : Number.POSITIVE_INFINITY;
+    if (orderA !== orderB) return orderA - orderB;
+    return String(a.name || "").localeCompare(String(b.name || ""), "es", { sensitivity: "base" });
+  });
+}
+
+function buildStoreVisibilityFilter(effectiveHouseholdId, extraFilter = {}) {
+  return {
+    ...extraFilter,
+    $or: [
+      { scope: "master", householdId: null },
+      { scope: "household", householdId: effectiveHouseholdId }
+    ]
+  };
+}
+
+function buildCategoryVisibilityFilter(effectiveHouseholdId, extraFilter = {}) {
+  return {
+    ...extraFilter,
+    $or: [
+      { scope: CATALOG_SCOPES.MASTER, householdId: null },
+      { scope: CATALOG_SCOPES.HOUSEHOLD, householdId: effectiveHouseholdId },
+      { scope: CATALOG_SCOPES.OVERRIDE, householdId: effectiveHouseholdId }
+    ]
+  };
+}
+
+function toDateGroup(value) {
+  if (!value) return "sin-fecha";
+  return new Date(value).toISOString().slice(0, 10);
+}
+
+function isValidObjectId(value) {
+  return Boolean(value) && /^[a-f\d]{24}$/i.test(String(value));
+}
+
+function compareCategoryGroups(a, b) {
+  const orderA = Number.isFinite(a?.categoryInfo?.order) ? a.categoryInfo.order : Number.POSITIVE_INFINITY;
+  const orderB = Number.isFinite(b?.categoryInfo?.order) ? b.categoryInfo.order : Number.POSITIVE_INFINITY;
+  if (orderA !== orderB) return orderA - orderB;
+  return String(a?.categoryInfo?.name || "").localeCompare(String(b?.categoryInfo?.name || ""), "es", { sensitivity: "base" });
+}
+
+function normalizeShoppingItemForResponse(item, purchaserById) {
+  const normalized = item.toObject ? item.toObject() : { ...item };
+  return {
+    ...normalized,
+    itemId: normalized.itemId || normalized._id || null,
+    categoryId: normalized.categoryId || null,
+    storeId: normalized.storeId || null,
+    purchasedBy: normalized.purchasedBy || null,
+    purchasedAt: normalized.purchasedAt || null,
+    purchasedByName: normalized.purchasedBy && isValidObjectId(normalized.purchasedBy)
+      ? purchaserById.get(String(normalized.purchasedBy)) || "Usuario"
+      : null
+  };
+}
+
+async function getShoppingPayload(weekStartDate, effectiveHouseholdId) {
+  const list = await ensureShoppingList(weekStartDate, effectiveHouseholdId);
+
+  const fallbackCategory = await ensureDefaultCategory({
+    Category,
+    householdId: effectiveHouseholdId
+  });
+  await repairShoppingListItems(list, effectiveHouseholdId, {
+    fallbackCategory,
+    context: "getShoppingPayload"
+  });
+
+  const categories = await Category.find(buildCategoryVisibilityFilter(effectiveHouseholdId, { isArchived: { $ne: true } })).select(
+    "_id name slug colorBg colorText order"
+  );
+  const stores = sortStores(
+    await Store.find(buildStoreVisibilityFilter(effectiveHouseholdId, { active: true }))
+      .select("_id name order scope householdId")
+      .lean()
+  );
+
+  const storeById = new Map(stores.map((store) => [String(store._id), store.name]));
+  const categoryById = new Map(categories.map((category) => [String(category._id), category]));
+  const purchaserIds = Array.from(new Set(
+    list.items
+      .map((item) => item.purchasedBy)
+      .filter((value) => isValidObjectId(value))
+      .map((value) => String(value))
+  ));
+  const purchasers = purchaserIds.length
+    ? await KitchenUser.find(buildScopedFilter(effectiveHouseholdId, { _id: { $in: purchaserIds } })).select("_id displayName")
+    : [];
+  const purchaserById = new Map(purchasers.map((person) => [String(person._id), person.displayName]));
+
+  const pendingByCategory = list.items
+    .filter((item) => item.status === "pending")
+    .reduce((acc, item) => {
+      const key = item.categoryId ? String(item.categoryId) : "uncategorized";
+      const resolvedCategory = item.categoryId
+        ? categoryById.get(String(item.categoryId)) || null
+        : fallbackCategory || null;
+
+      if (!acc.has(key)) {
+        acc.set(key, {
+          categoryId: resolvedCategory?._id || item.categoryId || null,
+          categoryInfo: {
+            name: resolvedCategory?.name || DEFAULT_CATEGORY_NAME,
+            slug: resolvedCategory?.slug || DEFAULT_CATEGORY_SLUG,
+            colorBg: resolvedCategory?.colorBg || DEFAULT_CATEGORY_COLOR_BG,
+            colorText: resolvedCategory?.colorText || DEFAULT_CATEGORY_COLOR_TEXT,
+            order: Number.isFinite(resolvedCategory?.order) ? resolvedCategory.order : null
+          },
+          items: []
+        });
+      }
+      acc.get(key).items.push(normalizeShoppingItemForResponse(item, purchaserById));
+      return acc;
+    }, new Map());
+
+  const purchasedByStoreDay = list.items
+    .filter((item) => item.status === "purchased")
+    .reduce((acc, item) => {
+      const dateKey = toDateGroup(item.purchasedAt);
+      const storeKey = item.storeId ? String(item.storeId) : "no-store";
+      const key = `${dateKey}::${storeKey}`;
+      if (!acc.has(key)) {
+        const purchasedByName = item.purchasedBy && isValidObjectId(item.purchasedBy)
+          ? purchaserById.get(String(item.purchasedBy)) || "Usuario"
+          : "Usuario";
+        acc.set(key, {
+          storeId: item.storeId || null,
+          storeName: item.storeId ? storeById.get(String(item.storeId)) || "Supermercado no definido" : "Supermercado no definido",
+          purchasedDate: dateKey,
+          startedAt: item.purchasedAt,
+          purchasedByName,
+          items: []
+        });
+      }
+      acc.get(key).items.push(normalizeShoppingItemForResponse(item, purchaserById));
+      return acc;
+    }, new Map());
+
+  return {
+    list,
+    stores,
+    pendingByCategory: Array.from(pendingByCategory.values())
+      .sort(compareCategoryGroups),
+    purchasedByStoreDay: Array.from(purchasedByStoreDay.values()).sort(
+      (a, b) => new Date(b.startedAt || 0).getTime() - new Date(a.startedAt || 0).getTime()
+    ).map((group) => ({
+      ...group
+    }))
+  };
+}
+
+async function validateStoreSelection(storeId, effectiveHouseholdId) {
+  if (!storeId) return null;
+  const store = await Store.findOne(buildStoreVisibilityFilter(effectiveHouseholdId, { _id: storeId, active: true }))
+    .select("_id")
+    .lean();
+  return store ? store._id : null;
+}
+
+router.get("/:weekStart", requireAuth, async (req, res) => {
+  try {
+    const weekStart = parseISODate(req.params.weekStart);
+    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
+
+    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
+    const monday = getWeekStart(weekStart);
+    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
+
+    res.json({ ok: true, weekStart: formatDateISO(monday), ...payload });
+  } catch (error) {
+    const handled = handleHouseholdError(res, error);
+    if (handled) return handled;
+    logShoppingError("get-list", error, { weekStart: req.params.weekStart, userId: String(req.kitchenUser?._id || "") });
+    return res.status(500).json({ ok: false, error: "No se pudo cargar la lista de compra." });
+  }
+});
+
+router.post("/:weekStart/rebuild", requireAuth, async (req, res) => {
+  try {
+    const weekStart = parseISODate(req.params.weekStart);
+    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
+
+    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
+    const monday = getWeekStart(weekStart);
+    await rebuildShoppingList(monday, effectiveHouseholdId);
+    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
+
+    res.json({ ok: true, ...payload });
+  } catch (error) {
+    const handled = handleHouseholdError(res, error);
+    if (handled) return handled;
+    logShoppingError("rebuild", error, { weekStart: req.params.weekStart, userId: String(req.kitchenUser?._id || "") });
+    if (error?.name === "ValidationError" || error?.name === "CastError") {
+      return res.status(400).json({ ok: false, error: "Datos inválidos al reconstruir la lista." });
+    }
+    return res.status(500).json({ ok: false, error: "No se pudo reconstruir la lista de compra." });
+  }
+});
+
+
+async function addShoppingItem(req, res) {
+  try {
+    const weekStart = parseISODate(req.params.weekStart);
+    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
+
+    const { ingredientId, categoryId, storeId, occurrences } = req.body || {};
+    if (!ingredientId) {
+      return res.status(400).json({ ok: false, error: "Debes indicar ingrediente." });
+    }
+
+    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
+    const monday = getWeekStart(weekStart);
+    const list = await ensureShoppingList(monday, effectiveHouseholdId);
+
+    const ingredient = await KitchenIngredient.findOne({
+      _id: ingredientId,
+      isArchived: { $ne: true },
+      active: true,
+      $or: [
+        { scope: CATALOG_SCOPES.MASTER, householdId: null },
+        { scope: CATALOG_SCOPES.HOUSEHOLD, householdId: effectiveHouseholdId },
+        { scope: CATALOG_SCOPES.OVERRIDE, householdId: effectiveHouseholdId }
+      ]
+    }).select("_id name canonicalName categoryId");
+
+    if (!ingredient) {
+      return res.status(404).json({ ok: false, error: "Ingrediente no encontrado." });
+    }
+
+    const fallbackCategory = ingredient.categoryId || null;
+    const resolvedCategoryId = categoryId || fallbackCategory;
+    if (!resolvedCategoryId) {
+      return res.status(400).json({ ok: false, error: "Debes indicar una categoría válida." });
+    }
+
+    const category = await Category.findOne(buildCategoryVisibilityFilter(effectiveHouseholdId, {
+      _id: resolvedCategoryId,
+      active: true,
+      isArchived: { $ne: true }
+    })).select("_id");
+
+    if (!category) {
+      return res.status(404).json({ ok: false, error: "Categoría no encontrada." });
+    }
+
+    const normalizedCanonicalName = normalizeIngredientName(ingredient.canonicalName || ingredient.name);
+    const existingItem = list.items.find((current) =>
+      current.status === "pending" && current.ingredientId && String(current.ingredientId) === String(ingredient._id)
+    );
+
+    if (existingItem) {
+      const increment = Number.isFinite(Number(occurrences)) && Number(occurrences) > 0 ? Number(occurrences) : 1;
+      existingItem.occurrences = Math.max(1, Number(existingItem.occurrences || 1) + increment);
+      existingItem.categoryId = existingItem.categoryId || category._id;
+    } else {
+      list.items.push({
+        ingredientId: ingredient._id,
+        categoryId: category._id,
+        displayName: ingredient.name,
+        canonicalName: normalizedCanonicalName,
+        occurrences: Number.isFinite(Number(occurrences)) && Number(occurrences) > 0 ? Number(occurrences) : 1,
+        status: "pending",
+        storeId: await validateStoreSelection(storeId, effectiveHouseholdId),
+        fromDishes: []
+      });
+    }
+
+    await list.save();
+
+    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
+    return res.status(201).json({ ok: true, ...payload });
+  } catch (error) {
+    const handled = handleHouseholdError(res, error);
+    if (handled) return handled;
+    return res.status(500).json({ ok: false, error: "No se pudo añadir el item manual." });
+  }
+}
+
+router.post("/:weekStart/items", requireAuth, addShoppingItem);
+router.post("/:weekStart/items/manual", requireAuth, addShoppingItem);
+
+router.delete("/:weekStart/items/:itemId", requireAuth, async (req, res) => {
+  try {
+    const weekStart = parseISODate(req.params.weekStart);
+    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
+
+    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
+    const monday = getWeekStart(weekStart);
+    const list = await ensureShoppingList(monday, effectiveHouseholdId);
+
+    const previousLength = list.items.length;
+    list.items = list.items.filter((item) => String(item.itemId || item._id || "") !== String(req.params.itemId));
+
+    if (list.items.length === previousLength) {
+      return res.status(404).json({ ok: false, error: "Item no encontrado en la lista." });
+    }
+
+    await list.save();
+    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
+    return res.json({ ok: true, ...payload });
+  } catch (error) {
+    const handled = handleHouseholdError(res, error);
+    if (handled) return handled;
+    return res.status(500).json({ ok: false, error: "No se pudo eliminar el item." });
+  }
+});
+
+router.put("/:weekStart/item", requireAuth, async (req, res) => {
+  try {
+    const weekStart = parseISODate(req.params.weekStart);
+    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
+
+    const { canonicalName, status, ingredientId, storeId } = req.body;
+    if (!canonicalName && !ingredientId) {
+      return res.status(400).json({ ok: false, error: "Ingrediente inválido." });
+    }
+
+    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
+    const monday = getWeekStart(weekStart);
+    const list = await ensureShoppingList(monday, effectiveHouseholdId);
+    await repairShoppingListItems(list, effectiveHouseholdId, {
+      context: "update-item"
+    });
+
+    const item = list.items.find((current) => {
+      if (ingredientId && current.ingredientId) return String(current.ingredientId) === String(ingredientId);
+      return current.canonicalName === canonicalName;
+    });
+
+    if (!item) return res.status(404).json({ ok: false, error: "Ingrediente no encontrado en la lista." });
+
+    const normalizedStatus = status === "purchased" ? "purchased" : "pending";
+    item.status = normalizedStatus;
+    if (normalizedStatus === "purchased") {
+      const validatedStoreId = await validateStoreSelection(storeId, effectiveHouseholdId);
+      item.purchasedBy = req.kitchenUser._id;
+      item.purchasedAt = new Date();
+      item.storeId = validatedStoreId;
+    } else {
+      item.purchasedBy = null;
+      item.purchasedAt = null;
+      item.storeId = null;
+    }
+
+    await list.save();
+    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
+    res.json({ ok: true, ...payload });
+  } catch (error) {
+    const handled = handleHouseholdError(res, error);
+    if (handled) return handled;
+    return res.status(500).json({ ok: false, error: "No se pudo actualizar la lista de compra." });
+  }
+});
+
+router.put("/:weekStart/item/store", requireAuth, async (req, res) => {
+  try {
+    const weekStart = parseISODate(req.params.weekStart);
+    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
+
+    const { canonicalName, ingredientId, storeId } = req.body;
+    if (!canonicalName && !ingredientId) {
+      return res.status(400).json({ ok: false, error: "Ingrediente inválido." });
+    }
+
+    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
+    const monday = getWeekStart(weekStart);
+    const list = await ensureShoppingList(monday, effectiveHouseholdId);
+    await repairShoppingListItems(list, effectiveHouseholdId, {
+      context: "update-item-store"
+    });
+
+    const item = list.items.find((current) => {
+      if (ingredientId && current.ingredientId) return String(current.ingredientId) === String(ingredientId);
+      return current.canonicalName === canonicalName;
+    });
+
+    if (!item || item.status !== "purchased") {
+      return res.status(404).json({ ok: false, error: "Ingrediente comprado no encontrado." });
+    }
+
+    item.storeId = await validateStoreSelection(storeId, effectiveHouseholdId);
+    await list.save();
+
+    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
+    return res.json({ ok: true, ...payload });
+  } catch (error) {
+    const handled = handleHouseholdError(res, error);
+    if (handled) return handled;
+    return res.status(500).json({ ok: false, error: "No se pudo actualizar el supermercado." });
+  }
+});
+
+router.put("/:weekStart/items/status", requireAuth, async (req, res) => {
+  try {
+    const weekStart = parseISODate(req.params.weekStart);
+    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
+
+    const normalizedStatus = req.body?.status === "purchased" ? "purchased" : req.body?.status === "pending" ? "pending" : null;
+    if (!normalizedStatus) {
+      return res.status(400).json({ ok: false, error: "Estado inválido." });
+    }
+
+    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
+    const monday = getWeekStart(weekStart);
+    const list = await ensureShoppingList(monday, effectiveHouseholdId);
+    await repairShoppingListItems(list, effectiveHouseholdId, {
+      context: "bulk-update-status"
+    });
+
+    let changed = false;
+    if (normalizedStatus === "purchased") {
+      const validatedStoreId = await validateStoreSelection(req.body?.storeId, effectiveHouseholdId);
+      const now = new Date();
+      for (const item of list.items) {
+        if (item.status !== "pending") continue;
+        item.status = "purchased";
+        item.purchasedBy = req.kitchenUser._id;
+        item.purchasedAt = now;
+        item.storeId = validatedStoreId;
+        changed = true;
+      }
+    } else {
+      for (const item of list.items) {
+        if (item.status !== "purchased") continue;
+        item.status = "pending";
+        item.purchasedBy = null;
+        item.purchasedAt = null;
+        item.storeId = null;
+        changed = true;
+      }
+    }
+
+    if (changed) {
+      await list.save();
+    }
+
+    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
+    return res.json({ ok: true, updated: changed, ...payload });
+  } catch (error) {
+    const handled = handleHouseholdError(res, error);
+    if (handled) return handled;
+    return res.status(500).json({ ok: false, error: "No se pudo actualizar el estado en bloque." });
+  }
+});
+
+router.post("/:weekStart/purchased/assign-store", requireAuth, async (req, res) => {
+  try {
+    const weekStart = parseISODate(req.params.weekStart);
+    if (!weekStart) return res.status(400).json({ ok: false, error: "Fecha inválida." });
+
+    const { storeId } = req.body;
+    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
+    const monday = getWeekStart(weekStart);
+    const list = await ensureShoppingList(monday, effectiveHouseholdId);
+    await repairShoppingListItems(list, effectiveHouseholdId, {
+      context: "assign-store"
+    });
+    const validatedStoreId = await validateStoreSelection(storeId, effectiveHouseholdId);
+
+    const today = new Date().toISOString().slice(0, 10);
+    let changed = false;
+    for (const item of list.items) {
+      if (item.status !== "purchased" || item.storeId || !item.purchasedAt) continue;
+      if (toDateGroup(item.purchasedAt) !== today) continue;
+      item.storeId = validatedStoreId;
+      changed = true;
+    }
+
+    if (changed) await list.save();
+
+    const payload = await getShoppingPayload(monday, effectiveHouseholdId);
+    return res.json({ ok: true, updated: changed, ...payload });
+  } catch (error) {
+    const handled = handleHouseholdError(res, error);
+    if (handled) return handled;
+    return res.status(500).json({ ok: false, error: "No se pudo asignar el supermercado." });
+  }
+});
+
+router.post("/stores", requireAuth, async (req, res) => {
+  try {
+    const effectiveHouseholdId = getEffectiveHouseholdId(req.user);
+    const name = String(req.body?.name || "").trim();
+    if (!name) return res.status(400).json({ ok: false, error: "Debes indicar un nombre." });
+    const canonicalName = normalizeStoreName(name);
+
+    const store = await Store.findOneAndUpdate(
+      { scope: "household", householdId: effectiveHouseholdId, canonicalName },
+      { $setOnInsert: { scope: "household", householdId: effectiveHouseholdId, name, canonicalName } },
+      { new: true, upsert: true }
+    );
+
+    return res.status(201).json({ ok: true, store });
+  } catch (error) {
+    const handled = handleHouseholdError(res, error);
+    if (handled) return handled;
+    return res.status(500).json({ ok: false, error: "No se pudo crear la tienda." });
+  }
+});
+
+router.get("/stores/master", requireAuth, requireDiod, async (req, res) => {
+  const stores = sortStores(
+    await Store.find({ scope: "master", householdId: null }).select("_id name canonicalName active order scope")
+  );
+  return res.json({ ok: true, stores });
+});
+
+router.post("/stores/master", requireAuth, requireDiod, async (req, res) => {
+  const name = String(req.body?.name || "").trim();
+  if (!name) return res.status(400).json({ ok: false, error: "Debes indicar un nombre." });
+  const canonicalName = normalizeStoreName(name);
+  const requestedOrder = Number(req.body?.order);
+
+  const store = await Store.findOneAndUpdate(
+    { scope: "master", householdId: null, canonicalName },
+    {
+      $set: {
+        name,
+        canonicalName,
+        active: req.body?.active !== false,
+        order: Number.isFinite(requestedOrder) ? requestedOrder : null,
+        scope: "master",
+        householdId: null
+      }
+    },
+    { new: true, upsert: true }
+  );
+  return res.status(201).json({ ok: true, store });
+});
+
+router.put("/stores/master/:storeId", requireAuth, requireDiod, async (req, res) => {
+  const store = await Store.findOne({ _id: req.params.storeId, scope: "master", householdId: null });
+  if (!store) return res.status(404).json({ ok: false, error: "Supermercado no encontrado." });
+
+  if (req.body?.name !== undefined) {
+    const name = String(req.body.name || "").trim();
+    if (!name) return res.status(400).json({ ok: false, error: "Nombre inválido." });
+    store.name = name;
+    store.canonicalName = normalizeStoreName(name);
+  }
+  if (req.body?.active !== undefined) store.active = Boolean(req.body.active);
+  if (req.body?.order !== undefined) {
+    const requestedOrder = Number(req.body.order);
+    store.order = Number.isFinite(requestedOrder) ? requestedOrder : null;
+  }
+
+  await store.save();
+  return res.json({ ok: true, store });
+});
+
+router.delete("/stores/master/:storeId", requireAuth, requireDiod, async (req, res) => {
+  const store = await Store.findOne({ _id: req.params.storeId, scope: "master", householdId: null });
+  if (!store) return res.status(404).json({ ok: false, error: "Supermercado no encontrado." });
+  store.active = false;
+  await store.save();
+  return res.json({ ok: true, store });
+});
+
+export default router;
diff --git a/backend/src/kitchen/shoppingService.js b/backend/src/kitchen/shoppingService.js
index 82c2dc1b6ff381a12a553048df9a1c50afd71aac..6b5ffdf10270453930e95026d25163ea172fde6f 100644
--- a/backend/src/kitchen/shoppingService.js
+++ b/backend/src/kitchen/shoppingService.js
@@ -33,64 +33,65 @@ function buildIngredientVisibilityFilter(effectiveHouseholdId, extraFilter = {})
     ]
   };
 }
 
 export async function ensureShoppingList(weekStartDate, effectiveHouseholdId) {
   const existing = await KitchenShoppingList.findOne(
     buildScopedFilter(effectiveHouseholdId, { weekStart: weekStartDate })
   );
   if (existing) return existing;
   return KitchenShoppingList.create({
     weekStart: weekStartDate,
     items: [],
     householdId: effectiveHouseholdId
   });
 }
 
 function deriveCanonicalName(item, fallbackSeed = "") {
   const normalized = normalizeIngredientName(
     item?.canonicalName || item?.displayName || fallbackSeed || ""
   );
   if (normalized) return normalized;
   if (item?.ingredientId) return `item-${String(item.ingredientId).toLowerCase()}`;
   return `item-${fallbackSeed || "sin-nombre"}`;
 }
 
-function ensureValidShoppingItemShape(item, index, fallbackCategoryId = null) {
-  const next = { ...(item || {}) };
+function ensureValidShoppingItemShape(item, index, fallbackCategoryId = null) {
+  const next = { ...(item || {}) };
   const canonicalName = deriveCanonicalName(next, String(index + 1));
   const displayName = String(
     next.displayName || next.name || canonicalName || `Ingrediente ${index + 1}`
   ).trim();
 
-  return {
-    ...next,
-    displayName,
-    canonicalName,
-    categoryId: next.categoryId || fallbackCategoryId || null
-  };
-}
+  return {
+    ...next,
+    itemId: next.itemId || new mongoose.Types.ObjectId(),
+    displayName,
+    canonicalName,
+    categoryId: next.categoryId || fallbackCategoryId || null
+  };
+}
 
 function filterValidShoppingItems(items = [], context = "unknown") {
   const valid = [];
   let filteredCount = 0;
 
   items.forEach((rawItem, index) => {
     const item = rawItem || {};
     if (!item.displayName || !item.canonicalName) {
       filteredCount += 1;
       console.warn("[kitchen][shopping] filtering invalid item before save", {
         context,
         index,
         displayName: item.displayName,
         canonicalName: item.canonicalName,
         ingredientId: item.ingredientId ? String(item.ingredientId) : null
       });
       return;
     }
     valid.push(item);
   });
 
   return { valid, filteredCount };
 }
 
 export async function resolveShoppingItemIngredientData(items, effectiveHouseholdId, options = {}) {
diff --git a/frontend/src/kitchen/kitchen.css b/frontend/src/kitchen/kitchen.css
index 68091a7cf34a28feda8cfa744908ac7d9b3cd97d..512b69a56ff4a2639da6a6e99fa943c6d3f347c8 100644
--- a/frontend/src/kitchen/kitchen.css
+++ b/frontend/src/kitchen/kitchen.css
@@ -1,3183 +1,3256 @@
-*,
-*::before,
-*::after {
-  box-sizing: border-box;
-}
-
-html,
-body {
-  width: 100%;
-  max-width: 100%;
-  height: 100%;
-  margin: 0;
-  overflow-x: hidden;
-}
-
-#root {
-  width: 100%;
-  max-width: 100%;
-  height: 100%;
-  overflow-x: hidden;
-}
-
-@media (pointer: coarse) {
-  html,
-  body {
-    overflow: hidden;
-    overscroll-behavior: none;
-  }
-
-  #root {
-    height: 100dvh;
-    overflow-y: auto;
-    overscroll-behavior: none;
-    -webkit-overflow-scrolling: touch;
-    touch-action: pan-y;
-  }
-}
-
-@media (pointer: fine) {
-  body {
-    overflow-y: auto;
-  }
-
-  #root {
-    min-height: 100%;
-  }
-}
-
-:root {
-  color-scheme: light;
-  --hf-bg: #f8fafc;
-  --hf-bg-gradient: linear-gradient(
-    180deg,
-    rgba(238, 242, 255, 0.72) 0%,
-    rgba(240, 253, 244, 0.5) 42%,
-    rgba(248, 250, 252, 0.96) 100%
-  );
-  --hf-surface: #ffffff;
-  --hf-surface-soft: #eef2ff;
-  --hf-surface-mint: #f0fdf4;
-  --hf-surface-peach: #fff7ed;
-  --hf-text: #1e293b;
-  --hf-muted: #667085;
-  --hf-brand: #4338ca;
-  --hf-brand-strong: #4338ca;
-  --hf-border: #e4e7ec;
-  --hf-danger: #b42318;
-  --hf-radius-md: 24px;
-  --hf-radius-lg: 28px;
-  --hf-radius-xl: 32px;
-  --hf-shadow-soft: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
-  --hf-shadow-glass: 0 10px 30px rgba(31, 41, 55, 0.1);
-  --hf-glass: rgba(255, 255, 255, 0.7);
-  --hf-glass-border: rgba(255, 255, 255, 0.9);
-}
-
-.kitchen-app {
-  font-family: "Inter", system-ui, sans-serif;
-  background-color: var(--hf-bg);
-  background-image: var(--hf-bg-gradient);
-  background-repeat: no-repeat;
-  background-size: 100% 100%;
-  min-height: 100vh;
-  min-height: 100dvh;
-  width: 100%;
-  max-width: 100%;
-  color: var(--hf-text);
-}
-
-@media (min-width: 768px) {
-  :root {
-    --hf-bg-gradient: linear-gradient(
-      180deg,
-      rgba(238, 242, 255, 0.66) 0%,
-      rgba(240, 253, 244, 0.44) 46%,
-      rgba(248, 250, 252, 0.98) 100%
-    );
-  }
-}
-
-@media (min-width: 1200px) {
-  :root {
-    --hf-bg-gradient: linear-gradient(
-      180deg,
-      rgba(238, 242, 255, 0.58) 0%,
-      rgba(240, 253, 244, 0.38) 50%,
-      rgba(248, 250, 252, 1) 100%
-    );
-  }
-}
-
-.kitchen-container {
-  max-width: 1100px;
-  margin: 0 auto;
-  padding: 24px;
-  width: 100%;
-}
-
-.kitchen-bottom-nav {
-  position: fixed;
-  bottom: 0;
-  left: 0;
-  right: 0;
-  background: #ffffff;
-  border-top: 1px solid #e4e7ec;
-  z-index: 25;
-  padding: 10px 12px calc(12px + env(safe-area-inset-bottom, 0px));
-  display: none;
-}
-
-.kitchen-bottom-nav-inner {
-  max-width: 720px;
-  margin: 0 auto;
-  display: grid;
-  grid-template-columns: repeat(4, minmax(0, 1fr));
-  gap: 8px;
-}
-
-.kitchen-bottom-nav-item {
-  display: flex;
-  flex-direction: column;
-  align-items: center;
-  gap: 4px;
-  padding: 8px 6px;
-  border-radius: 14px;
-  text-decoration: none;
-  color: #667085;
-  font-weight: 600;
-  font-size: 12px;
-  line-height: 1.1;
-  transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
-}
-
-.kitchen-bottom-nav-item.active {
-  background: #eef2ff;
-  color: #4338ca;
-}
-
-.kitchen-bottom-nav-item:active {
-  transform: translateY(1px);
-}
-
-.kitchen-bottom-nav-icon {
-  width: 22px;
-  height: 22px;
-  stroke: currentColor;
-  stroke-width: 1.8;
-  fill: none;
-  stroke-linecap: round;
-  stroke-linejoin: round;
-}
-
-.kitchen-bottom-nav-label {
-  font-size: 12px;
-  text-align: center;
-  white-space: nowrap;
-}
-
-.kitchen-topbar {
-  position: sticky;
-  top: 0;
-  z-index: 20;
-  background: white;
-  border-bottom: 1px solid #e4e7ec;
-}
-
-.kitchen-topbar-inner {
-  max-width: 1100px;
-  margin: 0 auto;
-  padding: 16px 24px;
-  display: flex;
-  align-items: center;
-  justify-content: space-between;
-  gap: 16px;
-  min-height: 72px;
-}
-
-.kitchen-brand {
-  display: flex;
-  align-items: center;
-  gap: 12px;
-}
-
-.kitchen-brand-link {
-  display: inline-flex;
-  align-items: center;
-  font-weight: 700;
-  font-size: 20px;
-  color: #101828;
-  text-decoration: none;
-}
-
-.kitchen-brand-icon {
-  width: 30px;
-  height: 30px;
-  object-fit: contain;
-}
-
-.kitchen-brand-logo {
-  display: none;
-  height: 30px;
-  width: auto;
-  object-fit: contain;
-}
-
-.kitchen-nav-desktop,
-.kitchen-nav-mobile {
-  display: flex;
-  gap: 16px;
-}
-
-.kitchen-nav-desktop a,
-.kitchen-nav-mobile a {
-  text-decoration: none;
-  color: #1d2939;
-  font-weight: 600;
-  font-size: 14px;
-  padding: 6px 8px;
-  border-radius: 8px;
-}
-
-.kitchen-nav-desktop a.active,
-.kitchen-nav-mobile a.active {
-  background: #eef2ff;
-  color: #3730a3;
-}
-
-.kitchen-user {
-  display: flex;
-  align-items: center;
-  gap: 10px;
-}
-
-.kitchen-user-name {
-  font-size: 14px;
-  font-weight: 600;
-  color: #1d2939;
-}
-
-.kitchen-logout-button {
-  width: 44px;
-  height: 44px;
-  display: inline-flex;
-  align-items: center;
-  justify-content: center;
-  border-radius: 12px;
-  border: 1px solid transparent;
-  background: transparent;
-  color: #475467;
-  cursor: pointer;
-  transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
-}
-
-.kitchen-logout-button:hover {
-  background: #f2f4f7;
-  color: #111827;
-}
-
-.kitchen-logout-button:focus-visible {
-  outline: 2px solid #6366f1;
-  outline-offset: 2px;
-}
-
-.kitchen-logout-icon {
-  width: 20px;
-  height: 20px;
-  stroke: currentColor;
-  stroke-width: 1.8;
-  fill: none;
-  stroke-linecap: round;
-  stroke-linejoin: round;
-}
-
-.kitchen-user-placeholder {
-  width: 160px;
-  min-height: 40px;
-}
-
-.kitchen-nav-toggle {
-  display: none;
-  flex-direction: column;
-  justify-content: center;
-  gap: 4px;
-  width: 36px;
-  height: 36px;
-  border-radius: 10px;
-  border: 1px solid #d0d5dd;
-  background: white;
-  cursor: pointer;
-  padding: 8px;
-}
-
-.kitchen-nav-toggle span {
-  display: block;
-  height: 2px;
-  background: #1d2939;
-  border-radius: 999px;
-}
-
-.kitchen-drawer-backdrop {
-  position: fixed;
-  inset: 0;
-  background: rgba(16, 24, 40, 0.4);
-  border: none;
-  z-index: 30;
-}
-
-.kitchen-drawer {
-  position: fixed;
-  top: 0;
-  left: 0;
-  width: min(300px, 80vw);
-  height: 100%;
-  background: white;
-  z-index: 31;
-  padding: 20px;
-  display: flex;
-  flex-direction: column;
-  gap: 16px;
-  box-shadow: 0 20px 40px rgba(15, 23, 42, 0.2);
-}
-
-.kitchen-drawer-header {
-  display: flex;
-  align-items: center;
-  justify-content: space-between;
-  font-weight: 600;
-}
-
-.kitchen-drawer-close {
-  border: none;
-  background: transparent;
-  color: #1d2939;
-  font-weight: 600;
-  cursor: pointer;
-}
-
-.kitchen-nav-mobile {
-  flex-direction: column;
-  gap: 8px;
-}
-
-.kitchen-drawer-user {
-  display: flex;
-  flex-direction: column;
-  gap: 12px;
-}
-
-.kitchen-card {
-  background: white;
-  border-radius: 16px;
-  padding: 24px;
-  box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
-  display: flex;
-  flex-direction: column;
-  gap: 16px;
-  box-sizing: border-box;
-  min-width: 0;
-}
-
-.kitchen-grid {
-  display: grid;
-  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
-  gap: 20px;
-  align-items: stretch;
-}
-
-.kitchen-week-carousel {
-  position: relative;
-}
-
-.kitchen-week-days {
-  display: grid;
-  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
-  gap: 20px;
-  align-items: stretch;
-}
-
-.kitchen-week-carousel-arrow {
-  position: absolute;
-  top: 50%;
-  transform: translateY(-50%);
-  border: 1px solid #e2e8f0;
-  background: #fff;
-  color: #1f2937;
-  width: 36px;
-  height: 36px;
-  border-radius: 999px;
-  display: flex;
-  align-items: center;
-  justify-content: center;
-  box-shadow: 0 6px 16px rgba(15, 23, 42, 0.12);
-  cursor: pointer;
-  z-index: 2;
-}
-
-.kitchen-week-carousel-arrow.is-left {
-  left: -6px;
-}
-
-.kitchen-week-carousel-arrow.is-right {
-  right: -6px;
-}
-
-.kitchen-week-carousel-arrow-icon {
-  width: 18px;
-  height: 18px;
-  stroke: currentColor;
-  stroke-width: 2;
-  fill: none;
-}
-
-.kitchen-week-carousel-arrow-icon.is-next {
-  transform: rotate(180deg);
-}
-
-.kitchen-week-carousel-dots {
-  display: none;
-  justify-content: center;
-  gap: 6px;
-  margin-top: 12px;
-}
-
-.kitchen-week-carousel-dot {
-  width: 8px;
-  height: 8px;
-  border-radius: 999px;
-  border: none;
-  padding: 0;
-  background: #d0d5dd;
-}
-
-.kitchen-week-carousel-dot.is-active {
-  background: #6366f1;
-}
-
-.kitchen-dishes-page {
-  display: flex;
-  flex-direction: column;
-  gap: 20px;
-}
-
-.kitchen-dishes-header {
-  display: flex;
-  flex-wrap: wrap;
-  gap: 16px;
-  align-items: center;
-  justify-content: space-between;
-}
-
-.kitchen-dishes-header h2 {
-  margin: 0;
-  font-size: 24px;
-}
-
-.kitchen-dishes-header .kitchen-muted {
-  margin-top: 4px;
-}
-
-.kitchen-dishes-search {
-  display: flex;
-}
-
-.kitchen-dishes-tabs {
-  display: inline-flex;
-  gap: 8px;
-  padding: 6px;
-  border-radius: 12px;
-  background: #f1f5f9;
-  align-self: flex-start;
-}
-
-.kitchen-tab-button {
-  border: none;
-  background: transparent;
-  padding: 8px 16px;
-  border-radius: 10px;
-  font-weight: 600;
-  color: #475569;
-  cursor: pointer;
-  transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
-}
-
-.kitchen-tab-button.is-active {
-  background: white;
-  color: #1e293b;
-  box-shadow: 0 4px 12px rgba(15, 23, 42, 0.12);
-}
-
-.kitchen-tab-button:focus-visible {
-  outline: 3px solid rgba(79, 70, 229, 0.35);
-  outline-offset: 2px;
-}
-
-.kitchen-dishes-grid {
-  display: grid;
-  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
-  gap: 16px;
-}
-
-.kitchen-dish-card {
-  background: white;
-  border-radius: 14px;
-  padding: 16px;
-  box-shadow: 0 6px 20px rgba(15, 23, 42, 0.08);
-  display: flex;
-  align-items: flex-start;
-  justify-content: space-between;
-  gap: 16px;
-  min-height: 96px;
-}
-
-.kitchen-dish-card.is-sidedish {
-  background: #f8fafc;
-  border: 1px solid #e2e8f0;
-}
-
-.kitchen-dish-title-row {
-  display: flex;
-  flex-wrap: wrap;
-  align-items: center;
-  gap: 8px;
-}
-
-.kitchen-dish-name {
-  margin: 0 0 6px;
-  font-size: 16px;
-}
-
-.kitchen-dish-badge {
-  display: inline-flex;
-  align-items: center;
-  padding: 2px 10px;
-  border-radius: 999px;
-  font-size: 11px;
-  font-weight: 600;
-  color: #1d4ed8;
-  background: #dbeafe;
-}
-
-.kitchen-dish-ingredients-text {
-  margin: 0;
-  color: #667085;
-  font-size: 13px;
-  line-height: 1.4;
-  display: -webkit-box;
-  -webkit-line-clamp: 2;
-  -webkit-box-orient: vertical;
-  overflow: hidden;
-}
-
-.kitchen-ingredient-card {
-  gap: 12px;
-}
-
-.kitchen-ingredient-canonical {
-  margin: 6px 0 0;
-  color: #667085;
-  font-size: 13px;
-}
-
-.kitchen-ingredient-tags {
-  display: flex;
-  flex-wrap: wrap;
-  gap: 8px;
-  margin-top: 8px;
-}
-
-.kitchen-ingredient-selected-category {
-  display: flex;
-  align-items: center;
-  gap: 8px;
-  margin-top: 8px;
-}
-
-.kitchen-dish-actions {
-  display: flex;
-  gap: 8px;
-  align-items: center;
-}
-
-.kitchen-icon-button {
-  border: 1px solid #e2e8f0;
-  background: white;
-  width: 44px;
-  height: 44px;
-  border-radius: 12px;
-  display: inline-flex;
-  align-items: center;
-  justify-content: center;
-  color: #344054;
-  cursor: pointer;
-  transition: border 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
-}
-
-.kitchen-icon-button svg {
-  width: 20px;
-  height: 20px;
-}
-
-.kitchen-icon-button:hover {
-  border-color: #c7d2fe;
-  color: #4f46e5;
-  box-shadow: 0 6px 12px rgba(79, 70, 229, 0.15);
-}
-
-.kitchen-icon-button.assign:hover {
-  border-color: #bbf7d0;
-  color: #15803d;
-  box-shadow: 0 6px 12px rgba(21, 128, 61, 0.12);
-}
-
-.kitchen-icon-button.danger:hover {
-  border-color: #fecaca;
-  color: #b42318;
-  box-shadow: 0 6px 12px rgba(180, 35, 24, 0.15);
-}
-
-.kitchen-modal-backdrop {
-  position: fixed;
-  inset: 0;
-  background: rgba(15, 23, 42, 0.4);
-  display: flex;
-  align-items: center;
-  justify-content: center;
-  padding: 20px;
-  z-index: 40;
-}
-
-.kitchen-modal {
-  width: min(640px, 100%);
-  max-height: min(90vh, 780px);
-  background: white;
-  border-radius: 18px;
-  padding: 24px;
-  box-shadow: 0 24px 60px rgba(15, 23, 42, 0.2);
-  display: flex;
-  flex-direction: column;
-  gap: 20px;
-  overflow: hidden;
-}
-
-.kitchen-modal .kitchen-form {
-  overflow-y: auto;
-  padding-right: 4px;
-}
-
-.kitchen-modal-header {
-  display: flex;
-  align-items: flex-start;
-  justify-content: space-between;
-  gap: 12px;
-}
-
-.kitchen-modal-header h3 {
-  margin: 0;
-  font-size: 20px;
-}
-
-.kitchen-modal-actions {
-  display: flex;
-  flex-direction: column;
-  gap: 12px;
-  align-items: center;
-  justify-content: center;
-  padding-top: 4px;
-}
-
-.kitchen-assign-modal .kitchen-modal-header p {
-  margin: 6px 0 0;
-}
-
-.kitchen-assign-body {
-  display: flex;
-  flex-direction: column;
-  gap: 16px;
-}
-
-.kitchen-assign-week-header {
-  display: grid;
-  grid-template-columns: 40px 1fr 40px;
-  align-items: center;
-  gap: 12px;
-  width: 100%;
-}
-
-.kitchen-assign-week-label {
-  text-align: center;
-  font-size: 13px;
-  font-weight: 600;
-  color: #0f172a;
-}
-
-.kitchen-assign-week-nav {
-  border: 1px solid #e2e8f0;
-  background: #ffffff;
-  color: #475569;
-  width: 40px;
-  height: 40px;
-  border-radius: 10px;
-  display: inline-flex;
-  align-items: center;
-  justify-content: center;
-  cursor: pointer;
-  transition: border-color 0.2s ease, background 0.2s ease, color 0.2s ease;
-}
-
-.kitchen-assign-week-nav:disabled {
-  cursor: not-allowed;
-  opacity: 0.45;
-}
-
-.kitchen-assign-week-icon {
-  width: 16px;
-  height: 16px;
-  stroke: currentColor;
-  stroke-width: 2;
-  fill: none;
-  stroke-linecap: round;
-  stroke-linejoin: round;
-}
-
-.kitchen-assign-week-icon.is-next {
-  transform: rotate(180deg);
-}
-
-.kitchen-assign-days {
-  display: grid;
-  grid-template-columns: repeat(7, minmax(0, 1fr));
-  gap: 8px;
-}
-
-.kitchen-assign-day {
-  border: 1px solid #e2e8f0;
-  background: #f8fafc;
-  border-radius: 12px;
-  padding: 10px 6px;
-  display: flex;
-  flex-direction: column;
-  align-items: center;
-  gap: 4px;
-  font-size: 12px;
-  color: #0f172a;
-  cursor: pointer;
-  transition: border-color 0.2s ease, background 0.2s ease, color 0.2s ease;
-}
-
-.kitchen-assign-day.is-selected {
-  border-color: #4f46e5;
-  background: #eef2ff;
-  color: #312e81;
-  box-shadow: 0 8px 16px rgba(79, 70, 229, 0.12);
-}
-
-.kitchen-assign-day.is-occupied {
-  border-color: #cbd5f5;
-}
-
-.kitchen-assign-day:disabled {
-  opacity: 0.45;
-  cursor: not-allowed;
-  background: #f1f5f9;
-}
-
-.kitchen-assign-day-label {
-  font-size: 11px;
-  text-transform: uppercase;
-  letter-spacing: 0.08em;
-}
-
-.kitchen-assign-day-number {
-  font-size: 15px;
-  font-weight: 700;
-}
-
-.kitchen-assign-day-status {
-  font-size: 10px;
-  text-transform: uppercase;
-  letter-spacing: 0.08em;
-  color: #64748b;
-  text-align: center;
-}
-
-.kitchen-assign-day-detail {
-  display: block;
-  font-size: 11px;
-  letter-spacing: normal;
-  text-transform: none;
-  color: #475569;
-}
-
-.kitchen-dishes-loading {
-  font-weight: 600;
-  text-align: center;
-}
-
-.kitchen-button {
-  background: #4f46e5;
-  border: none;
-  color: white;
-  padding: 12px 18px;
-  border-radius: 10px;
-  cursor: pointer;
-  font-weight: 600;
-  font-size: 15px;
-  min-height: 48px;
-  transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
-}
-
-.kitchen-button.is-small {
-  padding: 6px 12px;
-  font-size: 13px;
-  min-height: 32px;
-}
-
-.kitchen-button:hover {
-  background: #4338ca;
-}
-
-.kitchen-button:active {
-  transform: translateY(1px);
-}
-
-.kitchen-button:focus-visible {
-  outline: 3px solid rgba(79, 70, 229, 0.35);
-  outline-offset: 2px;
-}
-
-.kitchen-button.secondary {
-  background: #e2e8f0;
-  color: #0f172a;
-}
-
-.kitchen-button.ghost {
-  background: transparent;
-  border: 1px solid #cbd5f5;
-  color: #1e293b;
-}
-
-.kitchen-input,
-.kitchen-select,
-.kitchen-textarea {
-  width: 100%;
-  padding: 10px 12px;
-  border-radius: 10px;
-  border: 1px solid #d0d5dd;
-  background: white;
-  font-size: 14px;
-  box-sizing: border-box;
-  min-width: 0;
-}
-
-.kitchen-label {
-  display: block;
-  font-weight: 600;
-  margin-bottom: 6px;
-  color: #344054;
-}
-
-.kitchen-field {
-  display: flex;
-  flex-direction: column;
-  gap: 6px;
-}
-
-.kitchen-toggle-field {
-  gap: 0;
-}
-
-.kitchen-toggle-row {
-  display: flex;
-  align-items: center;
-  justify-content: space-between;
-  gap: 12px;
-}
-
-.kitchen-toggle {
-  position: relative;
-  display: inline-flex;
-  align-items: center;
-}
-
-.kitchen-toggle-input {
-  position: absolute;
-  opacity: 0;
-  width: 0;
-  height: 0;
-}
-
-.kitchen-toggle-track {
-  width: 46px;
-  height: 26px;
-  border-radius: 999px;
-  background: #e4e7ec;
-  position: relative;
-  transition: background 0.2s ease;
-}
-
-.kitchen-toggle-track::after {
-  content: "";
-  position: absolute;
-  top: 3px;
-  left: 3px;
-  width: 20px;
-  height: 20px;
-  border-radius: 50%;
-  background: #ffffff;
-  box-shadow: 0 2px 6px rgba(15, 23, 42, 0.2);
-  transition: transform 0.2s ease;
-}
-
-.kitchen-toggle-input:checked + .kitchen-toggle-track {
-  background: #4f46e5;
-}
-
-.kitchen-toggle-input:checked + .kitchen-toggle-track::after {
-  transform: translateX(20px);
-}
-
-.kitchen-toggle-input:focus-visible + .kitchen-toggle-track {
-  outline: 3px solid rgba(79, 70, 229, 0.35);
-  outline-offset: 2px;
-}
-
-.kitchen-pill {
-  display: inline-flex;
-  align-items: center;
-  gap: 6px;
-  padding: 4px 10px;
-  border-radius: 999px;
-  background: #eef2ff;
-  color: #4338ca;
-  font-size: 12px;
-  font-weight: 600;
-}
-
-.kitchen-empty {
-  text-align: center;
-  padding: 32px;
-  color: #475467;
-}
-
-.kitchen-muted {
-  color: #667085;
-  font-size: 14px;
-}
-
-.kitchen-actions {
-  display: flex;
-  flex-direction: column;
-  gap: 12px;
-  margin-top: 20px;
-  width: 100%;
-}
-
-.kitchen-actions-inline {
-  display: flex;
-  gap: 8px;
-  align-items: center;
-}
-
-.kitchen-actions-inline .kitchen-select {
-  flex: 1;
-}
-
-.kitchen-assignee-picker {
-  position: relative;
-  display: flex;
-  flex-direction: column;
-  gap: 6px;
-}
-
-.kitchen-assignee-button {
-  width: 100%;
-  border: 1px solid #d0d5dd;
-  border-radius: 12px;
-  background: #ffffff;
-  padding: 8px 12px;
-  display: inline-flex;
-  align-items: center;
-  gap: 10px;
-  font-size: 14px;
-  font-weight: 600;
-  color: #101828;
-  min-height: 48px;
-  cursor: pointer;
-  transition: border 0.2s ease, box-shadow 0.2s ease;
-}
-
-.kitchen-assignee-button:hover {
-  border-color: #c7d2fe;
-}
-
-.kitchen-assignee-button:focus-visible {
-  outline: 3px solid rgba(79, 70, 229, 0.35);
-  outline-offset: 2px;
-}
-
-.kitchen-assignee-avatar {
-  width: 28px;
-  height: 28px;
-  border-radius: 50%;
-  display: inline-flex;
-  align-items: center;
-  justify-content: center;
-  font-size: 12px;
-  font-weight: 700;
-}
-
-.kitchen-assignee-name {
-  flex: 1;
-  text-align: left;
-}
-
-.kitchen-week-header {
-  display: flex;
-  align-items: flex-start;
-  justify-content: center;
-  gap: 16px;
-  margin-bottom: 20px;
-}
-
-.kitchen-week-header-main {
-  display: flex;
-  flex-direction: column;
-  gap: 4px;
-}
-
-.kitchen-week-header-actions {
-  display: flex;
-  flex-direction: column;
-  gap: 12px;
-  width: min(420px, 100%);
-  align-items: center;
-}
-
-.kitchen-week-mobile-frame {
-  width: 100%;
-  display: flex;
-  flex-direction: column;
-  align-items: stretch;
-}
-
-.kitchen-week-nav {
-  --kitchen-week-nav-control-height: 44px;
-  display: grid;
-  grid-template-columns: var(--kitchen-week-nav-control-height) minmax(0, 1fr) var(--kitchen-week-nav-control-height);
-  align-items: center;
-  gap: 10px;
-  width: 100%;
-  max-width: 420px;
-  margin-inline: auto;
-}
-
-.kitchen-week-picker {
-  width: 100%;
-  display: block;
-  min-width: 0;
-  margin: 0;
-}
-
-.kitchen-week-arrow {
-  display: inline-flex;
-  align-items: center;
-  justify-content: center;
-  width: var(--kitchen-week-nav-control-height);
-  height: var(--kitchen-week-nav-control-height);
-  flex: 0 0 var(--kitchen-week-nav-control-height);
-  border-radius: 14px;
-  border: 1px solid rgba(176, 188, 229, 0.75);
-  background: linear-gradient(180deg, #ffffff 0%, #f4f7ff 100%);
-  color: #344054;
-  box-shadow: 0 8px 16px rgba(88, 100, 167, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.95);
-  cursor: pointer;
-  transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
-}
-
-.kitchen-week-picker .kitchen-input {
-  min-height: var(--kitchen-week-nav-control-height);
-  height: var(--kitchen-week-nav-control-height);
-  line-height: normal;
-  text-align: center;
-  width: 100%;
-  min-width: 0;
-  max-width: 100%;
-  padding-block: 0;
-  box-sizing: border-box;
-  -webkit-appearance: none;
-  appearance: none;
-  overflow: hidden;
-  text-overflow: ellipsis;
-  white-space: nowrap;
-}
-
-.kitchen-week-arrow-icon {
-  width: 18px;
-  height: 18px;
-  stroke: currentColor;
-  stroke-width: 2;
-  fill: none;
-  stroke-linecap: round;
-  stroke-linejoin: round;
-}
-
-.kitchen-week-arrow-icon.is-next {
-  transform: rotate(180deg);
-}
-
-.kitchen-week-arrow:hover {
-  background: linear-gradient(180deg, #ffffff 0%, #eef3ff 100%);
-  border-color: rgba(147, 163, 221, 0.92);
-  color: #1d2939;
-  box-shadow: 0 10px 20px rgba(88, 100, 167, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.95);
-}
-
-.kitchen-week-arrow:focus-visible {
-  outline: 2px solid #6366f1;
-  outline-offset: 2px;
-}
-
-.kitchen-title {
-  margin: 0;
-  font-size: 22px;
-  font-weight: 700;
-  color: #0f172a;
-}
-
-.kitchen-week-subtitle {
-  margin: 0;
-}
-
-.kitchen-weekdays-strip {
-  padding: 20px 22px;
-  border: 1px solid #eaecf0;
-  box-shadow: none;
-  gap: 16px;
-  margin-bottom: 0;
-  width: 100%;
-  box-sizing: border-box;
-  overflow-x: hidden;
-}
-
-.kitchen-week-controls {
-  display: flex;
-  flex-direction: column;
-  gap: 20px;
-  margin-bottom: 24px;
-}
-
-.kitchen-weekdays-carousel {
-  position: relative;
-  display: flex;
-  align-items: center;
-  width: 100%;
-  max-width: 100%;
-  overflow-x: hidden;
-}
-
-.kitchen-weekdays-carousel.is-carousel::before,
-.kitchen-weekdays-carousel.is-carousel::after {
-  content: "";
-  position: absolute;
-  top: 0;
-  bottom: 0;
-  width: 32px;
-  pointer-events: none;
-  z-index: 1;
-}
-
-.kitchen-weekdays-carousel.is-carousel::before {
-  left: 0;
-  background: linear-gradient(90deg, #ffffff 0%, rgba(255, 255, 255, 0) 100%);
-}
-
-.kitchen-weekdays-carousel.is-carousel::after {
-  right: 0;
-  background: linear-gradient(270deg, #ffffff 0%, rgba(255, 255, 255, 0) 100%);
-}
-
-.kitchen-weekdays-arrow {
-  width: 40px;
-  height: 40px;
-  border-radius: 12px;
-  border: 1px solid #e4e7ec;
-  background: #ffffff;
-  color: #344054;
-  display: inline-flex;
-  align-items: center;
-  justify-content: center;
-  cursor: pointer;
-  transition: border-color 0.2s ease, background 0.2s ease;
-  position: absolute;
-  top: 50%;
-  transform: translateY(-50%);
-  z-index: 2;
-}
-
-.kitchen-weekdays-arrow:hover {
-  background: #f8fafc;
-  border-color: #d0d5dd;
-}
-
-.kitchen-weekdays-arrow.is-left {
-  left: -8px;
-}
-
-.kitchen-weekdays-arrow.is-right {
-  right: -8px;
-}
-
-.kitchen-weekdays-arrow-icon {
-  width: 18px;
-  height: 18px;
-  stroke: currentColor;
-  stroke-width: 2;
-  fill: none;
-  stroke-linecap: round;
-  stroke-linejoin: round;
-}
-
-.kitchen-weekdays-arrow-icon.is-next {
-  transform: rotate(180deg);
-}
-
-.kitchen-weekdays-list {
-  display: flex;
-  gap: 12px;
-  align-items: center;
-  justify-content: center;
-  width: 100%;
-  padding-bottom: 4px;
-}
-
-.kitchen-weekdays-list.is-carousel {
-  overflow-x: auto;
-  scroll-snap-type: x mandatory;
-  -webkit-overflow-scrolling: touch;
-  scrollbar-width: none;
-  justify-content: flex-start;
-  padding: 4px 32px;
-  max-width: 100%;
-}
-
-.kitchen-weekdays-list.is-carousel::-webkit-scrollbar {
-  display: none;
-}
-
-.kitchen-weekdays-item {
-  min-width: 64px;
-  min-height: 80px;
-  padding: 8px 6px;
-  border-radius: 14px;
-  border: 1px solid transparent;
-  background: transparent;
-  display: flex;
-  flex-direction: column;
-  align-items: center;
-  gap: 6px;
-  cursor: pointer;
-  scroll-snap-align: center;
-  transition: border-color 0.2s ease, background 0.2s ease, transform 0.2s ease;
-}
-
-.kitchen-weekdays-item:focus-visible {
-  outline: 2px solid #6366f1;
-  outline-offset: 2px;
-}
-
-.kitchen-weekdays-item.is-selected {
-  border-color: #c7d2fe;
-  background: #f8f9ff;
-}
-
-.kitchen-weekdays-circle {
-  width: 52px;
-  height: 52px;
-  border-radius: 999px;
-  display: flex;
-  align-items: center;
-  justify-content: center;
-  font-weight: 700;
-  font-size: 14px;
-  letter-spacing: 0.04em;
-  text-transform: uppercase;
-  background: var(--weekday-bg);
-  color: var(--weekday-text);
-  border: 1px solid var(--weekday-border);
-  box-sizing: border-box;
-}
-
-.kitchen-weekdays-label {
-  font-size: 12px;
-  font-weight: 600;
-  color: #475467;
-  text-transform: uppercase;
-}
-
-.kitchen-day-card {
-  min-height: 100%;
-}
-
-.kitchen-day-card.is-empty {
-  min-height: auto;
-  background: #f8f9ff;
-  border: 1px solid #e4e7ff;
-  box-shadow: 0 10px 30px rgba(99, 102, 241, 0.06);
-}
-
-.kitchen-day-card.is-selected {
-  border: 1px solid #c7d2fe;
-  box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.05);
-}
-
-.kitchen-day-header {
-  display: flex;
-  flex-direction: column;
-  gap: 6px;
-}
-
-.kitchen-day-cta {
-  display: flex;
-  justify-content: flex-end;
-  align-items: center;
-  gap: 8px;
-}
-
-.kitchen-day-edit-actions {
-  display: inline-flex;
-  gap: 8px;
-}
-
-.kitchen-day-title {
-  margin: 0;
-  font-size: 18px;
-  font-weight: 700;
-  text-transform: capitalize;
-}
-
-.kitchen-day-meta {
-  display: flex;
-  flex-direction: column;
-  gap: 4px;
-  font-size: 13px;
-  color: #667085;
-}
-
-.kitchen-day-status {
-  display: flex;
-  flex-wrap: wrap;
-  gap: 6px;
-}
-
-.kitchen-day-view {
-  display: flex;
-  flex-direction: column;
-  gap: 12px;
-}
-
-.kitchen-day-empty {
-  display: flex;
-  flex-direction: column;
-  flex: 1;
-  min-height: 120px;
-}
-
-.kitchen-day-empty-spacer {
-  flex: 1;
-}
-
-.kitchen-day-empty-button {
-  margin-top: auto;
-  align-self: center;
-  width: 100%;
-}
-
-.kitchen-day-info {
-  display: flex;
-  flex-direction: column;
-  gap: 4px;
-}
-
-.kitchen-day-info-label {
-  font-size: 12px;
-  color: #667085;
-  font-weight: 600;
-  text-transform: uppercase;
-  letter-spacing: 0.04em;
-}
-
-.kitchen-day-info-value {
-  font-size: 16px;
-  font-weight: 600;
-  color: #101828;
-}
-
-.kitchen-day-ingredients {
-  display: flex;
-  flex-direction: column;
-  gap: 6px;
-}
-
-.kitchen-day-ingredient-pills {
-  display: flex;
-  flex-wrap: wrap;
-  gap: 8px;
-}
-
-.kitchen-ingredient-pill {
-  display: inline-flex;
-  align-items: center;
-  gap: 6px;
-  padding: 4px 10px;
-  border-radius: 999px;
-  font-size: 12px;
-  font-weight: 600;
-  background: #f8fafc;
-  border: 1px solid #e2e8f0;
-  color: #1f2937;
-}
-
-.kitchen-ingredient-pill.is-extra {
-  background: #fef3f2;
-  border-color: #fecaca;
-  color: #991b1b;
-}
-
-.kitchen-status-pill {
-  display: inline-flex;
-  align-items: center;
-  padding: 2px 8px;
-  border-radius: 999px;
-  font-size: 11px;
-  font-weight: 600;
-  letter-spacing: 0.01em;
-  border: 1px solid transparent;
-  color: #344054;
-  background: #f2f4f7;
-}
-
-.kitchen-status-pill.assigned {
-  color: #1d4ed8;
-  background: #eff6ff;
-  border-color: #dbeafe;
-}
-
-.kitchen-status-pill.planned {
-  color: #1f2937;
-  background: #f8fafc;
-  border-color: #e2e8f0;
-}
-
-.kitchen-status-pill.active {
-  color: #027a48;
-  background: #ecfdf3;
-  border-color: #abefc6;
-}
-
-.kitchen-status-pill.inactive {
-  color: #b42318;
-  background: #fef3f2;
-  border-color: #fecaca;
-}
-
-.kitchen-inline-error {
-  margin: 4px 0 0;
-  font-size: 13px;
-  color: #b42318;
-}
-
-.kitchen-inline-warning {
-  padding: 10px 12px;
-  border-radius: 12px;
-  border: 1px solid #f9dbaf;
-  background: #fff7ed;
-  color: #9a3412;
-  font-weight: 600;
-  font-size: 14px;
-}
-
-.kitchen-ingredient-picker {
-  display: flex;
-  flex-direction: column;
-  gap: 16px;
-}
-
-.kitchen-ingredient-picker .kitchen-input {
-  font-size: 16px;
-  padding: 12px 14px;
-  border-radius: 14px;
-}
-
-.kitchen-ingredient-search {
-  gap: 8px;
-}
-
-.kitchen-chip-list {
-  display: flex;
-  flex-wrap: wrap;
-  gap: 10px 12px;
-  align-items: center;
-  margin-bottom: 8px;
-}
-
-.kitchen-chip-item {
-  display: inline-flex;
-  align-items: center;
-  gap: 8px;
-}
-
-.kitchen-chip {
-  display: inline-flex;
-  align-items: center;
-  gap: 8px;
-  padding: 8px 12px;
-  border-radius: 999px;
-  font-size: 15px;
-  font-weight: 600;
-  border: 1px solid transparent;
-  box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
-}
-
-.kitchen-chip-label {
-  line-height: 1.2;
-}
-
-.kitchen-chip.is-pending {
-  border-color: rgba(15, 23, 42, 0.12);
-}
-
-.kitchen-chip-remove {
-  border: none;
-  background: rgba(255, 255, 255, 0.6);
-  color: inherit;
-  width: 22px;
-  height: 22px;
-  border-radius: 999px;
-  display: inline-flex;
-  align-items: center;
-  justify-content: center;
-  cursor: pointer;
-  font-size: 12px;
-  line-height: 1;
-}
-
-.kitchen-chip-action {
-  border: none;
-  background: #ffffff;
-  color: #1d2939;
-  padding: 6px 10px;
-  border-radius: 999px;
-  font-size: 13px;
-  font-weight: 600;
-  box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
-  cursor: pointer;
-}
-
-.kitchen-suggestion-list {
-  margin-top: 6px;
-  background: white;
-  border-radius: 16px;
-  border: 1px solid #e4e7ec;
-  box-shadow: 0 12px 30px rgba(15, 23, 42, 0.12);
-  padding: 6px;
-  display: flex;
-  flex-direction: column;
-  gap: 4px;
-}
-
-.kitchen-suggestion-list.is-scrollable {
-  max-height: 240px;
-  overflow-y: auto;
-}
-
-.kitchen-suggestion {
-  border: none;
-  background: transparent;
-  text-align: left;
-  padding: 10px 12px;
-  border-radius: 12px;
-  font-size: 15px;
-  font-weight: 600;
-  color: #101828;
-  cursor: pointer;
-}
-
-.kitchen-suggestion.is-assignee {
-  display: inline-flex;
-  align-items: center;
-  gap: 10px;
-}
-
-.kitchen-suggestion.is-create {
-  color: #4338ca;
-}
-
-.kitchen-suggestion-empty {
-  padding: 8px 10px;
-}
-
-.kitchen-suggestion:hover,
-.kitchen-suggestion:focus-visible {
-  background: #f2f4f7;
-  outline: none;
-}
-
-.kitchen-inline-panel {
-  margin-top: 8px;
-  border-radius: 16px;
-  border: 1px solid #e4e7ec;
-  background: #ffffff;
-  padding: 16px;
-  display: flex;
-  flex-direction: column;
-  gap: 16px;
-  box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
-}
-
-.kitchen-inline-header {
-  display: flex;
-  flex-direction: column;
-  gap: 4px;
-  font-size: 16px;
-}
-
-.kitchen-category-list {
-  display: flex;
-  flex-wrap: wrap;
-  gap: 10px;
-  margin-top: 6px;
-}
-
-.kitchen-category-option {
-  border: none;
-  background: transparent;
-  padding: 0;
-  position: relative;
-  cursor: pointer;
-}
-
-.kitchen-category-option .kitchen-chip {
-  padding-right: 26px;
-}
-
-.kitchen-category-option.selected .kitchen-chip {
-  border-color: rgba(15, 23, 42, 0.25);
-  box-shadow: 0 10px 24px rgba(15, 23, 42, 0.14);
-}
-
-.kitchen-category-check {
-  position: absolute;
-  top: -6px;
-  right: -4px;
-  width: 18px;
-  height: 18px;
-  border-radius: 999px;
-  background: #0f172a;
-  color: white;
-  font-size: 11px;
-  display: inline-flex;
-  align-items: center;
-  justify-content: center;
-}
-
-.kitchen-inline-actions {
-  display: flex;
-  flex-wrap: wrap;
-  gap: 10px;
-}
-
-.kitchen-context-modal-backdrop {
-  position: fixed;
-  inset: 0;
-  background: rgba(15, 23, 42, 0.35);
-  display: flex;
-  align-items: center;
-  justify-content: center;
-  padding: 20px;
-  z-index: 60;
-}
-
-.kitchen-context-modal-backdrop.inner {
-  background: rgba(15, 23, 42, 0.2);
-  z-index: 70;
-}
-
-.kitchen-context-modal {
-  width: min(420px, 100%);
-  max-height: min(80vh, 560px);
-  background: #ffffff;
-  border-radius: 18px;
-  padding: 20px;
-  box-shadow: 0 20px 48px rgba(15, 23, 42, 0.18);
-  display: flex;
-  flex-direction: column;
-  gap: 16px;
-  overflow: hidden;
-}
-
-.kitchen-context-modal.small {
-  width: min(380px, 100%);
-}
-
-.kitchen-context-modal-header {
-  display: flex;
-  justify-content: space-between;
-  gap: 12px;
-}
-
-.kitchen-context-modal-header h4 {
-  margin: 0;
-  font-size: 18px;
-}
-
-.kitchen-context-modal-body {
-  display: flex;
-  flex-direction: column;
-  gap: 14px;
-  overflow-y: auto;
-  padding-right: 2px;
-}
-
-.kitchen-context-modal-actions {
-  display: flex;
-  flex-wrap: wrap;
-  gap: 12px;
-  justify-content: center;
-}
-
-.kitchen-color-grid {
-  display: flex;
-  flex-wrap: wrap;
-  gap: 10px;
-}
-
-.kitchen-color-option {
-  border: 1px solid transparent;
-  border-radius: 12px;
-  padding: 8px 12px;
-  background: #f2f4f7;
-  color: #101828;
-  font-weight: 600;
-  cursor: pointer;
-  min-height: 44px;
-}
-
-.kitchen-color-option.swatch {
-  width: 44px;
-  padding: 0;
-  display: inline-flex;
-  align-items: center;
-  justify-content: center;
-  font-weight: 700;
-}
-
-.kitchen-color-option.selected {
-  border-color: rgba(15, 23, 42, 0.3);
-  box-shadow: 0 8px 18px rgba(15, 23, 42, 0.15);
-}
-
-.kitchen-day-feedback {
-  display: flex;
-  flex-direction: column;
-  gap: 4px;
-  margin-top: 12px;
-  font-size: 13px;
-  color: #667085;
-}
-
-.kitchen-day-feedback-text.saving {
-  color: #475467;
-}
-
-.kitchen-day-feedback-text.saved {
-  color: #027a48;
-}
-
-.kitchen-day-feedback-text.error {
-  color: #b42318;
-}
-
-.kitchen-toolbar {
-  display: flex;
-  flex-wrap: wrap;
-  gap: 12px;
-  align-items: center;
-  justify-content: space-between;
-  margin-top: 16px;
-}
-
-.kitchen-alert {
-  border-radius: 12px;
-  padding: 10px 12px;
-  font-weight: 600;
-  font-size: 14px;
-}
-
-.kitchen-alert.success {
-  background: #ecfdf3;
-  color: #027a48;
-  border: 1px solid #a6f4c5;
-}
-
-.kitchen-alert.error {
-  background: #fef3f2;
-  color: #b42318;
-  border: 1px solid #fecdca;
-}
-
-.kitchen-form {
-  display: flex;
-  flex-direction: column;
-  gap: 20px;
-}
-
-.kitchen-dish-form-card {
-  width: 100%;
-  max-width: 560px;
-  margin: 0 auto;
-}
-
-.kitchen-dish-ingredients {
-  gap: 10px;
-}
-
-.kitchen-table {
-  width: 100%;
-  border-collapse: collapse;
-}
-
-.kitchen-table th,
-.kitchen-table td {
-  text-align: left;
-  padding: 10px 8px;
-  border-bottom: 1px solid #eef2f6;
-  font-size: 14px;
-}
-
-@media (max-width: 600px) {
-  .kitchen-container {
-    padding: 16px;
-    padding-bottom: calc(96px + env(safe-area-inset-bottom, 0px));
-  }
-
-  .kitchen-grid {
-    grid-template-columns: 1fr;
-    gap: 16px;
-  }
-
-  .kitchen-week-mobile-frame {
-    width: calc(100% - 32px);
-    max-width: 420px;
-    margin: 0 auto;
-    gap: 16px;
-  }
-
-  .kitchen-week-carousel {
-    margin: 0;
-    width: 100%;
-  }
-
-  .kitchen-week-carousel-arrow {
-    display: none;
-  }
-
-  .kitchen-assign-day.is-occupied .kitchen-assign-day-status {
-    display: none;
-  }
-
-  .kitchen-week-days {
-    display: flex;
-    grid-template-columns: none;
-    overflow-x: auto;
-    scroll-snap-type: x mandatory;
-    scroll-behavior: smooth;
-    -webkit-overflow-scrolling: touch;
-    width: 100%;
-    gap: 0;
-    padding: 0 0 4px;
-    scroll-padding-inline: 0;
-  }
-
-  .kitchen-week-days::-webkit-scrollbar {
-    display: none;
-  }
-
-  .kitchen-week-days .kitchen-day-card {
-    flex: 0 0 100%;
-    scroll-snap-align: start;
-  }
-
-  .kitchen-week-carousel-dots {
-    display: flex;
-    width: 100%;
-  }
-
-  .kitchen-week-header {
-    flex-direction: column;
-    margin-bottom: 0;
-  }
-
-  .kitchen-week-header-actions {
-    width: 100%;
-    align-items: stretch;
-  }
-
-  .kitchen-week-nav {
-    --kitchen-week-nav-control-height: 42px;
-    gap: 8px;
-    max-width: 100%;
-  }
-
-  .kitchen-week-controls {
-    gap: 12px;
-    margin-bottom: 16px;
-  }
-
-  .kitchen-weekdays-strip {
-    order: 0;
-  }
-
-  .kitchen-week-mobile-frame {
-    order: 1;
-  }
-
-  .kitchen-week-picker {
-    width: 100%;
-  }
-
-  .kitchen-week-picker .kitchen-label {
-    display: none;
-  }
-
-  .kitchen-week-picker .kitchen-input {
-    font-size: 15px;
-  }
-
-  .kitchen-weekdays-strip {
-    padding: 12px;
-    overflow-x: hidden;
-  }
-
-  .kitchen-weekdays-arrow {
-    display: none;
-  }
-
-  .kitchen-weekdays-list {
-    display: grid;
-    grid-template-columns: repeat(5, minmax(0, 1fr));
-    gap: 6px;
-    width: 100%;
-    max-width: 100%;
-    overflow-x: hidden;
-    justify-items: stretch;
-  }
-
-  .kitchen-weekdays-list.is-carousel {
-    overflow-x: hidden;
-    scroll-snap-type: none;
-    padding: 0;
-    justify-content: initial;
-  }
-
-  .kitchen-weekdays-item {
-    min-width: 0;
-    width: 100%;
-    min-height: 72px;
-    padding: 6px 4px;
-    overflow: hidden;
-  }
-
-  .kitchen-weekdays-circle {
-    width: 44px;
-    height: 44px;
-    font-size: 12px;
-  }
-
-  .kitchen-weekdays-label {
-    font-size: 11px;
-    white-space: nowrap;
-    overflow: hidden;
-    text-overflow: ellipsis;
-    max-width: 100%;
-  }
-
-  .kitchen-topbar {
-    display: none;
-  }
-
-  .kitchen-nav-desktop {
-    display: none;
-  }
-
-  .kitchen-user {
-    display: none;
-  }
-
-  .kitchen-user-placeholder {
-    display: none;
-  }
-
-  .kitchen-nav-toggle {
-    display: none;
-  }
-
-  .kitchen-drawer,
-  .kitchen-drawer-backdrop {
-    display: none;
-  }
-
-  .kitchen-dishes-header {
-    align-items: flex-start;
-  }
-
-  .kitchen-dishes-header .kitchen-button {
-    width: 100%;
-  }
-
-  .kitchen-dish-card {
-    flex-direction: column;
-    align-items: flex-start;
-  }
-
-  .kitchen-dish-actions {
-    width: 100%;
-    justify-content: flex-end;
-  }
-
-  .kitchen-modal {
-    padding: 20px;
-    max-height: 92vh;
-  }
-
-  .kitchen-context-modal-backdrop {
-    align-items: flex-end;
-  }
-
-  .kitchen-context-modal {
-    width: 100%;
-    border-radius: 18px 18px 0 0;
-    max-height: 85vh;
-  }
-
-  .kitchen-bottom-nav {
-    display: block;
-  }
-
-  .kitchen-bottom-nav-label {
-    font-size: 11px;
-  }
-}
-
-@media (max-width: 360px) {
-  .kitchen-bottom-nav-label {
-    font-size: 10px;
-  }
-}
-
-@media (min-width: 900px) {
-  .kitchen-day-empty-button {
-    max-width: 280px;
-  }
-
-  .kitchen-modal-actions {
-    flex-direction: row;
-  }
-}
-
-
-.kitchen-ui-card {
-  background: var(--hf-surface);
-  border-radius: var(--hf-radius-lg);
-  padding: 24px;
-  box-shadow: var(--hf-shadow-soft);
-  display: flex;
-  flex-direction: column;
-  gap: 16px;
-}
-
-.kitchen-ui-button {
-  border: none;
-  border-radius: 999px;
-  background: var(--hf-brand);
-  color: #fff;
-  padding: 12px 16px;
-  font-weight: 700;
-  cursor: pointer;
-}
-
-.kitchen-ui-button:disabled {
-  opacity: 0.65;
-  cursor: not-allowed;
-}
-
-.kitchen-ui-button-secondary {
-  background: var(--hf-surface-soft);
-  color: var(--hf-text);
-  border: 1px solid var(--hf-border);
-}
-
-.kitchen-ui-button-ghost {
-  background: transparent;
-  border: 1px solid var(--hf-border);
-  color: var(--hf-text);
-}
-
-.kitchen-ui-input-group {
-  display: grid;
-  gap: 6px;
-}
-
-.kitchen-ui-input {
-  border: 1px solid var(--hf-border);
-  border-radius: var(--hf-radius-md);
-  padding: 11px 12px;
-  font-size: 14px;
-  background: #fff;
-}
-
-.kitchen-ui-input:focus-visible {
-  outline: 2px solid color-mix(in srgb, var(--hf-brand) 35%, white);
-  outline-offset: 1px;
-}
-
-.kitchen-ui-badge {
-  border-radius: 999px;
-  padding: 4px 10px;
-  font-size: 12px;
-  font-weight: 600;
-}
-
-.kitchen-ui-badge-default { background: #eef2ff; color: #3730a3; }
-.kitchen-ui-badge-success { background: var(--hf-surface-mint); color: #0f7a3d; }
-.kitchen-ui-badge-warning { background: var(--hf-surface-peach); color: #9a580a; }
-
-.kitchen-ui-header,
-.kitchen-ui-bottom-nav {
-  backdrop-filter: blur(12px);
-  -webkit-backdrop-filter: blur(12px);
-  background: var(--hf-glass);
-}
-
-.kitchen-ui-header {
-  position: sticky;
-  top: 0;
-  z-index: 20;
-  border-bottom: 1px solid var(--hf-glass-border);
-}
-
-.kitchen-ui-header-inner {
-  max-width: 1100px;
-  margin: 0 auto;
-  padding: 16px 24px;
-  display: flex;
-  justify-content: space-between;
-  align-items: center;
-  gap: 16px;
-}
-
-.kitchen-ui-bottom-nav {
-  position: fixed;
-  left: 0;
-  right: 0;
-  bottom: 0;
-  z-index: 25;
-  padding: 10px 12px calc(12px + env(safe-area-inset-bottom, 0px));
-  border-top: 1px solid var(--hf-glass-border);
-  display: none;
-}
-
-.kitchen-login-wrap {
-  max-width: 560px;
-  min-height: 100vh;
-  min-height: 100dvh;
-  display: grid;
-  place-items: center;
-  padding-top: 24px;
-  padding-bottom: 24px;
-}
-
-.kitchen-login-card {
-  width: min(100%, 460px);
-  border-radius: 30px;
-  padding: clamp(22px, 5vw, 34px);
-  background: rgba(248, 250, 252, 0.88);
-  border: 1px solid rgba(228, 231, 236, 0.72);
-  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
-}
-
-.kitchen-login-badge {
-  display: grid;
-  place-items: center;
-  margin-top: 4px;
-}
-
-.kitchen-login-brand {
-  margin: 0;
-  text-align: center;
-  color: #4338ca;
-  font-size: 1rem;
-  font-weight: 700;
-  letter-spacing: 0.02em;
-}
-
-.kitchen-login-badge-icon {
-  width: 88px;
-  height: 88px;
-  border-radius: 999px;
-  display: grid;
-  place-items: center;
-  background: #f8fafc;
-  box-shadow: 0 0 0 10px rgba(255, 255, 255, 0.9), 0 0 30px rgba(67, 56, 202, 0.14);
-}
-
-.kitchen-login-icon {
-  width: 40px;
-  height: 40px;
-  object-fit: contain;
-}
-
-@media (min-width: 768px) {
-  .kitchen-brand-icon {
-    display: none;
-  }
-
-  .kitchen-brand-logo {
-    display: block;
-  }
-}
-
-.kitchen-login-title {
-  margin: 8px 0 0;
-  text-align: center;
-  font-size: clamp(2rem, 7vw, 2.8rem);
-  font-weight: 700;
-  letter-spacing: -0.02em;
-}
-
-.kitchen-login-subtitle {
-  margin: 0;
-  text-align: center;
-  color: #98a2b3;
-  font-size: clamp(0.95rem, 3vw, 1.1rem);
-}
-
-.kitchen-login-form {
-  margin-top: 10px;
-  display: grid;
-  gap: 14px;
-}
-
-.kitchen-login-fields {
-  display: grid;
-  gap: 14px;
-  border-radius: 30px;
-  background: rgba(255, 255, 255, 0.62);
-  border: 1px solid rgba(228, 231, 236, 0.6);
-  padding: clamp(16px, 5vw, 24px);
-}
-
-.kitchen-login-label {
-  font-size: 0.78rem;
-  color: #98a2b3;
-  font-weight: 700;
-  letter-spacing: 0.06em;
-}
-
-.kitchen-login-input-wrap {
-  position: relative;
-  display: flex;
-  align-items: center;
-}
-
-.kitchen-login-input-icon {
-  width: 18px;
-  height: 18px;
-  color: #98a2b3;
-}
-
-.kitchen-login-input-wrap > .kitchen-login-input-icon {
-  position: absolute;
-  left: 16px;
-  top: 50%;
-  transform: translateY(-50%);
-  pointer-events: none;
-}
-
-.kitchen-ui-input.kitchen-login-input {
-  width: 100%;
-  padding: 15px 16px;
-  padding-left: 52px;
-  border-radius: 999px;
-  border-color: transparent;
-  background: #f8fafc;
-  color: #334155;
-  font-size: 16px;
-  line-height: 1.3;
-  font-weight: 500;
-}
-
-.kitchen-ui-input.kitchen-login-input::placeholder {
-  color: #94a3b8;
-  font-weight: 400;
-}
-
-.kitchen-login-input:focus-visible {
-  border-color: #4338ca;
-  outline: 2px solid rgba(67, 56, 202, 0.2);
-  outline-offset: 1px;
-}
-
-.kitchen-ui-input.kitchen-login-password-input {
-  padding-right: 52px;
-}
-
-.kitchen-login-eye {
-  position: absolute;
-  right: 16px;
-  top: 50%;
-  transform: translateY(-50%);
-  border: none;
-  background: transparent;
-  padding: 6px;
-  border-radius: 999px;
-  display: grid;
-  place-items: center;
-}
-
-.kitchen-login-forgot-row {
-  display: flex;
-  justify-content: flex-end;
-}
-
-.kitchen-login-link {
-  border: none;
-  background: transparent;
-  color: #4338ca;
-  font-weight: 600;
-  font-size: 0.95rem;
-  padding: 0;
-  cursor: pointer;
-}
-
-.kitchen-login-submit {
-  min-height: 54px;
-  font-size: 1.08rem;
-}
-
-.kitchen-login-divider {
-  display: flex;
-  align-items: center;
-  justify-content: center;
-  color: #98a2b3;
-  font-size: 0.78rem;
-  font-weight: 700;
-  letter-spacing: 0.08em;
-  gap: 10px;
-}
-
-.kitchen-login-divider::before,
-.kitchen-login-divider::after {
-  content: "";
-  height: 1px;
-  flex: 1;
-  background: #e4e7ec;
-}
-
-.kitchen-login-socials {
-  display: grid;
-  grid-template-columns: repeat(2, minmax(0, 1fr));
-  gap: 10px;
-}
-
-.kitchen-login-social-button {
-  border-radius: 999px;
-  border: 1px solid var(--hf-border);
-  min-height: 46px;
-  background: rgba(255, 255, 255, 0.8);
-  color: #344054;
-  font-weight: 600;
-  font-size: 1rem;
-  display: inline-flex;
-  align-items: center;
-  justify-content: center;
-  gap: 10px;
-}
-
-.kitchen-login-social-icon {
-  width: 18px;
-  height: 18px;
-  line-height: 1;
-  display: inline-flex;
-  align-items: center;
-  justify-content: center;
-  flex-shrink: 0;
-}
-
-.kitchen-login-social-svg {
-  width: 100%;
-  height: 100%;
-}
-
-.kitchen-login-social-svg-apple {
-  color: #111827;
-}
-
-.kitchen-login-footer {
-  margin: 0;
-  text-align: center;
-  color: #98a2b3;
-  font-size: 1rem;
-}
-
-.kitchen-login-error {
-  color: var(--hf-danger);
-  text-align: center;
-}
-
-.kitchen-ui-bottom-nav-inner {
-  max-width: 720px;
-  margin: 0 auto;
-  display: grid;
-  grid-template-columns: repeat(4, minmax(0, 1fr));
-  gap: 8px;
-}
-
-.kitchen-ui-bottom-nav-item {
-  display: flex;
-  flex-direction: column;
-  align-items: center;
-  color: var(--hf-muted);
-  gap: 4px;
-  border-radius: 14px;
-  padding: 8px 6px;
-  text-decoration: none;
-  font-size: 12px;
-  font-weight: 600;
-}
-
-.kitchen-ui-bottom-nav-item.active {
-  background: #eef2ff;
-  color: var(--hf-brand-strong);
-}
-
-.kitchen-ui-avatar-stack { display: flex; }
-.kitchen-ui-avatar {
-  width: 30px;
-  height: 30px;
-  border-radius: 999px;
-  display: grid;
-  place-items: center;
-  background: #eef2ff;
-  border: 2px solid white;
-  margin-left: -8px;
-  font-size: 12px;
-  font-weight: 700;
-}
-
-.kitchen-ui-avatar:first-child { margin-left: 0; }
-
-.kitchen-ui-fab {
-  position: fixed;
-  bottom: 82px;
-  right: 20px;
-  width: 56px;
-  height: 56px;
-  border-radius: 999px;
-  border: none;
-  background: var(--hf-brand);
-  color: #fff;
-  box-shadow: var(--hf-shadow-glass);
-}
-
-.kitchen-ui-sheet-backdrop {
-  position: fixed;
-  inset: 0;
-  background: rgba(16, 24, 40, 0.45);
-  z-index: 45;
-  display: grid;
-  place-items: end center;
-}
-
-.kitchen-ui-sheet {
-  width: min(720px, 100%);
-  background: #fff;
-  border-radius: var(--hf-radius-xl) var(--hf-radius-xl) 0 0;
-  padding: 24px;
-}
-
-.kitchen-ui-sheet-actions { margin-top: 16px; display: flex; gap: 12px; justify-content: flex-end; }
-
-@media (max-width: 900px) {
-  .kitchen-ui-bottom-nav { display: block; }
-}
-
-/* Neo-Soft 2026 global harmonization */
-.kitchen-container {
-  width: min(1120px, 100%);
-  padding: 20px;
-  margin: 0 auto;
-  max-width: 100%;
-}
-
-.kitchen-ui-card,
-.kitchen-card,
-.kitchen-dish-card,
-.kitchen-inline-panel,
-.kitchen-modal,
-.kitchen-context-modal,
-.kitchen-day-card,
-.kitchen-weekdays-strip {
-  border-radius: var(--hf-radius-lg);
-  box-shadow: var(--hf-shadow-soft);
-  border: 1px solid var(--hf-border);
-  background: var(--hf-surface);
-}
-
-.kitchen-day-card.is-empty,
-.kitchen-dish-card.is-sidedish,
-.kitchen-ui-button-secondary,
-.kitchen-button.secondary,
-.kitchen-status-pill.planned,
-.kitchen-tab-button.is-active {
-  background: var(--hf-surface-soft);
-}
-
-.kitchen-ui-button,
-.kitchen-button,
-.kitchen-assignee-button,
-.kitchen-weekdays-arrow,
-.kitchen-assign-week-nav,
-.kitchen-color-option,
-.kitchen-chip-action {
-  border-radius: 999px;
-  min-height: 44px;
-  transition: transform 180ms ease, box-shadow 180ms ease, background 180ms ease, color 180ms ease;
-}
-
-.kitchen-ui-button,
-.kitchen-button {
-  background: var(--hf-brand);
-  color: #fff;
-  box-shadow: var(--hf-shadow-soft);
-}
-
-.kitchen-ui-button:hover,
-.kitchen-button:hover {
-  background: var(--hf-brand-strong);
-  transform: translateY(-1px);
-}
-
-.kitchen-ui-button-secondary,
-.kitchen-button.secondary {
-  border: 1px solid var(--hf-border);
-  color: var(--hf-text);
-}
-
-.kitchen-ui-button-ghost,
-.kitchen-button.ghost {
-  background: transparent;
-  border: 1px solid var(--hf-border);
-  color: var(--hf-text);
-}
-
-.kitchen-ui-input,
-.kitchen-input,
-.kitchen-select,
-.kitchen-textarea {
-  border-radius: var(--hf-radius-md);
-  border: 1px solid var(--hf-border);
-  min-height: 48px;
-  padding: 11px 14px;
-}
-
-.kitchen-topbar,
-.kitchen-bottom-nav,
-.kitchen-ui-header,
-.kitchen-ui-bottom-nav {
-  background: var(--hf-glass);
-  border-color: var(--hf-glass-border);
-  backdrop-filter: blur(12px);
-  -webkit-backdrop-filter: blur(12px);
-}
-
-.kitchen-brand-link,
-.kitchen-title,
-.kitchen-login-title,
-.kitchen-day-title,
-.kitchen-dishes-header h2 {
-  color: var(--hf-text);
-}
-
-.kitchen-toolbar-search {
-  max-width: 340px;
-}
-
-.kitchen-block-gap {
-  margin-bottom: 16px;
-}
-
-.kitchen-title-no-margin {
-  margin-top: 0;
-  margin-bottom: 6px;
-}
-
-.kitchen-form-compact {
-  gap: 12px;
-}
-
-.kitchen-table th,
-.kitchen-table td {
-  border-bottom: 1px solid var(--hf-border);
-}
-
-@media (min-width: 900px) {
-  .kitchen-grid {
-    grid-template-columns: repeat(2, minmax(0, 1fr));
-  }
-}
-
-/* Semana Neo-Soft 2026 redesign */
-.kitchen-ui-header {
-  background: #eef2ff;
-  border-bottom: 1px solid #dbe3ff;
-}
-
-.kitchen-ui-header-inner {
-  min-height: 88px;
-  padding: 20px 24px;
-}
-
-.kitchen-brand-icon {
-  width: 36px;
-  height: 36px;
-}
-
-.kitchen-nav-desktop {
-  gap: 10px;
-}
-
-.kitchen-nav-desktop a {
-  border-radius: 14px;
-  padding: 11px 18px;
-  font-size: 14px;
-  background: transparent;
-}
-
-.kitchen-nav-desktop a.active {
-  background: #dfe4ff;
-  color: #3730a3;
-}
-
-.kitchen-user { position: relative; }
-
-.kitchen-user-chip {
-  display: inline-flex;
-  align-items: center;
-  gap: 10px;
-  border: 1px solid #dbe3ff;
-  background: #ffffff;
-  border-radius: 999px;
-  padding: 7px 14px 7px 8px;
-  cursor: pointer;
-  box-shadow: 0 4px 14px rgba(79, 70, 229, 0.12);
-}
-
-.kitchen-user-chip:hover { background: #f8faff; }
-
-.kitchen-user-avatar {
-  width: 34px;
-  height: 34px;
-  border-radius: 999px;
-  display: grid;
-  place-items: center;
-  background: #dfe4ff;
-  color: #3730a3;
-  font-weight: 700;
-  font-size: 12px;
-}
-
-.kitchen-user-name { font-weight: 600; font-size: 14px; }
-.kitchen-user-chevron,
-.kitchen-user-menu-icon {
-  width: 16px;
-  height: 16px;
-  stroke: currentColor;
-  stroke-width: 1.8;
-  fill: none;
-}
-
-.kitchen-user-menu {
-  position: absolute;
-  right: 0;
-  top: calc(100% + 10px);
-  min-width: 220px;
-  background: rgba(255, 255, 255, 0.96);
-  border: 1px solid #e6e9f8;
-  box-shadow: 0 16px 30px rgba(30, 41, 59, 0.14);
-  border-radius: 20px;
-  padding: 8px;
-  display: grid;
-  gap: 4px;
-  z-index: 30;
-}
-
-.kitchen-user-menu button {
-  border: none;
-  background: transparent;
-  border-radius: 14px;
-  padding: 10px 12px;
-  display: flex;
-  align-items: center;
-  gap: 10px;
-  font-weight: 600;
-  color: #334155;
-  cursor: pointer;
-}
-
-.kitchen-user-menu button:hover { background: #eef2ff; }
-
-.kitchen-weekdays-item {
-  min-width: 76px;
-  min-height: 96px;
-  border-radius: 20px;
-}
-
-.kitchen-weekdays-circle {
-  width: 56px;
-  height: 56px;
-  border-radius: 20px;
-}
-
-.kitchen-weekdays-label {
-  font-size: 13px;
-}
-
-.kitchen-day-card {
-  background: var(--day-card-bg, #fff);
-  color: var(--day-card-text, var(--hf-text));
-}
-
-.kitchen-day-title,
-.kitchen-day-info-value,
-.kitchen-day-info-label {
-  color: inherit;
-}
-
-.kitchen-day-empty-button {
-  border-radius: 18px;
-  min-height: 50px;
-}
-
-.kitchen-week-mobile-frame { gap: 22px; }
-
-.kitchen-ui-bottom-nav {
-  background: #eef2ff;
-  border-top: 1px solid #dbe3ff;
-}
-
-@media (max-width: 900px) {
-  .kitchen-ui-header { display: none; }
-  .kitchen-container {
-    padding: 14px 14px 88px;
-  }
-}
-
-.kitchen-user-menu-household {
-  display: flex;
-  flex-direction: column;
-  gap: 6px;
-  padding: 8px 10px;
-}
-
-.kitchen-user-menu-household span {
-  font-size: 12px;
-  color: #64748b;
-}
-
-
-
-.shopping-page-shell {
-  background: linear-gradient(180deg, #f4f6ff 0%, #eef0ff 100%);
-  border-radius: 28px;
-  padding: 14px;
-}
-
-.shopping-main-card {
-  margin: 0 auto;
-  max-width: 920px;
-  border-radius: 24px;
-  padding: 18px;
-  box-shadow: 0 18px 40px rgba(76, 81, 169, 0.15);
-  background: rgba(249, 250, 255, 0.88);
-}
-
-.shopping-header-card {
-  margin-bottom: 18px;
-}
-
-.shopping-header-row {
-  display: flex;
-  justify-content: space-between;
-  align-items: center;
-  gap: 12px;
-}
-
-.shopping-header-row h1 {
-  margin: 0;
-  color: #27336a;
-  font-size: clamp(1.1rem, 2.5vw, 1.6rem);
-  line-height: 1.2;
-}
-
-.shopping-week-nav {
-  margin-top: 12px;
-  width: 100%;
-  max-width: 420px;
-  margin-inline: auto;
-}
-
-.shopping-week-nav .kitchen-week-picker .kitchen-input {
-  background: linear-gradient(180deg, #ffffff 0%, #f4f7ff 100%);
-  border-radius: 14px;
-  border: 1px solid rgba(188, 201, 244, 0.8);
-  box-shadow: 0 8px 16px rgba(88, 100, 167, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.95);
-}
-
-.shopping-refresh-icon {
-  border: 1px solid var(--hf-border);
-  background: rgba(255, 255, 255, 0.8);
-  border-radius: 14px;
-  width: 36px;
-  height: 36px;
-  cursor: pointer;
-}
-
-.shopping-toolbar {
-  margin-top: 14px;
-  display: flex;
-  flex-wrap: wrap;
-  justify-content: center;
-  align-items: center;
-  gap: 10px;
-}
-
-.shopping-toolbar-alerts {
-  display: grid;
-  gap: 10px;
-  margin: 14px 0 18px;
-}
-
-.shopping-store-select {
-  width: min(320px, 100%);
-  border-radius: 14px;
-  min-height: 44px;
-  padding-right: 36px;
-  border: 1px solid rgba(190, 201, 234, 0.92);
-  background: linear-gradient(180deg, #fdfdff 0%, #f3f6ff 100%);
-  box-shadow: 0 8px 16px rgba(79, 94, 170, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.95);
-  color: #1f2a58;
-  font-weight: 500;
-  transition: border-color 160ms ease, box-shadow 160ms ease, background 160ms ease;
-}
-
-.shopping-store-select:hover,
-.shopping-store-select-compact:hover {
-  border-color: rgba(140, 156, 218, 0.95);
-}
-
-.shopping-store-select:focus-visible,
-.shopping-store-select-compact:focus-visible {
-  outline: none;
-  border-color: rgba(99, 102, 241, 0.75);
-  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2), 0 10px 20px rgba(79, 94, 170, 0.16);
-}
-
-.shopping-toolbar-alert {
-  margin: 0;
-}
-
-.shopping-bulk-actions {
-  display: flex;
-  justify-content: flex-end;
-}
-
-.shopping-bulk-button {
-  min-height: 34px;
-  padding: 7px 12px;
-  font-size: 13px;
-}
-
-.shopping-tabs {
-  margin-top: 12px;
-  display: flex;
-  gap: 8px;
-}
-
-.shopping-tab {
-  border: 1px solid var(--hf-border);
-  background: #fff;
-  border-radius: 999px;
-  padding: 8px 12px;
-  cursor: pointer;
-}
-
-.shopping-tab.active {
-  background: var(--hf-surface-soft);
-  border-color: var(--hf-brand);
-}
-
-.shopping-categories {
-  display: grid;
-  gap: 14px;
-}
-
-.shopping-category-card {
-  border-radius: 18px;
-  padding: 14px;
-  box-shadow: 0 8px 20px rgba(79, 70, 229, 0.08);
-  background: color-mix(in srgb, var(--category-bg, #f8fafc) 65%, #fff);
-  border: 1px solid color-mix(in srgb, var(--category-text, #64748b) 16%, #fff);
-}
-
-.shopping-category-head {
-  display: flex;
-  align-items: center;
-  justify-content: space-between;
-  gap: 10px;
-  margin-bottom: 10px;
-}
-
-.shopping-category-head h4 {
-  margin: 0;
-  color: var(--category-text, var(--hf-text));
-  letter-spacing: 0.04em;
-  font-size: 12px;
-}
-
-.shopping-category-count {
-  border-radius: 999px;
-  padding: 4px 10px;
-  font-size: 12px;
-  font-weight: 700;
-  color: #fff;
-  background: color-mix(in srgb, var(--category-text, #475569) 75%, #1e293b);
-}
-
-.shopping-items-list {
-  display: grid;
-  gap: 9px;
-}
-
-.shopping-item {
-  display: flex;
-  align-items: center;
-  gap: 10px;
-  padding: 10px 12px;
-  border-radius: 14px;
-  background: #fff;
-  border: 1px solid rgba(210, 218, 255, 0.75);
-  transition: transform 220ms ease, opacity 220ms ease, background 220ms ease, box-shadow 220ms ease;
-}
-
-.shopping-item.is-leaving {
-  opacity: 0;
-  transform: translateX(8px) scale(0.98);
-}
-
-.shopping-item.is-entering {
-  animation: shoppingEnter 240ms ease;
-}
-
-.shopping-item-text {
-  font-weight: 500;
-  color: #1f2a58;
-  position: relative;
-}
-
-.shopping-item.purchased .shopping-item-text::after {
-  content: "";
-  position: absolute;
-  left: 0;
-  top: 53%;
-  width: 100%;
-  height: 1.5px;
-  background: rgba(100, 116, 139, 0.9);
-  transform-origin: left;
-  animation: shoppingStrike 220ms ease forwards;
-}
-
-.shopping-item.purchased .shopping-item-text {
-  color: var(--hf-muted);
-}
-
-.shopping-item-amount {
-  margin-left: auto;
-  padding: 4px 8px;
-  border-radius: 999px;
-  font-size: 12px;
-  font-weight: 700;
-  color: #334155;
-  background: #edf1ff;
-}
-
-.shopping-check {
-  width: 28px;
-  height: 28px;
-  border-radius: 999px;
-  border: 2px solid color-mix(in srgb, var(--category-text, #64748b) 32%, #fff);
-  background: transparent;
-  display: inline-flex;
-  align-items: center;
-  justify-content: center;
-  cursor: pointer;
-  transition: transform 200ms ease, background 200ms ease, border-color 200ms ease;
-}
-
-.shopping-check:hover {
-  transform: scale(1.06);
-}
-
-.shopping-check-dot {
-  color: #fff;
-  font-size: 14px;
-  line-height: 1;
-  opacity: 0;
-  transform: scale(0.6);
-  transition: opacity 200ms ease, transform 220ms cubic-bezier(.2,.85,.3,1.3);
-}
-
-.shopping-check.is-checked {
-  background: var(--hf-brand);
-  border-color: var(--hf-brand);
-}
-
-.shopping-check.is-checked .shopping-check-dot {
-  opacity: 1;
-  transform: scale(1);
-}
-
-.shopping-check:active {
-  transform: scale(0.95);
-}
-
-.shopping-purchased-card h4 {
-  margin: 2px 0 10px;
-  font-size: 14px;
-  color: #64748b;
-  font-weight: 400;
-}
-
-.shopping-purchased-card h4 span {
-  color: #334155;
-  font-weight: 600;
-}
-
-.shopping-purchased-card h4 em {
-  color: #4f46e5;
-  font-style: normal;
-}
-
-.shopping-items-list-purchased .shopping-item {
-  align-items: center;
-}
-
-.shopping-empty-state {
-  display: grid;
-  place-items: center;
-  gap: 8px;
-  border-radius: 18px;
-  padding: 32px 18px;
-  color: #64748b;
-  background: rgba(255, 255, 255, 0.62);
-  border: 1px solid rgba(199, 210, 254, 0.8);
-}
-
-.shopping-empty-state svg {
-  width: 32px;
-  height: 32px;
-  color: #94a3b8;
-}
-
-.shopping-empty-state h4 {
-  margin: 0;
-  font-size: 15px;
-  font-weight: 500;
-}
-
-@keyframes shoppingEnter {
-  0% {
-    opacity: 0;
-    transform: translateY(6px) scale(0.98);
-  }
-  70% {
-    opacity: 1;
-    transform: translateY(0) scale(1.01);
-  }
-  100% {
-    transform: translateY(0) scale(1);
-  }
-}
-
-.shopping-store-select-compact {
-  width: auto;
-  min-width: 150px;
-  max-width: 220px;
-  min-height: 36px;
-  padding-right: 28px;
-  font-size: 13px;
-  border-radius: 12px;
-  border: 1px solid rgba(190, 201, 234, 0.92);
-  background: linear-gradient(180deg, #ffffff 0%, #f5f7ff 100%);
-  box-shadow: 0 6px 14px rgba(79, 94, 170, 0.09), inset 0 1px 0 rgba(255, 255, 255, 0.95);
-}
-
-
-@media (max-width: 390px) {
-  .kitchen-week-nav {
-    --kitchen-week-nav-control-height: 40px;
-    gap: 8px;
-  }
-
-  .kitchen-week-picker .kitchen-input {
-    font-size: 14px;
-    padding-inline: 10px;
-  }
-}
-@keyframes shoppingStrike {
-  from { transform: scaleX(0); }
-  to { transform: scaleX(1); }
-}
-
-@media (max-width: 900px) {
-  .shopping-page-shell {
-    border-radius: 22px;
-    padding: 10px;
-  }
-
-  .shopping-main-card {
-    padding: 14px;
-    border-radius: 20px;
-  }
-
-  .shopping-toolbar {
-    flex-direction: column;
-    align-items: stretch;
-  }
-
-  .shopping-toolbar-alerts {
-    margin-top: 12px;
-  }
-
-  .shopping-store-select {
-    width: 100%;
-  }
-
-  .shopping-store-select-compact {
-    min-width: 118px;
-    margin-left: auto;
-  }
-}
-.kitchen-week-arrow {
-  border-radius: 14px;
-}
+*,
+*::before,
+*::after {
+  box-sizing: border-box;
+}
+
+html,
+body {
+  width: 100%;
+  max-width: 100%;
+  height: 100%;
+  margin: 0;
+  overflow-x: hidden;
+}
+
+#root {
+  width: 100%;
+  max-width: 100%;
+  height: 100%;
+  overflow-x: hidden;
+}
+
+@media (pointer: coarse) {
+  html,
+  body {
+    overflow: hidden;
+    overscroll-behavior: none;
+  }
+
+  #root {
+    height: 100dvh;
+    overflow-y: auto;
+    overscroll-behavior: none;
+    -webkit-overflow-scrolling: touch;
+    touch-action: pan-y;
+  }
+}
+
+@media (pointer: fine) {
+  body {
+    overflow-y: auto;
+  }
+
+  #root {
+    min-height: 100%;
+  }
+}
+
+:root {
+  color-scheme: light;
+  --hf-bg: #f8fafc;
+  --hf-bg-gradient: linear-gradient(
+    180deg,
+    rgba(238, 242, 255, 0.72) 0%,
+    rgba(240, 253, 244, 0.5) 42%,
+    rgba(248, 250, 252, 0.96) 100%
+  );
+  --hf-surface: #ffffff;
+  --hf-surface-soft: #eef2ff;
+  --hf-surface-mint: #f0fdf4;
+  --hf-surface-peach: #fff7ed;
+  --hf-text: #1e293b;
+  --hf-muted: #667085;
+  --hf-brand: #4338ca;
+  --hf-brand-strong: #4338ca;
+  --hf-border: #e4e7ec;
+  --hf-danger: #b42318;
+  --hf-radius-md: 24px;
+  --hf-radius-lg: 28px;
+  --hf-radius-xl: 32px;
+  --hf-shadow-soft: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
+  --hf-shadow-glass: 0 10px 30px rgba(31, 41, 55, 0.1);
+  --hf-glass: rgba(255, 255, 255, 0.7);
+  --hf-glass-border: rgba(255, 255, 255, 0.9);
+}
+
+.kitchen-app {
+  font-family: "Inter", system-ui, sans-serif;
+  background-color: var(--hf-bg);
+  background-image: var(--hf-bg-gradient);
+  background-repeat: no-repeat;
+  background-size: 100% 100%;
+  min-height: 100vh;
+  min-height: 100dvh;
+  width: 100%;
+  max-width: 100%;
+  color: var(--hf-text);
+}
+
+@media (min-width: 768px) {
+  :root {
+    --hf-bg-gradient: linear-gradient(
+      180deg,
+      rgba(238, 242, 255, 0.66) 0%,
+      rgba(240, 253, 244, 0.44) 46%,
+      rgba(248, 250, 252, 0.98) 100%
+    );
+  }
+}
+
+@media (min-width: 1200px) {
+  :root {
+    --hf-bg-gradient: linear-gradient(
+      180deg,
+      rgba(238, 242, 255, 0.58) 0%,
+      rgba(240, 253, 244, 0.38) 50%,
+      rgba(248, 250, 252, 1) 100%
+    );
+  }
+}
+
+.kitchen-container {
+  max-width: 1100px;
+  margin: 0 auto;
+  padding: 24px;
+  width: 100%;
+}
+
+.kitchen-bottom-nav {
+  position: fixed;
+  bottom: 0;
+  left: 0;
+  right: 0;
+  background: #ffffff;
+  border-top: 1px solid #e4e7ec;
+  z-index: 25;
+  padding: 10px 12px calc(12px + env(safe-area-inset-bottom, 0px));
+  display: none;
+}
+
+.kitchen-bottom-nav-inner {
+  max-width: 720px;
+  margin: 0 auto;
+  display: grid;
+  grid-template-columns: repeat(4, minmax(0, 1fr));
+  gap: 8px;
+}
+
+.kitchen-bottom-nav-item {
+  display: flex;
+  flex-direction: column;
+  align-items: center;
+  gap: 4px;
+  padding: 8px 6px;
+  border-radius: 14px;
+  text-decoration: none;
+  color: #667085;
+  font-weight: 600;
+  font-size: 12px;
+  line-height: 1.1;
+  transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
+}
+
+.kitchen-bottom-nav-item.active {
+  background: #eef2ff;
+  color: #4338ca;
+}
+
+.kitchen-bottom-nav-item:active {
+  transform: translateY(1px);
+}
+
+.kitchen-bottom-nav-icon {
+  width: 22px;
+  height: 22px;
+  stroke: currentColor;
+  stroke-width: 1.8;
+  fill: none;
+  stroke-linecap: round;
+  stroke-linejoin: round;
+}
+
+.kitchen-bottom-nav-label {
+  font-size: 12px;
+  text-align: center;
+  white-space: nowrap;
+}
+
+.kitchen-topbar {
+  position: sticky;
+  top: 0;
+  z-index: 20;
+  background: white;
+  border-bottom: 1px solid #e4e7ec;
+}
+
+.kitchen-topbar-inner {
+  max-width: 1100px;
+  margin: 0 auto;
+  padding: 16px 24px;
+  display: flex;
+  align-items: center;
+  justify-content: space-between;
+  gap: 16px;
+  min-height: 72px;
+}
+
+.kitchen-brand {
+  display: flex;
+  align-items: center;
+  gap: 12px;
+}
+
+.kitchen-brand-link {
+  display: inline-flex;
+  align-items: center;
+  font-weight: 700;
+  font-size: 20px;
+  color: #101828;
+  text-decoration: none;
+}
+
+.kitchen-brand-icon {
+  width: 30px;
+  height: 30px;
+  object-fit: contain;
+}
+
+.kitchen-brand-logo {
+  display: none;
+  height: 30px;
+  width: auto;
+  object-fit: contain;
+}
+
+.kitchen-nav-desktop,
+.kitchen-nav-mobile {
+  display: flex;
+  gap: 16px;
+}
+
+.kitchen-nav-desktop a,
+.kitchen-nav-mobile a {
+  text-decoration: none;
+  color: #1d2939;
+  font-weight: 600;
+  font-size: 14px;
+  padding: 6px 8px;
+  border-radius: 8px;
+}
+
+.kitchen-nav-desktop a.active,
+.kitchen-nav-mobile a.active {
+  background: #eef2ff;
+  color: #3730a3;
+}
+
+.kitchen-user {
+  display: flex;
+  align-items: center;
+  gap: 10px;
+}
+
+.kitchen-user-name {
+  font-size: 14px;
+  font-weight: 600;
+  color: #1d2939;
+}
+
+.kitchen-logout-button {
+  width: 44px;
+  height: 44px;
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+  border-radius: 12px;
+  border: 1px solid transparent;
+  background: transparent;
+  color: #475467;
+  cursor: pointer;
+  transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
+}
+
+.kitchen-logout-button:hover {
+  background: #f2f4f7;
+  color: #111827;
+}
+
+.kitchen-logout-button:focus-visible {
+  outline: 2px solid #6366f1;
+  outline-offset: 2px;
+}
+
+.kitchen-logout-icon {
+  width: 20px;
+  height: 20px;
+  stroke: currentColor;
+  stroke-width: 1.8;
+  fill: none;
+  stroke-linecap: round;
+  stroke-linejoin: round;
+}
+
+.kitchen-user-placeholder {
+  width: 160px;
+  min-height: 40px;
+}
+
+.kitchen-nav-toggle {
+  display: none;
+  flex-direction: column;
+  justify-content: center;
+  gap: 4px;
+  width: 36px;
+  height: 36px;
+  border-radius: 10px;
+  border: 1px solid #d0d5dd;
+  background: white;
+  cursor: pointer;
+  padding: 8px;
+}
+
+.kitchen-nav-toggle span {
+  display: block;
+  height: 2px;
+  background: #1d2939;
+  border-radius: 999px;
+}
+
+.kitchen-drawer-backdrop {
+  position: fixed;
+  inset: 0;
+  background: rgba(16, 24, 40, 0.4);
+  border: none;
+  z-index: 30;
+}
+
+.kitchen-drawer {
+  position: fixed;
+  top: 0;
+  left: 0;
+  width: min(300px, 80vw);
+  height: 100%;
+  background: white;
+  z-index: 31;
+  padding: 20px;
+  display: flex;
+  flex-direction: column;
+  gap: 16px;
+  box-shadow: 0 20px 40px rgba(15, 23, 42, 0.2);
+}
+
+.kitchen-drawer-header {
+  display: flex;
+  align-items: center;
+  justify-content: space-between;
+  font-weight: 600;
+}
+
+.kitchen-drawer-close {
+  border: none;
+  background: transparent;
+  color: #1d2939;
+  font-weight: 600;
+  cursor: pointer;
+}
+
+.kitchen-nav-mobile {
+  flex-direction: column;
+  gap: 8px;
+}
+
+.kitchen-drawer-user {
+  display: flex;
+  flex-direction: column;
+  gap: 12px;
+}
+
+.kitchen-card {
+  background: white;
+  border-radius: 16px;
+  padding: 24px;
+  box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
+  display: flex;
+  flex-direction: column;
+  gap: 16px;
+  box-sizing: border-box;
+  min-width: 0;
+}
+
+.kitchen-grid {
+  display: grid;
+  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
+  gap: 20px;
+  align-items: stretch;
+}
+
+.kitchen-week-carousel {
+  position: relative;
+}
+
+.kitchen-week-days {
+  display: grid;
+  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
+  gap: 20px;
+  align-items: stretch;
+}
+
+.kitchen-week-carousel-arrow {
+  position: absolute;
+  top: 50%;
+  transform: translateY(-50%);
+  border: 1px solid #e2e8f0;
+  background: #fff;
+  color: #1f2937;
+  width: 36px;
+  height: 36px;
+  border-radius: 999px;
+  display: flex;
+  align-items: center;
+  justify-content: center;
+  box-shadow: 0 6px 16px rgba(15, 23, 42, 0.12);
+  cursor: pointer;
+  z-index: 2;
+}
+
+.kitchen-week-carousel-arrow.is-left {
+  left: -6px;
+}
+
+.kitchen-week-carousel-arrow.is-right {
+  right: -6px;
+}
+
+.kitchen-week-carousel-arrow-icon {
+  width: 18px;
+  height: 18px;
+  stroke: currentColor;
+  stroke-width: 2;
+  fill: none;
+}
+
+.kitchen-week-carousel-arrow-icon.is-next {
+  transform: rotate(180deg);
+}
+
+.kitchen-week-carousel-dots {
+  display: none;
+  justify-content: center;
+  gap: 6px;
+  margin-top: 12px;
+}
+
+.kitchen-week-carousel-dot {
+  width: 8px;
+  height: 8px;
+  border-radius: 999px;
+  border: none;
+  padding: 0;
+  background: #d0d5dd;
+}
+
+.kitchen-week-carousel-dot.is-active {
+  background: #6366f1;
+}
+
+.kitchen-dishes-page {
+  display: flex;
+  flex-direction: column;
+  gap: 20px;
+}
+
+.kitchen-dishes-header {
+  display: flex;
+  flex-wrap: wrap;
+  gap: 16px;
+  align-items: center;
+  justify-content: space-between;
+}
+
+.kitchen-dishes-header h2 {
+  margin: 0;
+  font-size: 24px;
+}
+
+.kitchen-dishes-header .kitchen-muted {
+  margin-top: 4px;
+}
+
+.kitchen-dishes-search {
+  display: flex;
+}
+
+.kitchen-dishes-tabs {
+  display: inline-flex;
+  gap: 8px;
+  padding: 6px;
+  border-radius: 12px;
+  background: #f1f5f9;
+  align-self: flex-start;
+}
+
+.kitchen-tab-button {
+  border: none;
+  background: transparent;
+  padding: 8px 16px;
+  border-radius: 10px;
+  font-weight: 600;
+  color: #475569;
+  cursor: pointer;
+  transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
+}
+
+.kitchen-tab-button.is-active {
+  background: white;
+  color: #1e293b;
+  box-shadow: 0 4px 12px rgba(15, 23, 42, 0.12);
+}
+
+.kitchen-tab-button:focus-visible {
+  outline: 3px solid rgba(79, 70, 229, 0.35);
+  outline-offset: 2px;
+}
+
+.kitchen-dishes-grid {
+  display: grid;
+  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
+  gap: 16px;
+}
+
+.kitchen-dish-card {
+  background: white;
+  border-radius: 14px;
+  padding: 16px;
+  box-shadow: 0 6px 20px rgba(15, 23, 42, 0.08);
+  display: flex;
+  align-items: flex-start;
+  justify-content: space-between;
+  gap: 16px;
+  min-height: 96px;
+}
+
+.kitchen-dish-card.is-sidedish {
+  background: #f8fafc;
+  border: 1px solid #e2e8f0;
+}
+
+.kitchen-dish-title-row {
+  display: flex;
+  flex-wrap: wrap;
+  align-items: center;
+  gap: 8px;
+}
+
+.kitchen-dish-name {
+  margin: 0 0 6px;
+  font-size: 16px;
+}
+
+.kitchen-dish-badge {
+  display: inline-flex;
+  align-items: center;
+  padding: 2px 10px;
+  border-radius: 999px;
+  font-size: 11px;
+  font-weight: 600;
+  color: #1d4ed8;
+  background: #dbeafe;
+}
+
+.kitchen-dish-ingredients-text {
+  margin: 0;
+  color: #667085;
+  font-size: 13px;
+  line-height: 1.4;
+  display: -webkit-box;
+  -webkit-line-clamp: 2;
+  -webkit-box-orient: vertical;
+  overflow: hidden;
+}
+
+.kitchen-ingredient-card {
+  gap: 12px;
+}
+
+.kitchen-ingredient-canonical {
+  margin: 6px 0 0;
+  color: #667085;
+  font-size: 13px;
+}
+
+.kitchen-ingredient-tags {
+  display: flex;
+  flex-wrap: wrap;
+  gap: 8px;
+  margin-top: 8px;
+}
+
+.kitchen-ingredient-selected-category {
+  display: flex;
+  align-items: center;
+  gap: 8px;
+  margin-top: 8px;
+}
+
+.kitchen-dish-actions {
+  display: flex;
+  gap: 8px;
+  align-items: center;
+}
+
+.kitchen-icon-button {
+  border: 1px solid #e2e8f0;
+  background: white;
+  width: 44px;
+  height: 44px;
+  border-radius: 12px;
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+  color: #344054;
+  cursor: pointer;
+  transition: border 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
+}
+
+.kitchen-icon-button svg {
+  width: 20px;
+  height: 20px;
+}
+
+.kitchen-icon-button:hover {
+  border-color: #c7d2fe;
+  color: #4f46e5;
+  box-shadow: 0 6px 12px rgba(79, 70, 229, 0.15);
+}
+
+.kitchen-icon-button.assign:hover {
+  border-color: #bbf7d0;
+  color: #15803d;
+  box-shadow: 0 6px 12px rgba(21, 128, 61, 0.12);
+}
+
+.kitchen-icon-button.danger:hover {
+  border-color: #fecaca;
+  color: #b42318;
+  box-shadow: 0 6px 12px rgba(180, 35, 24, 0.15);
+}
+
+.kitchen-modal-backdrop {
+  position: fixed;
+  inset: 0;
+  background: rgba(15, 23, 42, 0.4);
+  display: flex;
+  align-items: center;
+  justify-content: center;
+  padding: 20px;
+  z-index: 40;
+}
+
+.kitchen-modal {
+  width: min(640px, 100%);
+  max-height: min(90vh, 780px);
+  background: white;
+  border-radius: 18px;
+  padding: 24px;
+  box-shadow: 0 24px 60px rgba(15, 23, 42, 0.2);
+  display: flex;
+  flex-direction: column;
+  gap: 20px;
+  overflow: hidden;
+}
+
+.kitchen-modal .kitchen-form {
+  overflow-y: auto;
+  padding-right: 4px;
+}
+
+.kitchen-modal-header {
+  display: flex;
+  align-items: flex-start;
+  justify-content: space-between;
+  gap: 12px;
+}
+
+.kitchen-modal-header h3 {
+  margin: 0;
+  font-size: 20px;
+}
+
+.kitchen-modal-actions {
+  display: flex;
+  flex-direction: column;
+  gap: 12px;
+  align-items: center;
+  justify-content: center;
+  padding-top: 4px;
+}
+
+.kitchen-assign-modal .kitchen-modal-header p {
+  margin: 6px 0 0;
+}
+
+.kitchen-assign-body {
+  display: flex;
+  flex-direction: column;
+  gap: 16px;
+}
+
+.kitchen-assign-week-header {
+  display: grid;
+  grid-template-columns: 40px 1fr 40px;
+  align-items: center;
+  gap: 12px;
+  width: 100%;
+}
+
+.kitchen-assign-week-label {
+  text-align: center;
+  font-size: 13px;
+  font-weight: 600;
+  color: #0f172a;
+}
+
+.kitchen-assign-week-nav {
+  border: 1px solid #e2e8f0;
+  background: #ffffff;
+  color: #475569;
+  width: 40px;
+  height: 40px;
+  border-radius: 10px;
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+  cursor: pointer;
+  transition: border-color 0.2s ease, background 0.2s ease, color 0.2s ease;
+}
+
+.kitchen-assign-week-nav:disabled {
+  cursor: not-allowed;
+  opacity: 0.45;
+}
+
+.kitchen-assign-week-icon {
+  width: 16px;
+  height: 16px;
+  stroke: currentColor;
+  stroke-width: 2;
+  fill: none;
+  stroke-linecap: round;
+  stroke-linejoin: round;
+}
+
+.kitchen-assign-week-icon.is-next {
+  transform: rotate(180deg);
+}
+
+.kitchen-assign-days {
+  display: grid;
+  grid-template-columns: repeat(7, minmax(0, 1fr));
+  gap: 8px;
+}
+
+.kitchen-assign-day {
+  border: 1px solid #e2e8f0;
+  background: #f8fafc;
+  border-radius: 12px;
+  padding: 10px 6px;
+  display: flex;
+  flex-direction: column;
+  align-items: center;
+  gap: 4px;
+  font-size: 12px;
+  color: #0f172a;
+  cursor: pointer;
+  transition: border-color 0.2s ease, background 0.2s ease, color 0.2s ease;
+}
+
+.kitchen-assign-day.is-selected {
+  border-color: #4f46e5;
+  background: #eef2ff;
+  color: #312e81;
+  box-shadow: 0 8px 16px rgba(79, 70, 229, 0.12);
+}
+
+.kitchen-assign-day.is-occupied {
+  border-color: #cbd5f5;
+}
+
+.kitchen-assign-day:disabled {
+  opacity: 0.45;
+  cursor: not-allowed;
+  background: #f1f5f9;
+}
+
+.kitchen-assign-day-label {
+  font-size: 11px;
+  text-transform: uppercase;
+  letter-spacing: 0.08em;
+}
+
+.kitchen-assign-day-number {
+  font-size: 15px;
+  font-weight: 700;
+}
+
+.kitchen-assign-day-status {
+  font-size: 10px;
+  text-transform: uppercase;
+  letter-spacing: 0.08em;
+  color: #64748b;
+  text-align: center;
+}
+
+.kitchen-assign-day-detail {
+  display: block;
+  font-size: 11px;
+  letter-spacing: normal;
+  text-transform: none;
+  color: #475569;
+}
+
+.kitchen-dishes-loading {
+  font-weight: 600;
+  text-align: center;
+}
+
+.kitchen-button {
+  background: #4f46e5;
+  border: none;
+  color: white;
+  padding: 12px 18px;
+  border-radius: 10px;
+  cursor: pointer;
+  font-weight: 600;
+  font-size: 15px;
+  min-height: 48px;
+  transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
+}
+
+.kitchen-button.is-small {
+  padding: 6px 12px;
+  font-size: 13px;
+  min-height: 32px;
+}
+
+.kitchen-button:hover {
+  background: #4338ca;
+}
+
+.kitchen-button:active {
+  transform: translateY(1px);
+}
+
+.kitchen-button:focus-visible {
+  outline: 3px solid rgba(79, 70, 229, 0.35);
+  outline-offset: 2px;
+}
+
+.kitchen-button.secondary {
+  background: #e2e8f0;
+  color: #0f172a;
+}
+
+.kitchen-button.ghost {
+  background: transparent;
+  border: 1px solid #cbd5f5;
+  color: #1e293b;
+}
+
+.kitchen-input,
+.kitchen-select,
+.kitchen-textarea {
+  width: 100%;
+  padding: 10px 12px;
+  border-radius: 10px;
+  border: 1px solid #d0d5dd;
+  background: white;
+  font-size: 14px;
+  box-sizing: border-box;
+  min-width: 0;
+}
+
+.kitchen-label {
+  display: block;
+  font-weight: 600;
+  margin-bottom: 6px;
+  color: #344054;
+}
+
+.kitchen-field {
+  display: flex;
+  flex-direction: column;
+  gap: 6px;
+}
+
+.kitchen-toggle-field {
+  gap: 0;
+}
+
+.kitchen-toggle-row {
+  display: flex;
+  align-items: center;
+  justify-content: space-between;
+  gap: 12px;
+}
+
+.kitchen-toggle {
+  position: relative;
+  display: inline-flex;
+  align-items: center;
+}
+
+.kitchen-toggle-input {
+  position: absolute;
+  opacity: 0;
+  width: 0;
+  height: 0;
+}
+
+.kitchen-toggle-track {
+  width: 46px;
+  height: 26px;
+  border-radius: 999px;
+  background: #e4e7ec;
+  position: relative;
+  transition: background 0.2s ease;
+}
+
+.kitchen-toggle-track::after {
+  content: "";
+  position: absolute;
+  top: 3px;
+  left: 3px;
+  width: 20px;
+  height: 20px;
+  border-radius: 50%;
+  background: #ffffff;
+  box-shadow: 0 2px 6px rgba(15, 23, 42, 0.2);
+  transition: transform 0.2s ease;
+}
+
+.kitchen-toggle-input:checked + .kitchen-toggle-track {
+  background: #4f46e5;
+}
+
+.kitchen-toggle-input:checked + .kitchen-toggle-track::after {
+  transform: translateX(20px);
+}
+
+.kitchen-toggle-input:focus-visible + .kitchen-toggle-track {
+  outline: 3px solid rgba(79, 70, 229, 0.35);
+  outline-offset: 2px;
+}
+
+.kitchen-pill {
+  display: inline-flex;
+  align-items: center;
+  gap: 6px;
+  padding: 4px 10px;
+  border-radius: 999px;
+  background: #eef2ff;
+  color: #4338ca;
+  font-size: 12px;
+  font-weight: 600;
+}
+
+.kitchen-empty {
+  text-align: center;
+  padding: 32px;
+  color: #475467;
+}
+
+.kitchen-muted {
+  color: #667085;
+  font-size: 14px;
+}
+
+.kitchen-actions {
+  display: flex;
+  flex-direction: column;
+  gap: 12px;
+  margin-top: 20px;
+  width: 100%;
+}
+
+.kitchen-actions-inline {
+  display: flex;
+  gap: 8px;
+  align-items: center;
+}
+
+.kitchen-actions-inline .kitchen-select {
+  flex: 1;
+}
+
+.kitchen-assignee-picker {
+  position: relative;
+  display: flex;
+  flex-direction: column;
+  gap: 6px;
+}
+
+.kitchen-assignee-button {
+  width: 100%;
+  border: 1px solid #d0d5dd;
+  border-radius: 12px;
+  background: #ffffff;
+  padding: 8px 12px;
+  display: inline-flex;
+  align-items: center;
+  gap: 10px;
+  font-size: 14px;
+  font-weight: 600;
+  color: #101828;
+  min-height: 48px;
+  cursor: pointer;
+  transition: border 0.2s ease, box-shadow 0.2s ease;
+}
+
+.kitchen-assignee-button:hover {
+  border-color: #c7d2fe;
+}
+
+.kitchen-assignee-button:focus-visible {
+  outline: 3px solid rgba(79, 70, 229, 0.35);
+  outline-offset: 2px;
+}
+
+.kitchen-assignee-avatar {
+  width: 28px;
+  height: 28px;
+  border-radius: 50%;
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+  font-size: 12px;
+  font-weight: 700;
+}
+
+.kitchen-assignee-name {
+  flex: 1;
+  text-align: left;
+}
+
+.kitchen-week-header {
+  display: flex;
+  align-items: flex-start;
+  justify-content: center;
+  gap: 16px;
+  margin-bottom: 20px;
+}
+
+.kitchen-week-header-main {
+  display: flex;
+  flex-direction: column;
+  gap: 4px;
+}
+
+.kitchen-week-header-actions {
+  display: flex;
+  flex-direction: column;
+  gap: 12px;
+  width: min(420px, 100%);
+  align-items: center;
+}
+
+.kitchen-week-mobile-frame {
+  width: 100%;
+  display: flex;
+  flex-direction: column;
+  align-items: stretch;
+}
+
+.kitchen-week-nav {
+  --kitchen-week-nav-control-height: 44px;
+  display: grid;
+  grid-template-columns: var(--kitchen-week-nav-control-height) minmax(0, 1fr) var(--kitchen-week-nav-control-height);
+  align-items: center;
+  gap: 10px;
+  width: 100%;
+  max-width: 420px;
+  margin-inline: auto;
+}
+
+.kitchen-week-picker {
+  width: 100%;
+  display: block;
+  min-width: 0;
+  margin: 0;
+}
+
+.kitchen-week-arrow {
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+  width: var(--kitchen-week-nav-control-height);
+  height: var(--kitchen-week-nav-control-height);
+  flex: 0 0 var(--kitchen-week-nav-control-height);
+  border-radius: 14px;
+  border: 1px solid rgba(176, 188, 229, 0.75);
+  background: linear-gradient(180deg, #ffffff 0%, #f4f7ff 100%);
+  color: #344054;
+  box-shadow: 0 8px 16px rgba(88, 100, 167, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.95);
+  cursor: pointer;
+  transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
+}
+
+.kitchen-week-picker .kitchen-input {
+  min-height: var(--kitchen-week-nav-control-height);
+  height: var(--kitchen-week-nav-control-height);
+  line-height: normal;
+  text-align: center;
+  width: 100%;
+  min-width: 0;
+  max-width: 100%;
+  padding-block: 0;
+  box-sizing: border-box;
+  -webkit-appearance: none;
+  appearance: none;
+  overflow: hidden;
+  text-overflow: ellipsis;
+  white-space: nowrap;
+}
+
+.kitchen-week-arrow-icon {
+  width: 18px;
+  height: 18px;
+  stroke: currentColor;
+  stroke-width: 2;
+  fill: none;
+  stroke-linecap: round;
+  stroke-linejoin: round;
+}
+
+.kitchen-week-arrow-icon.is-next {
+  transform: rotate(180deg);
+}
+
+.kitchen-week-arrow:hover {
+  background: linear-gradient(180deg, #ffffff 0%, #eef3ff 100%);
+  border-color: rgba(147, 163, 221, 0.92);
+  color: #1d2939;
+  box-shadow: 0 10px 20px rgba(88, 100, 167, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.95);
+}
+
+.kitchen-week-arrow:focus-visible {
+  outline: 2px solid #6366f1;
+  outline-offset: 2px;
+}
+
+.kitchen-title {
+  margin: 0;
+  font-size: 22px;
+  font-weight: 700;
+  color: #0f172a;
+}
+
+.kitchen-week-subtitle {
+  margin: 0;
+}
+
+.kitchen-weekdays-strip {
+  padding: 20px 22px;
+  border: 1px solid #eaecf0;
+  box-shadow: none;
+  gap: 16px;
+  margin-bottom: 0;
+  width: 100%;
+  box-sizing: border-box;
+  overflow-x: hidden;
+}
+
+.kitchen-week-controls {
+  display: flex;
+  flex-direction: column;
+  gap: 20px;
+  margin-bottom: 24px;
+}
+
+.kitchen-weekdays-carousel {
+  position: relative;
+  display: flex;
+  align-items: center;
+  width: 100%;
+  max-width: 100%;
+  overflow-x: hidden;
+}
+
+.kitchen-weekdays-carousel.is-carousel::before,
+.kitchen-weekdays-carousel.is-carousel::after {
+  content: "";
+  position: absolute;
+  top: 0;
+  bottom: 0;
+  width: 32px;
+  pointer-events: none;
+  z-index: 1;
+}
+
+.kitchen-weekdays-carousel.is-carousel::before {
+  left: 0;
+  background: linear-gradient(90deg, #ffffff 0%, rgba(255, 255, 255, 0) 100%);
+}
+
+.kitchen-weekdays-carousel.is-carousel::after {
+  right: 0;
+  background: linear-gradient(270deg, #ffffff 0%, rgba(255, 255, 255, 0) 100%);
+}
+
+.kitchen-weekdays-arrow {
+  width: 40px;
+  height: 40px;
+  border-radius: 12px;
+  border: 1px solid #e4e7ec;
+  background: #ffffff;
+  color: #344054;
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+  cursor: pointer;
+  transition: border-color 0.2s ease, background 0.2s ease;
+  position: absolute;
+  top: 50%;
+  transform: translateY(-50%);
+  z-index: 2;
+}
+
+.kitchen-weekdays-arrow:hover {
+  background: #f8fafc;
+  border-color: #d0d5dd;
+}
+
+.kitchen-weekdays-arrow.is-left {
+  left: -8px;
+}
+
+.kitchen-weekdays-arrow.is-right {
+  right: -8px;
+}
+
+.kitchen-weekdays-arrow-icon {
+  width: 18px;
+  height: 18px;
+  stroke: currentColor;
+  stroke-width: 2;
+  fill: none;
+  stroke-linecap: round;
+  stroke-linejoin: round;
+}
+
+.kitchen-weekdays-arrow-icon.is-next {
+  transform: rotate(180deg);
+}
+
+.kitchen-weekdays-list {
+  display: flex;
+  gap: 12px;
+  align-items: center;
+  justify-content: center;
+  width: 100%;
+  padding-bottom: 4px;
+}
+
+.kitchen-weekdays-list.is-carousel {
+  overflow-x: auto;
+  scroll-snap-type: x mandatory;
+  -webkit-overflow-scrolling: touch;
+  scrollbar-width: none;
+  justify-content: flex-start;
+  padding: 4px 32px;
+  max-width: 100%;
+}
+
+.kitchen-weekdays-list.is-carousel::-webkit-scrollbar {
+  display: none;
+}
+
+.kitchen-weekdays-item {
+  min-width: 64px;
+  min-height: 80px;
+  padding: 8px 6px;
+  border-radius: 14px;
+  border: 1px solid transparent;
+  background: transparent;
+  display: flex;
+  flex-direction: column;
+  align-items: center;
+  gap: 6px;
+  cursor: pointer;
+  scroll-snap-align: center;
+  transition: border-color 0.2s ease, background 0.2s ease, transform 0.2s ease;
+}
+
+.kitchen-weekdays-item:focus-visible {
+  outline: 2px solid #6366f1;
+  outline-offset: 2px;
+}
+
+.kitchen-weekdays-item.is-selected {
+  border-color: #c7d2fe;
+  background: #f8f9ff;
+}
+
+.kitchen-weekdays-circle {
+  width: 52px;
+  height: 52px;
+  border-radius: 999px;
+  display: flex;
+  align-items: center;
+  justify-content: center;
+  font-weight: 700;
+  font-size: 14px;
+  letter-spacing: 0.04em;
+  text-transform: uppercase;
+  background: var(--weekday-bg);
+  color: var(--weekday-text);
+  border: 1px solid var(--weekday-border);
+  box-sizing: border-box;
+}
+
+.kitchen-weekdays-label {
+  font-size: 12px;
+  font-weight: 600;
+  color: #475467;
+  text-transform: uppercase;
+}
+
+.kitchen-day-card {
+  min-height: 100%;
+}
+
+.kitchen-day-card.is-empty {
+  min-height: auto;
+  background: #f8f9ff;
+  border: 1px solid #e4e7ff;
+  box-shadow: 0 10px 30px rgba(99, 102, 241, 0.06);
+}
+
+.kitchen-day-card.is-selected {
+  border: 1px solid #c7d2fe;
+  box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.05);
+}
+
+.kitchen-day-header {
+  display: flex;
+  flex-direction: column;
+  gap: 6px;
+}
+
+.kitchen-day-cta {
+  display: flex;
+  justify-content: flex-end;
+  align-items: center;
+  gap: 8px;
+}
+
+.kitchen-day-edit-actions {
+  display: inline-flex;
+  gap: 8px;
+}
+
+.kitchen-day-title {
+  margin: 0;
+  font-size: 18px;
+  font-weight: 700;
+  text-transform: capitalize;
+}
+
+.kitchen-day-meta {
+  display: flex;
+  flex-direction: column;
+  gap: 4px;
+  font-size: 13px;
+  color: #667085;
+}
+
+.kitchen-day-status {
+  display: flex;
+  flex-wrap: wrap;
+  gap: 6px;
+}
+
+.kitchen-day-view {
+  display: flex;
+  flex-direction: column;
+  gap: 12px;
+}
+
+.kitchen-day-empty {
+  display: flex;
+  flex-direction: column;
+  flex: 1;
+  min-height: 120px;
+}
+
+.kitchen-day-empty-spacer {
+  flex: 1;
+}
+
+.kitchen-day-empty-button {
+  margin-top: auto;
+  align-self: center;
+  width: 100%;
+}
+
+.kitchen-day-info {
+  display: flex;
+  flex-direction: column;
+  gap: 4px;
+}
+
+.kitchen-day-info-label {
+  font-size: 12px;
+  color: #667085;
+  font-weight: 600;
+  text-transform: uppercase;
+  letter-spacing: 0.04em;
+}
+
+.kitchen-day-info-value {
+  font-size: 16px;
+  font-weight: 600;
+  color: #101828;
+}
+
+.kitchen-day-ingredients {
+  display: flex;
+  flex-direction: column;
+  gap: 6px;
+}
+
+.kitchen-day-ingredient-pills {
+  display: flex;
+  flex-wrap: wrap;
+  gap: 8px;
+}
+
+.kitchen-ingredient-pill {
+  display: inline-flex;
+  align-items: center;
+  gap: 6px;
+  padding: 4px 10px;
+  border-radius: 999px;
+  font-size: 12px;
+  font-weight: 600;
+  background: #f8fafc;
+  border: 1px solid #e2e8f0;
+  color: #1f2937;
+}
+
+.kitchen-ingredient-pill.is-extra {
+  background: #fef3f2;
+  border-color: #fecaca;
+  color: #991b1b;
+}
+
+.kitchen-status-pill {
+  display: inline-flex;
+  align-items: center;
+  padding: 2px 8px;
+  border-radius: 999px;
+  font-size: 11px;
+  font-weight: 600;
+  letter-spacing: 0.01em;
+  border: 1px solid transparent;
+  color: #344054;
+  background: #f2f4f7;
+}
+
+.kitchen-status-pill.assigned {
+  color: #1d4ed8;
+  background: #eff6ff;
+  border-color: #dbeafe;
+}
+
+.kitchen-status-pill.planned {
+  color: #1f2937;
+  background: #f8fafc;
+  border-color: #e2e8f0;
+}
+
+.kitchen-status-pill.active {
+  color: #027a48;
+  background: #ecfdf3;
+  border-color: #abefc6;
+}
+
+.kitchen-status-pill.inactive {
+  color: #b42318;
+  background: #fef3f2;
+  border-color: #fecaca;
+}
+
+.kitchen-inline-error {
+  margin: 4px 0 0;
+  font-size: 13px;
+  color: #b42318;
+}
+
+.kitchen-inline-warning {
+  padding: 10px 12px;
+  border-radius: 12px;
+  border: 1px solid #f9dbaf;
+  background: #fff7ed;
+  color: #9a3412;
+  font-weight: 600;
+  font-size: 14px;
+}
+
+.kitchen-ingredient-picker {
+  display: flex;
+  flex-direction: column;
+  gap: 16px;
+}
+
+.kitchen-ingredient-picker .kitchen-input {
+  font-size: 16px;
+  padding: 12px 14px;
+  border-radius: 14px;
+}
+
+.kitchen-ingredient-search {
+  gap: 8px;
+}
+
+.kitchen-chip-list {
+  display: flex;
+  flex-wrap: wrap;
+  gap: 10px 12px;
+  align-items: center;
+  margin-bottom: 8px;
+}
+
+.kitchen-chip-item {
+  display: inline-flex;
+  align-items: center;
+  gap: 8px;
+}
+
+.kitchen-chip {
+  display: inline-flex;
+  align-items: center;
+  gap: 8px;
+  padding: 8px 12px;
+  border-radius: 999px;
+  font-size: 15px;
+  font-weight: 600;
+  border: 1px solid transparent;
+  box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
+}
+
+.kitchen-chip-label {
+  line-height: 1.2;
+}
+
+.kitchen-chip.is-pending {
+  border-color: rgba(15, 23, 42, 0.12);
+}
+
+.kitchen-chip-remove {
+  border: none;
+  background: rgba(255, 255, 255, 0.6);
+  color: inherit;
+  width: 22px;
+  height: 22px;
+  border-radius: 999px;
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+  cursor: pointer;
+  font-size: 12px;
+  line-height: 1;
+}
+
+.kitchen-chip-action {
+  border: none;
+  background: #ffffff;
+  color: #1d2939;
+  padding: 6px 10px;
+  border-radius: 999px;
+  font-size: 13px;
+  font-weight: 600;
+  box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
+  cursor: pointer;
+}
+
+.kitchen-suggestion-list {
+  margin-top: 6px;
+  background: white;
+  border-radius: 16px;
+  border: 1px solid #e4e7ec;
+  box-shadow: 0 12px 30px rgba(15, 23, 42, 0.12);
+  padding: 6px;
+  display: flex;
+  flex-direction: column;
+  gap: 4px;
+}
+
+.kitchen-suggestion-list.is-scrollable {
+  max-height: 240px;
+  overflow-y: auto;
+}
+
+.kitchen-suggestion {
+  border: none;
+  background: transparent;
+  text-align: left;
+  padding: 10px 12px;
+  border-radius: 12px;
+  font-size: 15px;
+  font-weight: 600;
+  color: #101828;
+  cursor: pointer;
+}
+
+.kitchen-suggestion.is-assignee {
+  display: inline-flex;
+  align-items: center;
+  gap: 10px;
+}
+
+.kitchen-suggestion.is-create {
+  color: #4338ca;
+}
+
+.kitchen-suggestion-empty {
+  padding: 8px 10px;
+}
+
+.kitchen-suggestion:hover,
+.kitchen-suggestion:focus-visible {
+  background: #f2f4f7;
+  outline: none;
+}
+
+.kitchen-inline-panel {
+  margin-top: 8px;
+  border-radius: 16px;
+  border: 1px solid #e4e7ec;
+  background: #ffffff;
+  padding: 16px;
+  display: flex;
+  flex-direction: column;
+  gap: 16px;
+  box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
+}
+
+.kitchen-inline-header {
+  display: flex;
+  flex-direction: column;
+  gap: 4px;
+  font-size: 16px;
+}
+
+.kitchen-category-list {
+  display: flex;
+  flex-wrap: wrap;
+  gap: 10px;
+  margin-top: 6px;
+}
+
+.kitchen-category-option {
+  border: none;
+  background: transparent;
+  padding: 0;
+  position: relative;
+  cursor: pointer;
+}
+
+.kitchen-category-option .kitchen-chip {
+  padding-right: 26px;
+}
+
+.kitchen-category-option.selected .kitchen-chip {
+  border-color: rgba(15, 23, 42, 0.25);
+  box-shadow: 0 10px 24px rgba(15, 23, 42, 0.14);
+}
+
+.kitchen-category-check {
+  position: absolute;
+  top: -6px;
+  right: -4px;
+  width: 18px;
+  height: 18px;
+  border-radius: 999px;
+  background: #0f172a;
+  color: white;
+  font-size: 11px;
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+}
+
+.kitchen-inline-actions {
+  display: flex;
+  flex-wrap: wrap;
+  gap: 10px;
+}
+
+.kitchen-context-modal-backdrop {
+  position: fixed;
+  inset: 0;
+  background: rgba(15, 23, 42, 0.35);
+  display: flex;
+  align-items: center;
+  justify-content: center;
+  padding: 20px;
+  z-index: 60;
+}
+
+.kitchen-context-modal-backdrop.inner {
+  background: rgba(15, 23, 42, 0.2);
+  z-index: 70;
+}
+
+.kitchen-context-modal {
+  width: min(420px, 100%);
+  max-height: min(80vh, 560px);
+  background: #ffffff;
+  border-radius: 18px;
+  padding: 20px;
+  box-shadow: 0 20px 48px rgba(15, 23, 42, 0.18);
+  display: flex;
+  flex-direction: column;
+  gap: 16px;
+  overflow: hidden;
+}
+
+.kitchen-context-modal.small {
+  width: min(380px, 100%);
+}
+
+.kitchen-context-modal-header {
+  display: flex;
+  justify-content: space-between;
+  gap: 12px;
+}
+
+.kitchen-context-modal-header h4 {
+  margin: 0;
+  font-size: 18px;
+}
+
+.kitchen-context-modal-body {
+  display: flex;
+  flex-direction: column;
+  gap: 14px;
+  overflow-y: auto;
+  padding-right: 2px;
+}
+
+.kitchen-context-modal-actions {
+  display: flex;
+  flex-wrap: wrap;
+  gap: 12px;
+  justify-content: center;
+}
+
+.kitchen-color-grid {
+  display: flex;
+  flex-wrap: wrap;
+  gap: 10px;
+}
+
+.kitchen-color-option {
+  border: 1px solid transparent;
+  border-radius: 12px;
+  padding: 8px 12px;
+  background: #f2f4f7;
+  color: #101828;
+  font-weight: 600;
+  cursor: pointer;
+  min-height: 44px;
+}
+
+.kitchen-color-option.swatch {
+  width: 44px;
+  padding: 0;
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+  font-weight: 700;
+}
+
+.kitchen-color-option.selected {
+  border-color: rgba(15, 23, 42, 0.3);
+  box-shadow: 0 8px 18px rgba(15, 23, 42, 0.15);
+}
+
+.kitchen-day-feedback {
+  display: flex;
+  flex-direction: column;
+  gap: 4px;
+  margin-top: 12px;
+  font-size: 13px;
+  color: #667085;
+}
+
+.kitchen-day-feedback-text.saving {
+  color: #475467;
+}
+
+.kitchen-day-feedback-text.saved {
+  color: #027a48;
+}
+
+.kitchen-day-feedback-text.error {
+  color: #b42318;
+}
+
+.kitchen-toolbar {
+  display: flex;
+  flex-wrap: wrap;
+  gap: 12px;
+  align-items: center;
+  justify-content: space-between;
+  margin-top: 16px;
+}
+
+.kitchen-alert {
+  border-radius: 12px;
+  padding: 10px 12px;
+  font-weight: 600;
+  font-size: 14px;
+}
+
+.kitchen-alert.success {
+  background: #ecfdf3;
+  color: #027a48;
+  border: 1px solid #a6f4c5;
+}
+
+.kitchen-alert.error {
+  background: #fef3f2;
+  color: #b42318;
+  border: 1px solid #fecdca;
+}
+
+.kitchen-form {
+  display: flex;
+  flex-direction: column;
+  gap: 20px;
+}
+
+.kitchen-dish-form-card {
+  width: 100%;
+  max-width: 560px;
+  margin: 0 auto;
+}
+
+.kitchen-dish-ingredients {
+  gap: 10px;
+}
+
+.kitchen-table {
+  width: 100%;
+  border-collapse: collapse;
+}
+
+.kitchen-table th,
+.kitchen-table td {
+  text-align: left;
+  padding: 10px 8px;
+  border-bottom: 1px solid #eef2f6;
+  font-size: 14px;
+}
+
+@media (max-width: 600px) {
+  .kitchen-container {
+    padding: 16px;
+    padding-bottom: calc(96px + env(safe-area-inset-bottom, 0px));
+  }
+
+  .kitchen-grid {
+    grid-template-columns: 1fr;
+    gap: 16px;
+  }
+
+  .kitchen-week-mobile-frame {
+    width: calc(100% - 32px);
+    max-width: 420px;
+    margin: 0 auto;
+    gap: 16px;
+  }
+
+  .kitchen-week-carousel {
+    margin: 0;
+    width: 100%;
+  }
+
+  .kitchen-week-carousel-arrow {
+    display: none;
+  }
+
+  .kitchen-assign-day.is-occupied .kitchen-assign-day-status {
+    display: none;
+  }
+
+  .kitchen-week-days {
+    display: flex;
+    grid-template-columns: none;
+    overflow-x: auto;
+    scroll-snap-type: x mandatory;
+    scroll-behavior: smooth;
+    -webkit-overflow-scrolling: touch;
+    width: 100%;
+    gap: 0;
+    padding: 0 0 4px;
+    scroll-padding-inline: 0;
+  }
+
+  .kitchen-week-days::-webkit-scrollbar {
+    display: none;
+  }
+
+  .kitchen-week-days .kitchen-day-card {
+    flex: 0 0 100%;
+    scroll-snap-align: start;
+  }
+
+  .kitchen-week-carousel-dots {
+    display: flex;
+    width: 100%;
+  }
+
+  .kitchen-week-header {
+    flex-direction: column;
+    margin-bottom: 0;
+  }
+
+  .kitchen-week-header-actions {
+    width: 100%;
+    align-items: stretch;
+  }
+
+  .kitchen-week-nav {
+    --kitchen-week-nav-control-height: 42px;
+    gap: 8px;
+    max-width: 100%;
+  }
+
+  .kitchen-week-controls {
+    gap: 12px;
+    margin-bottom: 16px;
+  }
+
+  .kitchen-weekdays-strip {
+    order: 0;
+  }
+
+  .kitchen-week-mobile-frame {
+    order: 1;
+  }
+
+  .kitchen-week-picker {
+    width: 100%;
+  }
+
+  .kitchen-week-picker .kitchen-label {
+    display: none;
+  }
+
+  .kitchen-week-picker .kitchen-input {
+    font-size: 15px;
+  }
+
+  .kitchen-weekdays-strip {
+    padding: 12px;
+    overflow-x: hidden;
+  }
+
+  .kitchen-weekdays-arrow {
+    display: none;
+  }
+
+  .kitchen-weekdays-list {
+    display: grid;
+    grid-template-columns: repeat(5, minmax(0, 1fr));
+    gap: 6px;
+    width: 100%;
+    max-width: 100%;
+    overflow-x: hidden;
+    justify-items: stretch;
+  }
+
+  .kitchen-weekdays-list.is-carousel {
+    overflow-x: hidden;
+    scroll-snap-type: none;
+    padding: 0;
+    justify-content: initial;
+  }
+
+  .kitchen-weekdays-item {
+    min-width: 0;
+    width: 100%;
+    min-height: 72px;
+    padding: 6px 4px;
+    overflow: hidden;
+  }
+
+  .kitchen-weekdays-circle {
+    width: 44px;
+    height: 44px;
+    font-size: 12px;
+  }
+
+  .kitchen-weekdays-label {
+    font-size: 11px;
+    white-space: nowrap;
+    overflow: hidden;
+    text-overflow: ellipsis;
+    max-width: 100%;
+  }
+
+  .kitchen-topbar {
+    display: none;
+  }
+
+  .kitchen-nav-desktop {
+    display: none;
+  }
+
+  .kitchen-user {
+    display: none;
+  }
+
+  .kitchen-user-placeholder {
+    display: none;
+  }
+
+  .kitchen-nav-toggle {
+    display: none;
+  }
+
+  .kitchen-drawer,
+  .kitchen-drawer-backdrop {
+    display: none;
+  }
+
+  .kitchen-dishes-header {
+    align-items: flex-start;
+  }
+
+  .kitchen-dishes-header .kitchen-button {
+    width: 100%;
+  }
+
+  .kitchen-dish-card {
+    flex-direction: column;
+    align-items: flex-start;
+  }
+
+  .kitchen-dish-actions {
+    width: 100%;
+    justify-content: flex-end;
+  }
+
+  .kitchen-modal {
+    padding: 20px;
+    max-height: 92vh;
+  }
+
+  .kitchen-context-modal-backdrop {
+    align-items: flex-end;
+  }
+
+  .kitchen-context-modal {
+    width: 100%;
+    border-radius: 18px 18px 0 0;
+    max-height: 85vh;
+  }
+
+  .kitchen-bottom-nav {
+    display: block;
+  }
+
+  .kitchen-bottom-nav-label {
+    font-size: 11px;
+  }
+}
+
+@media (max-width: 360px) {
+  .kitchen-bottom-nav-label {
+    font-size: 10px;
+  }
+}
+
+@media (min-width: 900px) {
+  .kitchen-day-empty-button {
+    max-width: 280px;
+  }
+
+  .kitchen-modal-actions {
+    flex-direction: row;
+  }
+}
+
+
+.kitchen-ui-card {
+  background: var(--hf-surface);
+  border-radius: var(--hf-radius-lg);
+  padding: 24px;
+  box-shadow: var(--hf-shadow-soft);
+  display: flex;
+  flex-direction: column;
+  gap: 16px;
+}
+
+.kitchen-ui-button {
+  border: none;
+  border-radius: 999px;
+  background: var(--hf-brand);
+  color: #fff;
+  padding: 12px 16px;
+  font-weight: 700;
+  cursor: pointer;
+}
+
+.kitchen-ui-button:disabled {
+  opacity: 0.65;
+  cursor: not-allowed;
+}
+
+.kitchen-ui-button-secondary {
+  background: var(--hf-surface-soft);
+  color: var(--hf-text);
+  border: 1px solid var(--hf-border);
+}
+
+.kitchen-ui-button-ghost {
+  background: transparent;
+  border: 1px solid var(--hf-border);
+  color: var(--hf-text);
+}
+
+.kitchen-ui-input-group {
+  display: grid;
+  gap: 6px;
+}
+
+.kitchen-ui-input {
+  border: 1px solid var(--hf-border);
+  border-radius: var(--hf-radius-md);
+  padding: 11px 12px;
+  font-size: 14px;
+  background: #fff;
+}
+
+.kitchen-ui-input:focus-visible {
+  outline: 2px solid color-mix(in srgb, var(--hf-brand) 35%, white);
+  outline-offset: 1px;
+}
+
+.kitchen-ui-badge {
+  border-radius: 999px;
+  padding: 4px 10px;
+  font-size: 12px;
+  font-weight: 600;
+}
+
+.kitchen-ui-badge-default { background: #eef2ff; color: #3730a3; }
+.kitchen-ui-badge-success { background: var(--hf-surface-mint); color: #0f7a3d; }
+.kitchen-ui-badge-warning { background: var(--hf-surface-peach); color: #9a580a; }
+
+.kitchen-ui-header,
+.kitchen-ui-bottom-nav {
+  backdrop-filter: blur(12px);
+  -webkit-backdrop-filter: blur(12px);
+  background: var(--hf-glass);
+}
+
+.kitchen-ui-header {
+  position: sticky;
+  top: 0;
+  z-index: 20;
+  border-bottom: 1px solid var(--hf-glass-border);
+}
+
+.kitchen-ui-header-inner {
+  max-width: 1100px;
+  margin: 0 auto;
+  padding: 16px 24px;
+  display: flex;
+  justify-content: space-between;
+  align-items: center;
+  gap: 16px;
+}
+
+.kitchen-ui-bottom-nav {
+  position: fixed;
+  left: 0;
+  right: 0;
+  bottom: 0;
+  z-index: 25;
+  padding: 10px 12px calc(12px + env(safe-area-inset-bottom, 0px));
+  border-top: 1px solid var(--hf-glass-border);
+  display: none;
+}
+
+.kitchen-login-wrap {
+  max-width: 560px;
+  min-height: 100vh;
+  min-height: 100dvh;
+  display: grid;
+  place-items: center;
+  padding-top: 24px;
+  padding-bottom: 24px;
+}
+
+.kitchen-login-card {
+  width: min(100%, 460px);
+  border-radius: 30px;
+  padding: clamp(22px, 5vw, 34px);
+  background: rgba(248, 250, 252, 0.88);
+  border: 1px solid rgba(228, 231, 236, 0.72);
+  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
+}
+
+.kitchen-login-badge {
+  display: grid;
+  place-items: center;
+  margin-top: 4px;
+}
+
+.kitchen-login-brand {
+  margin: 0;
+  text-align: center;
+  color: #4338ca;
+  font-size: 1rem;
+  font-weight: 700;
+  letter-spacing: 0.02em;
+}
+
+.kitchen-login-badge-icon {
+  width: 88px;
+  height: 88px;
+  border-radius: 999px;
+  display: grid;
+  place-items: center;
+  background: #f8fafc;
+  box-shadow: 0 0 0 10px rgba(255, 255, 255, 0.9), 0 0 30px rgba(67, 56, 202, 0.14);
+}
+
+.kitchen-login-icon {
+  width: 40px;
+  height: 40px;
+  object-fit: contain;
+}
+
+@media (min-width: 768px) {
+  .kitchen-brand-icon {
+    display: none;
+  }
+
+  .kitchen-brand-logo {
+    display: block;
+  }
+}
+
+.kitchen-login-title {
+  margin: 8px 0 0;
+  text-align: center;
+  font-size: clamp(2rem, 7vw, 2.8rem);
+  font-weight: 700;
+  letter-spacing: -0.02em;
+}
+
+.kitchen-login-subtitle {
+  margin: 0;
+  text-align: center;
+  color: #98a2b3;
+  font-size: clamp(0.95rem, 3vw, 1.1rem);
+}
+
+.kitchen-login-form {
+  margin-top: 10px;
+  display: grid;
+  gap: 14px;
+}
+
+.kitchen-login-fields {
+  display: grid;
+  gap: 14px;
+  border-radius: 30px;
+  background: rgba(255, 255, 255, 0.62);
+  border: 1px solid rgba(228, 231, 236, 0.6);
+  padding: clamp(16px, 5vw, 24px);
+}
+
+.kitchen-login-label {
+  font-size: 0.78rem;
+  color: #98a2b3;
+  font-weight: 700;
+  letter-spacing: 0.06em;
+}
+
+.kitchen-login-input-wrap {
+  position: relative;
+  display: flex;
+  align-items: center;
+}
+
+.kitchen-login-input-icon {
+  width: 18px;
+  height: 18px;
+  color: #98a2b3;
+}
+
+.kitchen-login-input-wrap > .kitchen-login-input-icon {
+  position: absolute;
+  left: 16px;
+  top: 50%;
+  transform: translateY(-50%);
+  pointer-events: none;
+}
+
+.kitchen-ui-input.kitchen-login-input {
+  width: 100%;
+  padding: 15px 16px;
+  padding-left: 52px;
+  border-radius: 999px;
+  border-color: transparent;
+  background: #f8fafc;
+  color: #334155;
+  font-size: 16px;
+  line-height: 1.3;
+  font-weight: 500;
+}
+
+.kitchen-ui-input.kitchen-login-input::placeholder {
+  color: #94a3b8;
+  font-weight: 400;
+}
+
+.kitchen-login-input:focus-visible {
+  border-color: #4338ca;
+  outline: 2px solid rgba(67, 56, 202, 0.2);
+  outline-offset: 1px;
+}
+
+.kitchen-ui-input.kitchen-login-password-input {
+  padding-right: 52px;
+}
+
+.kitchen-login-eye {
+  position: absolute;
+  right: 16px;
+  top: 50%;
+  transform: translateY(-50%);
+  border: none;
+  background: transparent;
+  padding: 6px;
+  border-radius: 999px;
+  display: grid;
+  place-items: center;
+}
+
+.kitchen-login-forgot-row {
+  display: flex;
+  justify-content: flex-end;
+}
+
+.kitchen-login-link {
+  border: none;
+  background: transparent;
+  color: #4338ca;
+  font-weight: 600;
+  font-size: 0.95rem;
+  padding: 0;
+  cursor: pointer;
+}
+
+.kitchen-login-submit {
+  min-height: 54px;
+  font-size: 1.08rem;
+}
+
+.kitchen-login-divider {
+  display: flex;
+  align-items: center;
+  justify-content: center;
+  color: #98a2b3;
+  font-size: 0.78rem;
+  font-weight: 700;
+  letter-spacing: 0.08em;
+  gap: 10px;
+}
+
+.kitchen-login-divider::before,
+.kitchen-login-divider::after {
+  content: "";
+  height: 1px;
+  flex: 1;
+  background: #e4e7ec;
+}
+
+.kitchen-login-socials {
+  display: grid;
+  grid-template-columns: repeat(2, minmax(0, 1fr));
+  gap: 10px;
+}
+
+.kitchen-login-social-button {
+  border-radius: 999px;
+  border: 1px solid var(--hf-border);
+  min-height: 46px;
+  background: rgba(255, 255, 255, 0.8);
+  color: #344054;
+  font-weight: 600;
+  font-size: 1rem;
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+  gap: 10px;
+}
+
+.kitchen-login-social-icon {
+  width: 18px;
+  height: 18px;
+  line-height: 1;
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+  flex-shrink: 0;
+}
+
+.kitchen-login-social-svg {
+  width: 100%;
+  height: 100%;
+}
+
+.kitchen-login-social-svg-apple {
+  color: #111827;
+}
+
+.kitchen-login-footer {
+  margin: 0;
+  text-align: center;
+  color: #98a2b3;
+  font-size: 1rem;
+}
+
+.kitchen-login-error {
+  color: var(--hf-danger);
+  text-align: center;
+}
+
+.kitchen-ui-bottom-nav-inner {
+  max-width: 720px;
+  margin: 0 auto;
+  display: grid;
+  grid-template-columns: repeat(4, minmax(0, 1fr));
+  gap: 8px;
+}
+
+.kitchen-ui-bottom-nav-item {
+  display: flex;
+  flex-direction: column;
+  align-items: center;
+  color: var(--hf-muted);
+  gap: 4px;
+  border-radius: 14px;
+  padding: 8px 6px;
+  text-decoration: none;
+  font-size: 12px;
+  font-weight: 600;
+}
+
+.kitchen-ui-bottom-nav-item.active {
+  background: #eef2ff;
+  color: var(--hf-brand-strong);
+}
+
+.kitchen-ui-avatar-stack { display: flex; }
+.kitchen-ui-avatar {
+  width: 30px;
+  height: 30px;
+  border-radius: 999px;
+  display: grid;
+  place-items: center;
+  background: #eef2ff;
+  border: 2px solid white;
+  margin-left: -8px;
+  font-size: 12px;
+  font-weight: 700;
+}
+
+.kitchen-ui-avatar:first-child { margin-left: 0; }
+
+.kitchen-ui-fab {
+  position: fixed;
+  bottom: 82px;
+  right: 20px;
+  width: 56px;
+  height: 56px;
+  border-radius: 999px;
+  border: none;
+  background: var(--hf-brand);
+  color: #fff;
+  box-shadow: var(--hf-shadow-glass);
+}
+
+.kitchen-ui-sheet-backdrop {
+  position: fixed;
+  inset: 0;
+  background: rgba(16, 24, 40, 0.45);
+  z-index: 45;
+  display: grid;
+  place-items: end center;
+}
+
+.kitchen-ui-sheet {
+  width: min(720px, 100%);
+  background: #fff;
+  border-radius: var(--hf-radius-xl) var(--hf-radius-xl) 0 0;
+  padding: 24px;
+}
+
+.kitchen-ui-sheet-actions { margin-top: 16px; display: flex; gap: 12px; justify-content: flex-end; }
+
+@media (max-width: 900px) {
+  .kitchen-ui-bottom-nav { display: block; }
+}
+
+/* Neo-Soft 2026 global harmonization */
+.kitchen-container {
+  width: min(1120px, 100%);
+  padding: 20px;
+  margin: 0 auto;
+  max-width: 100%;
+}
+
+.kitchen-ui-card,
+.kitchen-card,
+.kitchen-dish-card,
+.kitchen-inline-panel,
+.kitchen-modal,
+.kitchen-context-modal,
+.kitchen-day-card,
+.kitchen-weekdays-strip {
+  border-radius: var(--hf-radius-lg);
+  box-shadow: var(--hf-shadow-soft);
+  border: 1px solid var(--hf-border);
+  background: var(--hf-surface);
+}
+
+.kitchen-day-card.is-empty,
+.kitchen-dish-card.is-sidedish,
+.kitchen-ui-button-secondary,
+.kitchen-button.secondary,
+.kitchen-status-pill.planned,
+.kitchen-tab-button.is-active {
+  background: var(--hf-surface-soft);
+}
+
+.kitchen-ui-button,
+.kitchen-button,
+.kitchen-assignee-button,
+.kitchen-weekdays-arrow,
+.kitchen-assign-week-nav,
+.kitchen-color-option,
+.kitchen-chip-action {
+  border-radius: 999px;
+  min-height: 44px;
+  transition: transform 180ms ease, box-shadow 180ms ease, background 180ms ease, color 180ms ease;
+}
+
+.kitchen-ui-button,
+.kitchen-button {
+  background: var(--hf-brand);
+  color: #fff;
+  box-shadow: var(--hf-shadow-soft);
+}
+
+.kitchen-ui-button:hover,
+.kitchen-button:hover {
+  background: var(--hf-brand-strong);
+  transform: translateY(-1px);
+}
+
+.kitchen-ui-button-secondary,
+.kitchen-button.secondary {
+  border: 1px solid var(--hf-border);
+  color: var(--hf-text);
+}
+
+.kitchen-ui-button-ghost,
+.kitchen-button.ghost {
+  background: transparent;
+  border: 1px solid var(--hf-border);
+  color: var(--hf-text);
+}
+
+.kitchen-ui-input,
+.kitchen-input,
+.kitchen-select,
+.kitchen-textarea {
+  border-radius: var(--hf-radius-md);
+  border: 1px solid var(--hf-border);
+  min-height: 48px;
+  padding: 11px 14px;
+}
+
+.kitchen-topbar,
+.kitchen-bottom-nav,
+.kitchen-ui-header,
+.kitchen-ui-bottom-nav {
+  background: var(--hf-glass);
+  border-color: var(--hf-glass-border);
+  backdrop-filter: blur(12px);
+  -webkit-backdrop-filter: blur(12px);
+}
+
+.kitchen-brand-link,
+.kitchen-title,
+.kitchen-login-title,
+.kitchen-day-title,
+.kitchen-dishes-header h2 {
+  color: var(--hf-text);
+}
+
+.kitchen-toolbar-search {
+  max-width: 340px;
+}
+
+.kitchen-block-gap {
+  margin-bottom: 16px;
+}
+
+.kitchen-title-no-margin {
+  margin-top: 0;
+  margin-bottom: 6px;
+}
+
+.kitchen-form-compact {
+  gap: 12px;
+}
+
+.kitchen-table th,
+.kitchen-table td {
+  border-bottom: 1px solid var(--hf-border);
+}
+
+@media (min-width: 900px) {
+  .kitchen-grid {
+    grid-template-columns: repeat(2, minmax(0, 1fr));
+  }
+}
+
+/* Semana Neo-Soft 2026 redesign */
+.kitchen-ui-header {
+  background: #eef2ff;
+  border-bottom: 1px solid #dbe3ff;
+}
+
+.kitchen-ui-header-inner {
+  min-height: 88px;
+  padding: 20px 24px;
+}
+
+.kitchen-brand-icon {
+  width: 36px;
+  height: 36px;
+}
+
+.kitchen-nav-desktop {
+  gap: 10px;
+}
+
+.kitchen-nav-desktop a {
+  border-radius: 14px;
+  padding: 11px 18px;
+  font-size: 14px;
+  background: transparent;
+}
+
+.kitchen-nav-desktop a.active {
+  background: #dfe4ff;
+  color: #3730a3;
+}
+
+.kitchen-user { position: relative; }
+
+.kitchen-user-chip {
+  display: inline-flex;
+  align-items: center;
+  gap: 10px;
+  border: 1px solid #dbe3ff;
+  background: #ffffff;
+  border-radius: 999px;
+  padding: 7px 14px 7px 8px;
+  cursor: pointer;
+  box-shadow: 0 4px 14px rgba(79, 70, 229, 0.12);
+}
+
+.kitchen-user-chip:hover { background: #f8faff; }
+
+.kitchen-user-avatar {
+  width: 34px;
+  height: 34px;
+  border-radius: 999px;
+  display: grid;
+  place-items: center;
+  background: #dfe4ff;
+  color: #3730a3;
+  font-weight: 700;
+  font-size: 12px;
+}
+
+.kitchen-user-name { font-weight: 600; font-size: 14px; }
+.kitchen-user-chevron,
+.kitchen-user-menu-icon {
+  width: 16px;
+  height: 16px;
+  stroke: currentColor;
+  stroke-width: 1.8;
+  fill: none;
+}
+
+.kitchen-user-menu {
+  position: absolute;
+  right: 0;
+  top: calc(100% + 10px);
+  min-width: 220px;
+  background: rgba(255, 255, 255, 0.96);
+  border: 1px solid #e6e9f8;
+  box-shadow: 0 16px 30px rgba(30, 41, 59, 0.14);
+  border-radius: 20px;
+  padding: 8px;
+  display: grid;
+  gap: 4px;
+  z-index: 30;
+}
+
+.kitchen-user-menu button {
+  border: none;
+  background: transparent;
+  border-radius: 14px;
+  padding: 10px 12px;
+  display: flex;
+  align-items: center;
+  gap: 10px;
+  font-weight: 600;
+  color: #334155;
+  cursor: pointer;
+}
+
+.kitchen-user-menu button:hover { background: #eef2ff; }
+
+.kitchen-weekdays-item {
+  min-width: 76px;
+  min-height: 96px;
+  border-radius: 20px;
+}
+
+.kitchen-weekdays-circle {
+  width: 56px;
+  height: 56px;
+  border-radius: 20px;
+}
+
+.kitchen-weekdays-label {
+  font-size: 13px;
+}
+
+.kitchen-day-card {
+  background: var(--day-card-bg, #fff);
+  color: var(--day-card-text, var(--hf-text));
+}
+
+.kitchen-day-title,
+.kitchen-day-info-value,
+.kitchen-day-info-label {
+  color: inherit;
+}
+
+.kitchen-day-empty-button {
+  border-radius: 18px;
+  min-height: 50px;
+}
+
+.kitchen-week-mobile-frame { gap: 22px; }
+
+.kitchen-ui-bottom-nav {
+  background: #eef2ff;
+  border-top: 1px solid #dbe3ff;
+}
+
+@media (max-width: 900px) {
+  .kitchen-ui-header { display: none; }
+  .kitchen-container {
+    padding: 14px 14px 88px;
+  }
+}
+
+.kitchen-user-menu-household {
+  display: flex;
+  flex-direction: column;
+  gap: 6px;
+  padding: 8px 10px;
+}
+
+.kitchen-user-menu-household span {
+  font-size: 12px;
+  color: #64748b;
+}
+
+
+
+.shopping-page-shell {
+  background: linear-gradient(180deg, #f4f6ff 0%, #eef0ff 100%);
+  border-radius: 28px;
+  padding: 14px;
+}
+
+.shopping-main-card {
+  margin: 0 auto;
+  max-width: 920px;
+  border-radius: 24px;
+  padding: 18px;
+  box-shadow: 0 18px 40px rgba(76, 81, 169, 0.15);
+  background: rgba(249, 250, 255, 0.88);
+}
+
+.shopping-header-card {
+  margin-bottom: 18px;
+}
+
+.shopping-header-row {
+  display: flex;
+  justify-content: space-between;
+  align-items: center;
+  gap: 12px;
+}
+
+.shopping-header-row h1 {
+  margin: 0;
+  color: #27336a;
+  font-size: clamp(1.1rem, 2.5vw, 1.6rem);
+  line-height: 1.2;
+}
+
+.shopping-week-nav {
+  margin-top: 12px;
+  width: 100%;
+  max-width: 420px;
+  margin-inline: auto;
+}
+
+.shopping-week-nav .kitchen-week-picker .kitchen-input {
+  background: linear-gradient(180deg, #ffffff 0%, #f4f7ff 100%);
+  border-radius: 14px;
+  border: 1px solid rgba(188, 201, 244, 0.8);
+  box-shadow: 0 8px 16px rgba(88, 100, 167, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.95);
+}
+
+.shopping-refresh-icon {
+  border: 1px solid var(--hf-border);
+  background: rgba(255, 255, 255, 0.8);
+  border-radius: 14px;
+  width: 36px;
+  height: 36px;
+  cursor: pointer;
+}
+
+.shopping-toolbar {
+  margin-top: 14px;
+  display: flex;
+  flex-wrap: wrap;
+  justify-content: center;
+  align-items: center;
+  gap: 10px;
+}
+
+.shopping-toolbar-alerts {
+  display: grid;
+  gap: 10px;
+  margin: 14px 0 18px;
+}
+
+.shopping-store-select {
+  width: min(320px, 100%);
+  border-radius: 14px;
+  min-height: 44px;
+  padding-right: 36px;
+  border: 1px solid rgba(190, 201, 234, 0.92);
+  background: linear-gradient(180deg, #fdfdff 0%, #f3f6ff 100%);
+  box-shadow: 0 8px 16px rgba(79, 94, 170, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.95);
+  color: #1f2a58;
+  font-weight: 500;
+  transition: border-color 160ms ease, box-shadow 160ms ease, background 160ms ease;
+}
+
+.shopping-store-select:hover,
+.shopping-store-select-compact:hover {
+  border-color: rgba(140, 156, 218, 0.95);
+}
+
+.shopping-store-select:focus-visible,
+.shopping-store-select-compact:focus-visible {
+  outline: none;
+  border-color: rgba(99, 102, 241, 0.75);
+  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2), 0 10px 20px rgba(79, 94, 170, 0.16);
+}
+
+.shopping-toolbar-alert {
+  margin: 0;
+}
+
+.shopping-bulk-actions {
+  display: flex;
+  justify-content: flex-end;
+}
+
+.shopping-bulk-button {
+  min-height: 34px;
+  padding: 7px 12px;
+  font-size: 13px;
+}
+
+.shopping-tabs {
+  margin-top: 12px;
+  display: flex;
+  gap: 8px;
+}
+
+.shopping-tab {
+  border: 1px solid var(--hf-border);
+  background: #fff;
+  border-radius: 999px;
+  padding: 8px 12px;
+  cursor: pointer;
+}
+
+.shopping-tab.active {
+  background: var(--hf-surface-soft);
+  border-color: var(--hf-brand);
+}
+
+.shopping-categories {
+  display: grid;
+  gap: 14px;
+}
+
+
+.shopping-quick-add {
+  border-radius: 16px;
+  padding: 10px;
+  border: 1px solid rgba(190, 201, 234, 0.82);
+  background: linear-gradient(180deg, #ffffff 0%, #f4f7ff 100%);
+  box-shadow: 0 8px 16px rgba(79, 94, 170, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.95);
+}
+
+.shopping-quick-add-row {
+  display: flex;
+  gap: 8px;
+  align-items: center;
+}
+
+.shopping-quick-add-input {
+  min-height: 42px;
+}
+
+.shopping-quick-category {
+  width: min(180px, 42vw);
+  min-height: 42px;
+  border-radius: 12px;
+}
+
+.shopping-quick-suggestions {
+  margin-top: 8px;
+  display: grid;
+  gap: 6px;
+}
+
+.shopping-quick-create {
+  justify-self: flex-start;
+}
+
+.shopping-category-card {
+  border-radius: 18px;
+  padding: 14px;
+  box-shadow: 0 8px 20px rgba(79, 70, 229, 0.08);
+  background: color-mix(in srgb, var(--category-bg, #f8fafc) 65%, #fff);
+  border: 1px solid color-mix(in srgb, var(--category-text, #64748b) 16%, #fff);
+}
+
+.shopping-category-head {
+  display: flex;
+  align-items: center;
+  justify-content: space-between;
+  gap: 10px;
+  margin-bottom: 10px;
+}
+
+.shopping-category-head h4 {
+  margin: 0;
+  color: var(--category-text, var(--hf-text));
+  letter-spacing: 0.04em;
+  font-size: 12px;
+}
+
+.shopping-category-count {
+  border-radius: 999px;
+  padding: 4px 10px;
+  font-size: 12px;
+  font-weight: 700;
+  color: #fff;
+  background: color-mix(in srgb, var(--category-text, #475569) 75%, #1e293b);
+}
+
+.shopping-items-list {
+  display: grid;
+  gap: 9px;
+}
+
+.shopping-item {
+  display: flex;
+  align-items: center;
+  gap: 10px;
+  padding: 10px 12px;
+  border-radius: 14px;
+  background: #fff;
+  border: 1px solid rgba(210, 218, 255, 0.75);
+  transition: transform 220ms ease, opacity 220ms ease, background 220ms ease, box-shadow 220ms ease;
+}
+
+.shopping-item.is-leaving {
+  opacity: 0;
+  transform: translateX(8px) scale(0.98);
+}
+
+.shopping-item.is-entering {
+  animation: shoppingEnter 240ms ease;
+}
+
+.shopping-item-text {
+  font-weight: 500;
+  color: #1f2a58;
+  position: relative;
+}
+
+.shopping-item.purchased .shopping-item-text::after {
+  content: "";
+  position: absolute;
+  left: 0;
+  top: 53%;
+  width: 100%;
+  height: 1.5px;
+  background: rgba(100, 116, 139, 0.9);
+  transform-origin: left;
+  animation: shoppingStrike 220ms ease forwards;
+}
+
+.shopping-item.purchased .shopping-item-text {
+  color: var(--hf-muted);
+}
+
+.shopping-item-amount {
+  margin-left: auto;
+  padding: 4px 8px;
+  border-radius: 999px;
+  font-size: 12px;
+  font-weight: 700;
+  color: #334155;
+  background: #edf1ff;
+}
+
+.shopping-check {
+  width: 28px;
+  height: 28px;
+  border-radius: 999px;
+  border: 2px solid color-mix(in srgb, var(--category-text, #64748b) 32%, #fff);
+  background: transparent;
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+  cursor: pointer;
+  transition: transform 200ms ease, background 200ms ease, border-color 200ms ease;
+}
+
+.shopping-check:hover {
+  transform: scale(1.06);
+}
+
+.shopping-check-dot {
+  color: #fff;
+  font-size: 14px;
+  line-height: 1;
+  opacity: 0;
+  transform: scale(0.6);
+  transition: opacity 200ms ease, transform 220ms cubic-bezier(.2,.85,.3,1.3);
+}
+
+.shopping-check.is-checked {
+  background: var(--hf-brand);
+  border-color: var(--hf-brand);
+}
+
+.shopping-check.is-checked .shopping-check-dot {
+  opacity: 1;
+  transform: scale(1);
+}
+
+.shopping-check:active {
+  transform: scale(0.95);
+}
+
+
+.shopping-remove-item {
+  width: 26px;
+  height: 26px;
+  border-radius: 999px;
+  border: 1px solid rgba(160, 174, 214, 0.72);
+  background: rgba(255, 255, 255, 0.9);
+  color: #6b7280;
+  display: inline-flex;
+  align-items: center;
+  justify-content: center;
+  cursor: pointer;
+  transition: background 150ms ease, border-color 150ms ease, transform 150ms ease;
+}
+
+.shopping-remove-item:hover {
+  background: #f8fafc;
+  border-color: rgba(99, 102, 241, 0.5);
+  color: #4f46e5;
+}
+
+.shopping-remove-item:active {
+  transform: scale(0.94);
+}
+
+.shopping-remove-item svg {
+  width: 14px;
+  height: 14px;
+}
+
+.shopping-purchased-card h4 {
+  margin: 2px 0 10px;
+  font-size: 14px;
+  color: #64748b;
+  font-weight: 400;
+}
+
+.shopping-purchased-card h4 span {
+  color: #334155;
+  font-weight: 600;
+}
+
+.shopping-purchased-card h4 em {
+  color: #4f46e5;
+  font-style: normal;
+}
+
+.shopping-items-list-purchased .shopping-item {
+  align-items: center;
+}
+
+.shopping-empty-state {
+  display: grid;
+  place-items: center;
+  gap: 8px;
+  border-radius: 18px;
+  padding: 32px 18px;
+  color: #64748b;
+  background: rgba(255, 255, 255, 0.62);
+  border: 1px solid rgba(199, 210, 254, 0.8);
+}
+
+.shopping-empty-state svg {
+  width: 32px;
+  height: 32px;
+  color: #94a3b8;
+}
+
+.shopping-empty-state h4 {
+  margin: 0;
+  font-size: 15px;
+  font-weight: 500;
+}
+
+@keyframes shoppingEnter {
+  0% {
+    opacity: 0;
+    transform: translateY(6px) scale(0.98);
+  }
+  70% {
+    opacity: 1;
+    transform: translateY(0) scale(1.01);
+  }
+  100% {
+    transform: translateY(0) scale(1);
+  }
+}
+
+.shopping-store-select-compact {
+  width: auto;
+  min-width: 150px;
+  max-width: 220px;
+  min-height: 36px;
+  padding-right: 28px;
+  font-size: 13px;
+  border-radius: 12px;
+  border: 1px solid rgba(190, 201, 234, 0.92);
+  background: linear-gradient(180deg, #ffffff 0%, #f5f7ff 100%);
+  box-shadow: 0 6px 14px rgba(79, 94, 170, 0.09), inset 0 1px 0 rgba(255, 255, 255, 0.95);
+}
+
+
+@media (max-width: 390px) {
+  .kitchen-week-nav {
+    --kitchen-week-nav-control-height: 40px;
+    gap: 8px;
+  }
+
+  .kitchen-week-picker .kitchen-input {
+    font-size: 14px;
+    padding-inline: 10px;
+  }
+}
+@keyframes shoppingStrike {
+  from { transform: scaleX(0); }
+  to { transform: scaleX(1); }
+}
+
+@media (max-width: 900px) {
+  .shopping-page-shell {
+    border-radius: 22px;
+    padding: 10px;
+  }
+
+  .shopping-main-card {
+    padding: 14px;
+    border-radius: 20px;
+  }
+
+  .shopping-toolbar {
+    flex-direction: column;
+    align-items: stretch;
+  }
+
+  .shopping-quick-add-row {
+    flex-wrap: wrap;
+  }
+
+  .shopping-quick-category {
+    width: 100%;
+  }
+
+  .shopping-toolbar-alerts {
+    margin-top: 12px;
+  }
+
+  .shopping-store-select {
+    width: 100%;
+  }
+
+  .shopping-store-select-compact {
+    min-width: 118px;
+    margin-left: auto;
+  }
+}
+.kitchen-week-arrow {
+  border-radius: 14px;
+}
diff --git a/frontend/src/kitchen/pages/ShoppingPage.jsx b/frontend/src/kitchen/pages/ShoppingPage.jsx
index 36eac1c69f04eb3c58258ec1172d4802db01d24c..ce302fcd8eaddbc99a37b1979246399969319390 100644
--- a/frontend/src/kitchen/pages/ShoppingPage.jsx
+++ b/frontend/src/kitchen/pages/ShoppingPage.jsx
@@ -1,545 +1,588 @@
-import React, { useEffect, useMemo, useRef, useState } from "react";
-import KitchenLayout from "../Layout.jsx";
-import { ApiRequestError, apiRequest } from "../api.js";
-import { useAuth } from "../auth";
-import { useActiveWeek } from "../weekContext.jsx";
-import WeekNavigator from "../components/ui/WeekNavigator.jsx";
-
-function RefreshIcon(props) {
-  return (
-    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" {...props}>
-      <path d="M20 12a8 8 0 1 1-2.343-5.657" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round"/>
-      <path d="M20 4v4h-4" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round"/>
-    </svg>
-  );
-}
-
-function EmptyStateIcon(props) {
-  return (
-    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" {...props}>
-      <path d="M4 7.5h16" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" />
-      <path d="M6.5 7.5V6a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v1.5" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" />
-      <path d="M7.5 10.5h9l-.75 7.1a2 2 0 0 1-1.99 1.8H10.24a2 2 0 0 1-1.99-1.8z" stroke="currentColor" strokeWidth="1.8" strokeLinejoin="round" />
-    </svg>
-  );
-}
-
-function EmptyCheckIcon(props) {
-  return (
-    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" {...props}>
-      <path d="M7 12.5 10.5 16 17.5 9" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" />
-      <path d="M12 21a9 9 0 1 0-9-9" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" />
-    </svg>
-  );
-}
-
-function EmptyListIcon(props) {
-  return (
-    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" {...props}>
-      <path d="M8 7h10M8 12h10M8 17h10" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" />
-      <circle cx="5" cy="7" r="1" fill="currentColor" />
-      <circle cx="5" cy="12" r="1" fill="currentColor" />
-      <circle cx="5" cy="17" r="1" fill="currentColor" />
-    </svg>
-  );
-}
-
-function EmptyHistoryIcon(props) {
-  return (
-    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" {...props}>
-      <path d="M12 7.5v5l3 1.8" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" />
-      <path d="M3.8 12a8.2 8.2 0 1 0 2.4-5.8" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" />
-      <path d="M3.5 5.7v2.9h2.9" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" />
-    </svg>
-  );
-}
-
-function addDaysToISO(iso, days) {
-  const date = new Date(`${iso}T00:00:00Z`);
-  date.setUTCDate(date.getUTCDate() + days);
-  return date.toISOString().slice(0, 10);
-}
-
-function normalizeWeekStartInput(value) {
-  if (!value) return "";
-  const d = new Date(`${value}T00:00:00Z`);
-  const day = d.getUTCDay();
-  const diff = (day === 0 ? -6 : 1) - day;
-  d.setUTCDate(d.getUTCDate() + diff);
-  return d.toISOString().slice(0, 10);
-}
-
-function formatWeekTitle(iso) {
-  if (!iso) return "";
-  return new Date(`${iso}T00:00:00Z`).toLocaleDateString("es-ES", {
-    day: "2-digit",
-    month: "2-digit",
-    year: "numeric"
-  });
-}
-
-function formatTripDate(value) {
-  if (!value || value === "sin-fecha") return "Sin fecha";
-  return new Date(`${value}T00:00:00Z`).toLocaleDateString("es-ES", { day: "2-digit", month: "2-digit", year: "numeric" });
-}
-
-function slugColor(slug = "") {
-  const normalized = String(slug || "otros");
-  const seed = normalized.split("").reduce((acc, char) => acc + char.charCodeAt(0), 0);
-  const hue = seed % 360;
-  return {
-    colorBg: `hsl(${hue} 70% 95%)`,
-    colorText: `hsl(${hue} 55% 35%)`
-  };
-}
-
-function itemKey(item) {
-  return `${item.ingredientId || "no-id"}-${item.canonicalName}`;
-}
-
-function normalizeQuery(value = "") {
-  return String(value).trim().toLowerCase();
-}
-
-export default function ShoppingPage() {
-  const { user } = useAuth();
-  const { activeWeek: weekStart, setActiveWeek: setWeekStart } = useActiveWeek();
-  const [tab, setTab] = useState("pending");
-  const [error, setError] = useState("");
-  const [success, setSuccess] = useState("");
-  const [isRefreshing, setIsRefreshing] = useState(false);
-  const [stores, setStores] = useState([]);
-  const [selectedStoreId, setSelectedStoreId] = useState("");
-  const selectedStoreRef = useRef("");
-  const [pendingByCategory, setPendingByCategory] = useState(null);
-  const [purchasedByStoreDay, setPurchasedByStoreDay] = useState(null);
-  const [transitioningItemKey, setTransitioningItemKey] = useState(null);
-  const [recentlyMovedItemKey, setRecentlyMovedItemKey] = useState(null);
-  const [manualOpen, setManualOpen] = useState(false);
-  const [manualQuery, setManualQuery] = useState("");
-  const [manualSuggestions, setManualSuggestions] = useState([]);
-  const [manualCategories, setManualCategories] = useState([]);
-  const [manualIngredient, setManualIngredient] = useState(null);
-  const [manualCategoryId, setManualCategoryId] = useState("");
-  const [manualSaving, setManualSaving] = useState(false);
-  const isDiodGlobalMode = user?.globalRole === "diod" && !user?.activeHouseholdId;
-
-  const applyPayload = (data) => {
-    setStores(data.stores || []);
-    setPendingByCategory(data.pendingByCategory || []);
-    setPurchasedByStoreDay(data.purchasedByStoreDay || []);
-  };
-
-  const logShoppingApiError = (context, endpoint, err) => {
-    if (err instanceof ApiRequestError) {
-      console.error(`[shopping] ${context} failed`, {
-        endpoint,
-        status: err.status,
-        body: err.body,
-        message: err.message
-      });
-      return;
-    }
-    console.error(`[shopping] ${context} failed`, { endpoint, message: err?.message || err });
-  };
-
-  const loadList = async ({ silent = false } = {}) => {
-    if (isDiodGlobalMode) return;
-    if (!silent) setIsRefreshing(true);
-    setError("");
-    try {
-      const data = await apiRequest(`/api/kitchen/shopping/${weekStart}`);
-      applyPayload(data);
-    } catch (err) {
-      logShoppingApiError("loadList", `/api/kitchen/shopping/${weekStart}`, err);
-      setPendingByCategory(null);
-      setPurchasedByStoreDay(null);
-      setError(err.message || "No se pudo cargar la lista.");
-    } finally {
-      if (!silent) setIsRefreshing(false);
-    }
-  };
-
-  useEffect(() => {
-    void loadList();
-  }, [weekStart, isDiodGlobalMode]);
-
-  useEffect(() => {
-    if (!recentlyMovedItemKey) return undefined;
-    const timer = setTimeout(() => setRecentlyMovedItemKey(null), 650);
-    return () => clearTimeout(timer);
-  }, [recentlyMovedItemKey]);
-
-  useEffect(() => {
-    if (!manualOpen) return;
-    let active = true;
-    const loadBase = async () => {
-      try {
-        const [categoriesData, ingredientsData] = await Promise.all([
-          apiRequest("/api/categories"),
-          apiRequest("/api/kitchenIngredients?limit=30")
-        ]);
-        if (!active) return;
-        setManualCategories(categoriesData.categories || []);
-        setManualSuggestions(ingredientsData.ingredients || []);
-      } catch (err) {
-        if (!active) return;
-        setError(err.message || "No se pudo preparar el alta manual.");
-      }
-    };
-    void loadBase();
-    return () => {
-      active = false;
-    };
-  }, [manualOpen]);
-
-  useEffect(() => {
-    if (!manualOpen) return;
-    let active = true;
-    const timer = setTimeout(async () => {
-      try {
-        const data = await apiRequest(`/api/kitchenIngredients?q=${encodeURIComponent(manualQuery)}&limit=30`);
-        if (!active) return;
-        setManualSuggestions(data.ingredients || []);
-      } catch {
-        if (!active) return;
-        setManualSuggestions([]);
-      }
-    }, 200);
-    return () => {
-      active = false;
-      clearTimeout(timer);
-    };
-  }, [manualOpen, manualQuery]);
-
-  const refreshList = async () => {
-    if (isDiodGlobalMode) return;
-    setIsRefreshing(true);
-    try {
-      const data = await apiRequest(`/api/kitchen/shopping/${weekStart}/rebuild`, { method: "POST" });
-      applyPayload(data);
-      setSuccess("Lista reconstruida");
-    } catch (err) {
-      logShoppingApiError("refreshList", `/api/kitchen/shopping/${weekStart}/rebuild`, err);
-      setError(err.message || "No se pudo refrescar la lista.");
-    } finally {
-      setIsRefreshing(false);
-    }
-  };
-
-  const setItemStatus = async (item, status) => {
-    if (isDiodGlobalMode) return;
-    const key = itemKey(item);
-    setTransitioningItemKey(key);
-    try {
-      const data = await apiRequest(`/api/kitchen/shopping/${weekStart}/item`, {
-        method: "PUT",
-        body: JSON.stringify({
-          canonicalName: item.canonicalName,
-          ingredientId: item.ingredientId,
-          status,
-          storeId: status === "purchased" ? selectedStoreRef.current || null : null
-        })
-      });
-      applyPayload(data);
-      setRecentlyMovedItemKey(key);
-    } catch (err) {
-      logShoppingApiError("setItemStatus", `/api/kitchen/shopping/${weekStart}/item`, err);
-      setError(err.message || "No se pudo actualizar.");
-    } finally {
-      setTransitioningItemKey(null);
-    }
-  };
-
-  const updatePurchasedItemStore = async (item, storeId) => {
-    try {
-      const data = await apiRequest(`/api/kitchen/shopping/${weekStart}/item/store`, {
-        method: "PUT",
-        body: JSON.stringify({ canonicalName: item.canonicalName, ingredientId: item.ingredientId, storeId: storeId || null })
-      });
-      applyPayload(data);
-    } catch (err) {
-      logShoppingApiError("updatePurchasedItemStore", `/api/kitchen/shopping/${weekStart}/item/store`, err);
-      setError(err.message || "No se pudo cambiar el supermercado.");
-    }
-  };
-
-  const setAllItemsStatus = async (status) => {
-    try {
-      const data = await apiRequest(`/api/kitchen/shopping/${weekStart}/items/status`, {
-        method: "PUT",
-        body: JSON.stringify({
-          status,
-          storeId: status === "purchased" ? selectedStoreId || null : null
-        })
-      });
-      applyPayload(data);
-      if (status === "purchased") {
-        setSuccess(data.updated ? "Todo marcado como comprado" : "No había elementos pendientes.");
-      } else {
-        setSuccess(data.updated ? "Todo volvió a pendiente" : "No había elementos comprados.");
-      }
-    } catch (err) {
-      logShoppingApiError("setAllItemsStatus", `/api/kitchen/shopping/${weekStart}/items/status`, err);
-      setError(err.message || "No se pudo actualizar en bloque.");
-    }
-  };
-
-  const createManualIngredient = async () => {
-    if (!manualQuery.trim() || !manualCategoryId) return null;
-    const data = await apiRequest("/api/kitchenIngredients", {
-      method: "POST",
-      body: JSON.stringify({
-        name: manualQuery.trim(),
-        categoryId: manualCategoryId,
-        scope: "household",
-        householdId: user?.activeHouseholdId || null
-      })
-    });
-    return data.ingredient || null;
-  };
-
-  const submitManualItem = async () => {
-    if (manualSaving) return;
-    setManualSaving(true);
-    setError("");
-    try {
-      let ingredient = manualIngredient;
-      if (!ingredient) {
-        ingredient = await createManualIngredient();
-      }
-      if (!ingredient?._id || !manualCategoryId) {
-        throw new Error("Selecciona ingrediente y categoría.");
-      }
-      const data = await apiRequest(`/api/kitchen/shopping/${weekStart}/items/manual`, {
-        method: "POST",
-        body: JSON.stringify({ ingredientId: ingredient._id, categoryId: manualCategoryId })
-      });
-      applyPayload(data);
-      setManualOpen(false);
-      setManualQuery("");
-      setManualIngredient(null);
-      setManualCategoryId("");
-      setSuccess("Item añadido a la lista.");
-    } catch (err) {
-      setError(err.message || "No se pudo añadir el item manual.");
-    } finally {
-      setManualSaving(false);
-    }
-  };
-
-  const createStoreFromDropdown = async () => {
-    const name = window.prompt("Nombre del supermercado");
-    if (!name || !name.trim()) return;
-    setError("");
-    try {
-      await apiRequest("/api/kitchen/shopping/stores", {
-        method: "POST",
-        body: JSON.stringify({ name: name.trim() })
-      });
-      await loadList({ silent: true });
-    } catch (err) {
-      logShoppingApiError("createStoreFromDropdown", "/api/kitchen/shopping/stores", err);
-      setError(err.message || "No se pudo crear el supermercado.");
-    }
-  };
-
-  const pendingCount = useMemo(() => {
-    if (!Array.isArray(pendingByCategory)) return null;
-    return pendingByCategory.reduce((acc, group) => acc + (group.items?.length || 0), 0);
-  }, [pendingByCategory]);
-
-  const purchasedCount = useMemo(() => {
-    if (!Array.isArray(purchasedByStoreDay)) return null;
-    return purchasedByStoreDay.reduce((acc, group) => acc + (group.items?.length || 0), 0);
-  }, [purchasedByStoreDay]);
-
-  if (isDiodGlobalMode) {
-    return (
-      <KitchenLayout>
-        <div className="kitchen-card">Selecciona un hogar activo para ver su lista de la compra.</div>
-      </KitchenLayout>
-    );
-  }
-
-  return (
-    <KitchenLayout>
-      <div className="shopping-page-shell">
-        <div className="kitchen-card shopping-main-card">
-          <div className="shopping-header-card">
-            <div className="shopping-header-row">
-              <div>
-                <h1>Lista de la compra · Semana {formatWeekTitle(weekStart)}</h1>
-              </div>
-              <div className="kitchen-actions">
-                <button className="kitchen-button" type="button" onClick={() => setManualOpen(true)}>+ Añadir</button>
-                <button className="shopping-refresh-icon" type="button" onClick={refreshList} disabled={isRefreshing} aria-label="Reconstruir lista" title="Reconstruir lista">
-                <RefreshIcon className="shopping-week-arrow-icon" />
-              </button>
-              </div>
-            </div>
-
-            <WeekNavigator
-              className="shopping-week-nav"
-              value={weekStart}
-              onChange={(nextValue) => setWeekStart(normalizeWeekStartInput(nextValue))}
-              onPrevious={() => setWeekStart((prev) => addDaysToISO(prev, -7))}
-              onNext={() => setWeekStart((prev) => addDaysToISO(prev, 7))}
-            />
-
-          </div>
-
-          <div className="kitchen-dishes-tabs" role="tablist" aria-label="Estado de la compra">
-            <button className={`kitchen-tab-button ${tab === "pending" ? "is-active" : ""}`} onClick={() => setTab("pending")}>Pendiente ({pendingCount === null ? "—" : pendingCount})</button>
-            <button className={`kitchen-tab-button ${tab === "purchased" ? "is-active" : ""}`} onClick={() => setTab("purchased")}>Comprado</button>
-          </div>
-
-          {tab === "pending" ? (
-            <div className="shopping-toolbar">
-              <select
-                className="kitchen-select shopping-store-select"
-                value={selectedStoreId}
-                onChange={(event) => {
-                  const value = event.target.value;
-                  if (value === "__add__") {
-                    void createStoreFromDropdown();
-                    return;
-                  }
-                  selectedStoreRef.current = value;
-                  setSelectedStoreId(value);
-                }}
-              >
-                <option value="">Supermercado (opcional)</option>
-                {stores.map((store) => (
-                  <option key={store._id} value={store._id}>{store.name}</option>
-                ))}
-                <option value="__add__">Añadir supermercado…</option>
-              </select>
-            </div>
-          ) : null}
-
-          {(success || error) ? (
-            <div className="shopping-toolbar-alerts" aria-live="polite">
-              {success ? <div className="kitchen-alert success shopping-toolbar-alert">{success}</div> : null}
-              {error ? <div className="kitchen-alert error shopping-toolbar-alert">{error}</div> : null}
-            </div>
-          ) : null}
-
-          {tab === "pending" ? (
-            <div className="shopping-categories">
-              <div className="shopping-bulk-actions">
-                <button className="kitchen-button ghost shopping-bulk-button" type="button" onClick={() => setAllItemsStatus("purchased")}>Marcar todo como comprado</button>
-              </div>
-              {!Array.isArray(pendingByCategory) ? (
-                <div className="shopping-empty-state"><EmptyStateIcon /><h4>No se pudo cargar la lista.</h4></div>
-              ) : pendingByCategory.length === 0 ? (
-                <div className="shopping-empty-state">
-                  {purchasedCount ? <EmptyCheckIcon /> : <EmptyListIcon />}
-                  <h4>{purchasedCount ? "Todo comprado por esta semana." : "No hay nada por comprar todavía."}</h4>
-                </div>
-              ) : pendingByCategory.map((group) => {
-              const category = { name: group.categoryInfo?.name || "Sin categoría", ...slugColor(group.categoryInfo?.slug), ...group.categoryInfo };
-              return (
-                <div className="shopping-category-card" key={group.categoryId || group.categoryInfo?.slug || group.categoryInfo?.name} style={{ "--category-bg": category.colorBg, "--category-text": category.colorText }}>
-                  <div className="shopping-category-head"><h4>{category.name.toUpperCase()}</h4><span className="shopping-category-count">{group.items.length} items</span></div>
-                  <div className="shopping-items-list">
-                    {group.items.map((item) => {
-                      const key = itemKey(item);
-                      return (
-                        <div className={`shopping-item ${transitioningItemKey === key ? "is-leaving" : ""}`} key={key}>
-                          <button className="shopping-check" type="button" onClick={() => setItemStatus(item, "purchased")}><span className="shopping-check-dot">✓</span></button>
-                          <span className="shopping-item-text">{item.displayName}</span>
-                          {item.occurrences > 1 ? <span className="shopping-item-amount">x{item.occurrences}</span> : null}
-                        </div>
-                      );
-                    })}
-                  </div>
-                </div>
-              );
-              })}
-            </div>
-          ) : (
-            <div className="shopping-categories">
-              <div className="shopping-bulk-actions">
-                <button
-                  className="kitchen-button ghost shopping-bulk-button"
-                  type="button"
-                  onClick={() => {
-                    if (window.confirm("¿Desmarcar todo lo comprado de esta semana?")) {
-                      void setAllItemsStatus("pending");
-                    }
-                  }}
-                >
-                  Desmarcar todo
-                </button>
-              </div>
-              {!Array.isArray(purchasedByStoreDay) ? (
-                <div className="shopping-empty-state"><EmptyStateIcon /><h4>No se pudo cargar la lista.</h4></div>
-              ) : purchasedByStoreDay.length === 0 ? (
-                <div className="shopping-empty-state"><EmptyHistoryIcon /><h4>No hay nada comprado esta semana.</h4></div>
-              ) : purchasedByStoreDay.map((group) => (
-              <div className="shopping-category-card shopping-purchased-card" key={`${group.purchasedDate}-${group.storeId || "none"}`}>
-                <h4>Comprado por <span>{group.purchasedByName || "Usuario"}</span> · <em>{group.storeName || "Sin supermercado"}</em> · {formatTripDate(group.purchasedDate)}</h4>
-                <div className="shopping-items-list shopping-items-list-purchased">
-                  {group.items.map((item) => {
-                    const key = itemKey(item);
-                    return (
-                      <div className={`shopping-item purchased ${transitioningItemKey === key ? "is-leaving" : ""} ${recentlyMovedItemKey === key ? "is-entering" : ""}`} key={key}>
-                        <button className="shopping-check is-checked" type="button" onClick={() => setItemStatus(item, "pending")}><span className="shopping-check-dot">✓</span></button>
-                        <span className="shopping-item-text">{item.displayName}</span>
-                        {item.occurrences > 1 ? <span className="shopping-item-amount">x{item.occurrences}</span> : null}
-                        <select className="kitchen-select shopping-store-select-compact" value={item.storeId || ""} onChange={(event) => updatePurchasedItemStore(item, event.target.value)}>
-                          <option value="">Sin supermercado</option>
-                          {stores.map((store) => (
-                            <option key={store._id} value={store._id}>{store.name}</option>
-                          ))}
-                        </select>
-                      </div>
-                    );
-                  })}
-                </div>
-              </div>
-            ))}
-            </div>
-          )}
-        </div>
-      </div>
-      {manualOpen ? (
-        <div className="kitchen-modal-backdrop" role="presentation" onClick={() => setManualOpen(false)}>
-          <div className="kitchen-modal" role="dialog" aria-modal="true" aria-label="Añadir item manual" onClick={(event) => event.stopPropagation()}>
-            <div className="kitchen-modal-header"><h3>Añadir item manual</h3></div>
-            <div className="kitchen-form">
-              <label className="kitchen-field">
-                <span className="kitchen-label">Ingrediente</span>
-                <input className="kitchen-input" value={manualQuery} onChange={(event) => { setManualQuery(event.target.value); setManualIngredient(null); }} placeholder="Buscar ingrediente..." />
-              </label>
-              <div className="kitchen-suggestion-list">
-                {(manualSuggestions || []).slice(0, 8).map((item) => (
-                  <button key={item._id} type="button" className="kitchen-suggestion" onClick={() => { setManualIngredient(item); setManualQuery(item.name || ""); setManualCategoryId(item.categoryId?._id || ""); }}>
-                    <span className="kitchen-suggestion-name">{item.name}</span>
-                  </button>
-                ))}
-              </div>
-              <label className="kitchen-field">
-                <span className="kitchen-label">Categoría</span>
-                <select className="kitchen-select" value={manualCategoryId} onChange={(event) => setManualCategoryId(event.target.value)}>
-                  <option value="">Selecciona categoría</option>
-                  {manualCategories.map((category) => (
-                    <option key={category._id} value={category._id}>{category.name}</option>
-                  ))}
-                </select>
-              </label>
-              {!manualIngredient && manualQuery.trim() && !manualSuggestions.some((item) => normalizeQuery(item.name) === normalizeQuery(manualQuery)) ? (
-                <div className="kitchen-muted">Se creará “{manualQuery.trim()}” en el hogar actual.</div>
-              ) : null}
-              <div className="kitchen-modal-actions">
-                <button className="kitchen-button" type="button" onClick={submitManualItem} disabled={manualSaving}>{manualSaving ? "Guardando..." : "Añadir"}</button>
-                <button className="kitchen-button ghost" type="button" onClick={() => setManualOpen(false)}>Cancelar</button>
-              </div>
-            </div>
-          </div>
-        </div>
-      ) : null}
-    </KitchenLayout>
-  );
-}
+import React, { useEffect, useMemo, useRef, useState } from "react";
+import KitchenLayout from "../Layout.jsx";
+import { ApiRequestError, apiRequest } from "../api.js";
+import { useAuth } from "../auth";
+import { useActiveWeek } from "../weekContext.jsx";
+import WeekNavigator from "../components/ui/WeekNavigator.jsx";
+
+function RefreshIcon(props) {
+  return (
+    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" {...props}>
+      <path d="M20 12a8 8 0 1 1-2.343-5.657" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round"/>
+      <path d="M20 4v4h-4" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round"/>
+    </svg>
+  );
+}
+
+function MinusIcon(props) {
+  return (
+    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" {...props}>
+      <path d="M6 12h12" stroke="currentColor" strokeWidth="2" strokeLinecap="round" />
+    </svg>
+  );
+}
+
+function EmptyStateIcon(props) {
+  return (
+    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" {...props}>
+      <path d="M4 7.5h16" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" />
+      <path d="M6.5 7.5V6a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v1.5" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" />
+      <path d="M7.5 10.5h9l-.75 7.1a2 2 0 0 1-1.99 1.8H10.24a2 2 0 0 1-1.99-1.8z" stroke="currentColor" strokeWidth="1.8" strokeLinejoin="round" />
+    </svg>
+  );
+}
+
+function EmptyCheckIcon(props) {
+  return (
+    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" {...props}>
+      <path d="M7 12.5 10.5 16 17.5 9" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" />
+      <path d="M12 21a9 9 0 1 0-9-9" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" />
+    </svg>
+  );
+}
+
+function EmptyListIcon(props) {
+  return (
+    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" {...props}>
+      <path d="M8 7h10M8 12h10M8 17h10" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" />
+      <circle cx="5" cy="7" r="1" fill="currentColor" />
+      <circle cx="5" cy="12" r="1" fill="currentColor" />
+      <circle cx="5" cy="17" r="1" fill="currentColor" />
+    </svg>
+  );
+}
+
+function EmptyHistoryIcon(props) {
+  return (
+    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" {...props}>
+      <path d="M12 7.5v5l3 1.8" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" />
+      <path d="M3.8 12a8.2 8.2 0 1 0 2.4-5.8" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" />
+      <path d="M3.5 5.7v2.9h2.9" stroke="currentColor" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" />
+    </svg>
+  );
+}
+
+function addDaysToISO(iso, days) {
+  const date = new Date(`${iso}T00:00:00Z`);
+  date.setUTCDate(date.getUTCDate() + days);
+  return date.toISOString().slice(0, 10);
+}
+
+function normalizeWeekStartInput(value) {
+  if (!value) return "";
+  const d = new Date(`${value}T00:00:00Z`);
+  const day = d.getUTCDay();
+  const diff = (day === 0 ? -6 : 1) - day;
+  d.setUTCDate(d.getUTCDate() + diff);
+  return d.toISOString().slice(0, 10);
+}
+
+function formatWeekTitle(iso) {
+  if (!iso) return "";
+  return new Date(`${iso}T00:00:00Z`).toLocaleDateString("es-ES", {
+    day: "2-digit",
+    month: "2-digit",
+    year: "numeric"
+  });
+}
+
+function formatTripDate(value) {
+  if (!value || value === "sin-fecha") return "Sin fecha";
+  return new Date(`${value}T00:00:00Z`).toLocaleDateString("es-ES", { day: "2-digit", month: "2-digit", year: "numeric" });
+}
+
+function slugColor(slug = "") {
+  const normalized = String(slug || "otros");
+  const seed = normalized.split("").reduce((acc, char) => acc + char.charCodeAt(0), 0);
+  const hue = seed % 360;
+  return {
+    colorBg: `hsl(${hue} 70% 95%)`,
+    colorText: `hsl(${hue} 55% 35%)`
+  };
+}
+
+function itemKey(item) {
+  return item.itemId || `${item.ingredientId || "no-id"}-${item.canonicalName}`;
+}
+
+function normalizeQuery(value = "") {
+  return String(value).trim().toLowerCase();
+}
+
+export default function ShoppingPage() {
+  const { user } = useAuth();
+  const { activeWeek: weekStart, setActiveWeek: setWeekStart } = useActiveWeek();
+  const [tab, setTab] = useState("pending");
+  const [error, setError] = useState("");
+  const [success, setSuccess] = useState("");
+  const [isRefreshing, setIsRefreshing] = useState(false);
+  const [stores, setStores] = useState([]);
+  const [selectedStoreId, setSelectedStoreId] = useState("");
+  const selectedStoreRef = useRef("");
+  const [pendingByCategory, setPendingByCategory] = useState(null);
+  const [purchasedByStoreDay, setPurchasedByStoreDay] = useState(null);
+  const [transitioningItemKey, setTransitioningItemKey] = useState(null);
+  const [recentlyMovedItemKey, setRecentlyMovedItemKey] = useState(null);
+  const [quickQuery, setQuickQuery] = useState("");
+  const [quickSuggestions, setQuickSuggestions] = useState([]);
+  const [quickCategories, setQuickCategories] = useState([]);
+  const [quickCategoryId, setQuickCategoryId] = useState("");
+  const [quickBusy, setQuickBusy] = useState(false);
+  const [quickSearching, setQuickSearching] = useState(false);
+  const quickInputRef = useRef(null);
+  const isDiodGlobalMode = user?.globalRole === "diod" && !user?.activeHouseholdId;
+
+  const applyPayload = (data) => {
+    setStores(data.stores || []);
+    setPendingByCategory(data.pendingByCategory || []);
+    setPurchasedByStoreDay(data.purchasedByStoreDay || []);
+  };
+
+  const logShoppingApiError = (context, endpoint, err) => {
+    if (err instanceof ApiRequestError) {
+      console.error(`[shopping] ${context} failed`, {
+        endpoint,
+        status: err.status,
+        body: err.body,
+        message: err.message
+      });
+      return;
+    }
+    console.error(`[shopping] ${context} failed`, { endpoint, message: err?.message || err });
+  };
+
+  const loadList = async ({ silent = false } = {}) => {
+    if (isDiodGlobalMode) return;
+    if (!silent) setIsRefreshing(true);
+    setError("");
+    try {
+      const data = await apiRequest(`/api/kitchen/shopping/${weekStart}`);
+      applyPayload(data);
+    } catch (err) {
+      logShoppingApiError("loadList", `/api/kitchen/shopping/${weekStart}`, err);
+      setPendingByCategory(null);
+      setPurchasedByStoreDay(null);
+      setError(err.message || "No se pudo cargar la lista.");
+    } finally {
+      if (!silent) setIsRefreshing(false);
+    }
+  };
+
+  useEffect(() => {
+    void loadList();
+  }, [weekStart, isDiodGlobalMode]);
+
+  useEffect(() => {
+    if (!recentlyMovedItemKey) return undefined;
+    const timer = setTimeout(() => setRecentlyMovedItemKey(null), 650);
+    return () => clearTimeout(timer);
+  }, [recentlyMovedItemKey]);
+
+  useEffect(() => {
+    let active = true;
+    const loadCategories = async () => {
+      try {
+        const categoriesData = await apiRequest("/api/categories");
+        if (!active) return;
+        setQuickCategories(categoriesData.categories || []);
+      } catch {
+        if (!active) return;
+        setQuickCategories([]);
+      }
+    };
+    void loadCategories();
+    return () => {
+      active = false;
+    };
+  }, []);
+
+  useEffect(() => {
+    if (!quickQuery.trim()) {
+      setQuickSuggestions([]);
+      return;
+    }
+    let active = true;
+    setQuickSearching(true);
+    const timer = setTimeout(async () => {
+      try {
+        const data = await apiRequest(`/api/kitchenIngredients?q=${encodeURIComponent(quickQuery)}&limit=20`);
+        if (!active) return;
+        setQuickSuggestions(data.ingredients || []);
+      } catch {
+        if (!active) return;
+        setQuickSuggestions([]);
+      } finally {
+        if (active) setQuickSearching(false);
+      }
+    }, 200);
+    return () => {
+      active = false;
+      clearTimeout(timer);
+    };
+  }, [quickQuery]);
+
+  const refreshList = async () => {
+    if (isDiodGlobalMode) return;
+    setIsRefreshing(true);
+    try {
+      const data = await apiRequest(`/api/kitchen/shopping/${weekStart}/rebuild`, { method: "POST" });
+      applyPayload(data);
+      setSuccess("Lista reconstruida");
+    } catch (err) {
+      logShoppingApiError("refreshList", `/api/kitchen/shopping/${weekStart}/rebuild`, err);
+      setError(err.message || "No se pudo refrescar la lista.");
+    } finally {
+      setIsRefreshing(false);
+    }
+  };
+
+  const addIngredientToList = async (ingredientId, categoryId) => {
+    const data = await apiRequest(`/api/kitchen/shopping/${weekStart}/items`, {
+      method: "POST",
+      body: JSON.stringify({ ingredientId, categoryId: categoryId || null, storeId: selectedStoreRef.current || null })
+    });
+    applyPayload(data);
+  };
+
+  const createHouseholdIngredient = async (name, categoryId) => {
+    const data = await apiRequest("/api/kitchenIngredients", {
+      method: "POST",
+      body: JSON.stringify({
+        name: name.trim(),
+        categoryId,
+        scope: "household",
+        householdId: user?.activeHouseholdId || null
+      })
+    });
+    return data.ingredient || null;
+  };
+
+  const handleQuickSelect = async (ingredient) => {
+    if (!ingredient?._id || quickBusy) return;
+    setQuickBusy(true);
+    setError("");
+    try {
+      await addIngredientToList(ingredient._id, ingredient.categoryId?._id || ingredient.categoryId || quickCategoryId || null);
+      setQuickQuery("");
+      setQuickSuggestions([]);
+      setQuickCategoryId("");
+      quickInputRef.current?.focus();
+    } catch (err) {
+      setError(err.message || "No se pudo añadir el ingrediente a la lista.");
+    } finally {
+      setQuickBusy(false);
+    }
+  };
+
+  const handleQuickCreate = async () => {
+    if (!quickQuery.trim() || !quickCategoryId || quickBusy) return;
+    setQuickBusy(true);
+    setError("");
+    try {
+      const ingredient = await createHouseholdIngredient(quickQuery, quickCategoryId);
+      if (!ingredient?._id) throw new Error("No se pudo crear el ingrediente.");
+      await addIngredientToList(ingredient._id, quickCategoryId);
+      setQuickQuery("");
+      setQuickSuggestions([]);
+      setQuickCategoryId("");
+      quickInputRef.current?.focus();
+      setSuccess(`Creado y añadido: ${ingredient.name}`);
+    } catch (err) {
+      setError(err.message || "No se pudo crear y añadir el ingrediente.");
+    } finally {
+      setQuickBusy(false);
+    }
+  };
+
+  const removeItem = async (item) => {
+    if (!item?.itemId) {
+      setError("No se pudo eliminar: falta identificador del item.");
+      return;
+    }
+    try {
+      const data = await apiRequest(`/api/kitchen/shopping/${weekStart}/items/${item.itemId}`, { method: "DELETE" });
+      applyPayload(data);
+    } catch (err) {
+      setError(err.message || "No se pudo eliminar el item.");
+    }
+  };
+
+  const setItemStatus = async (item, status) => {
+    if (isDiodGlobalMode) return;
+    const key = itemKey(item);
+    setTransitioningItemKey(key);
+    try {
+      const data = await apiRequest(`/api/kitchen/shopping/${weekStart}/item`, {
+        method: "PUT",
+        body: JSON.stringify({
+          canonicalName: item.canonicalName,
+          ingredientId: item.ingredientId,
+          status,
+          storeId: status === "purchased" ? selectedStoreRef.current || null : null
+        })
+      });
+      applyPayload(data);
+      setRecentlyMovedItemKey(key);
+    } catch (err) {
+      logShoppingApiError("setItemStatus", `/api/kitchen/shopping/${weekStart}/item`, err);
+      setError(err.message || "No se pudo actualizar.");
+    } finally {
+      setTransitioningItemKey(null);
+    }
+  };
+
+  const updatePurchasedItemStore = async (item, storeId) => {
+    try {
+      const data = await apiRequest(`/api/kitchen/shopping/${weekStart}/item/store`, {
+        method: "PUT",
+        body: JSON.stringify({ canonicalName: item.canonicalName, ingredientId: item.ingredientId, storeId: storeId || null })
+      });
+      applyPayload(data);
+    } catch (err) {
+      logShoppingApiError("updatePurchasedItemStore", `/api/kitchen/shopping/${weekStart}/item/store`, err);
+      setError(err.message || "No se pudo cambiar el supermercado.");
+    }
+  };
+
+  const setAllItemsStatus = async (status) => {
+    try {
+      const data = await apiRequest(`/api/kitchen/shopping/${weekStart}/items/status`, {
+        method: "PUT",
+        body: JSON.stringify({
+          status,
+          storeId: status === "purchased" ? selectedStoreId || null : null
+        })
+      });
+      applyPayload(data);
+      if (status === "purchased") {
+        setSuccess(data.updated ? "Todo marcado como comprado" : "No había elementos pendientes.");
+      } else {
+        setSuccess(data.updated ? "Todo volvió a pendiente" : "No había elementos comprados.");
+      }
+    } catch (err) {
+      logShoppingApiError("setAllItemsStatus", `/api/kitchen/shopping/${weekStart}/items/status`, err);
+      setError(err.message || "No se pudo actualizar en bloque.");
+    }
+  };
+
+  const createStoreFromDropdown = async () => {
+    const name = window.prompt("Nombre del supermercado");
+    if (!name || !name.trim()) return;
+    setError("");
+    try {
+      await apiRequest("/api/kitchen/shopping/stores", {
+        method: "POST",
+        body: JSON.stringify({ name: name.trim() })
+      });
+      await loadList({ silent: true });
+    } catch (err) {
+      logShoppingApiError("createStoreFromDropdown", "/api/kitchen/shopping/stores", err);
+      setError(err.message || "No se pudo crear el supermercado.");
+    }
+  };
+
+  const pendingCount = useMemo(() => {
+    if (!Array.isArray(pendingByCategory)) return null;
+    return pendingByCategory.reduce((acc, group) => acc + (group.items?.length || 0), 0);
+  }, [pendingByCategory]);
+
+  const purchasedCount = useMemo(() => {
+    if (!Array.isArray(purchasedByStoreDay)) return null;
+    return purchasedByStoreDay.reduce((acc, group) => acc + (group.items?.length || 0), 0);
+  }, [purchasedByStoreDay]);
+
+  const hasExactSuggestion = quickSuggestions.some((item) => normalizeQuery(item.name) === normalizeQuery(quickQuery));
+
+  if (isDiodGlobalMode) {
+    return (
+      <KitchenLayout>
+        <div className="kitchen-card">Selecciona un hogar activo para ver su lista de la compra.</div>
+      </KitchenLayout>
+    );
+  }
+
+  return (
+    <KitchenLayout>
+      <div className="shopping-page-shell">
+        <div className="kitchen-card shopping-main-card">
+          <div className="shopping-header-card">
+            <div className="shopping-header-row">
+              <div>
+                <h1>Lista de la compra · Semana {formatWeekTitle(weekStart)}</h1>
+              </div>
+              <div className="kitchen-actions">
+                <button className="shopping-refresh-icon" type="button" onClick={refreshList} disabled={isRefreshing} aria-label="Reconstruir lista" title="Reconstruir lista">
+                  <RefreshIcon className="shopping-week-arrow-icon" />
+                </button>
+              </div>
+            </div>
+
+            <WeekNavigator
+              className="shopping-week-nav"
+              value={weekStart}
+              onChange={(nextValue) => setWeekStart(normalizeWeekStartInput(nextValue))}
+              onPrevious={() => setWeekStart((prev) => addDaysToISO(prev, -7))}
+              onNext={() => setWeekStart((prev) => addDaysToISO(prev, 7))}
+            />
+
+          </div>
+
+          <div className="kitchen-dishes-tabs" role="tablist" aria-label="Estado de la compra">
+            <button className={`kitchen-tab-button ${tab === "pending" ? "is-active" : ""}`} onClick={() => setTab("pending")}>Pendiente ({pendingCount === null ? "—" : pendingCount})</button>
+            <button className={`kitchen-tab-button ${tab === "purchased" ? "is-active" : ""}`} onClick={() => setTab("purchased")}>Comprado</button>
+          </div>
+
+          {tab === "pending" ? (
+            <div className="shopping-toolbar">
+              <select
+                className="kitchen-select shopping-store-select"
+                value={selectedStoreId}
+                onChange={(event) => {
+                  const value = event.target.value;
+                  if (value === "__add__") {
+                    void createStoreFromDropdown();
+                    return;
+                  }
+                  selectedStoreRef.current = value;
+                  setSelectedStoreId(value);
+                }}
+              >
+                <option value="">Supermercado (opcional)</option>
+                {stores.map((store) => (
+                  <option key={store._id} value={store._id}>{store.name}</option>
+                ))}
+                <option value="__add__">Añadir supermercado…</option>
+              </select>
+            </div>
+          ) : null}
+
+          {(success || error) ? (
+            <div className="shopping-toolbar-alerts" aria-live="polite">
+              {success ? <div className="kitchen-alert success shopping-toolbar-alert">{success}</div> : null}
+              {error ? <div className="kitchen-alert error shopping-toolbar-alert">{error}</div> : null}
+            </div>
+          ) : null}
+
+          {tab === "pending" ? (
+            <div className="shopping-categories">
+              <div className="shopping-quick-add" role="region" aria-label="Añadir ingrediente rápido">
+                <div className="shopping-quick-add-row">
+                  <input
+                    ref={quickInputRef}
+                    className="kitchen-input shopping-quick-add-input"
+                    value={quickQuery}
+                    onChange={(event) => setQuickQuery(event.target.value)}
+                    placeholder="Añadir ingrediente a la lista..."
+                  />
+                  {!hasExactSuggestion && quickQuery.trim() ? (
+                    <select className="kitchen-select shopping-quick-category" value={quickCategoryId} onChange={(event) => setQuickCategoryId(event.target.value)}>
+                      <option value="">Categoría</option>
+                      {quickCategories.map((category) => (
+                        <option key={category._id} value={category._id}>{category.name}</option>
+                      ))}
+                    </select>
+                  ) : null}
+                </div>
+                {quickQuery ? (
+                  <div className="shopping-quick-suggestions">
+                    {quickSearching ? <div className="kitchen-muted">Buscando...</div> : null}
+                    {!quickSearching ? quickSuggestions.slice(0, 8).map((item) => (
+                      <button key={item._id} type="button" className="kitchen-suggestion" onClick={() => handleQuickSelect(item)} disabled={quickBusy}>
+                        <span className="kitchen-suggestion-name">{item.name}</span>
+                      </button>
+                    )) : null}
+                    {!quickSearching && !hasExactSuggestion && quickQuery.trim() ? (
+                      <button className="kitchen-button ghost shopping-quick-create" type="button" onClick={handleQuickCreate} disabled={!quickCategoryId || quickBusy}>
+                        Crear “{quickQuery.trim()}”
+                      </button>
+                    ) : null}
+                  </div>
+                ) : null}
+              </div>
+
+              <div className="shopping-bulk-actions">
+                <button className="kitchen-button ghost shopping-bulk-button" type="button" onClick={() => setAllItemsStatus("purchased")}>Marcar todo como comprado</button>
+              </div>
+              {!Array.isArray(pendingByCategory) ? (
+                <div className="shopping-empty-state"><EmptyStateIcon /><h4>No se pudo cargar la lista.</h4></div>
+              ) : pendingByCategory.length === 0 ? (
+                <div className="shopping-empty-state">
+                  {purchasedCount ? <EmptyCheckIcon /> : <EmptyListIcon />}
+                  <h4>{purchasedCount ? "Todo comprado por esta semana." : "No hay nada por comprar todavía."}</h4>
+                </div>
+              ) : pendingByCategory.map((group) => {
+                const category = { name: group.categoryInfo?.name || "Sin categoría", ...slugColor(group.categoryInfo?.slug), ...group.categoryInfo };
+                return (
+                  <div className="shopping-category-card" key={group.categoryId || group.categoryInfo?.slug || group.categoryInfo?.name} style={{ "--category-bg": category.colorBg, "--category-text": category.colorText }}>
+                    <div className="shopping-category-head"><h4>{category.name.toUpperCase()}</h4><span className="shopping-category-count">{group.items.length} items</span></div>
+                    <div className="shopping-items-list">
+                      {group.items.map((item) => {
+                        const key = itemKey(item);
+                        return (
+                          <div className={`shopping-item ${transitioningItemKey === key ? "is-leaving" : ""}`} key={key}>
+                            <button className="shopping-check" type="button" onClick={() => setItemStatus(item, "purchased")}><span className="shopping-check-dot">✓</span></button>
+                            <span className="shopping-item-text">{item.displayName}</span>
+                            {item.occurrences > 1 ? <span className="shopping-item-amount">x{item.occurrences}</span> : null}
+                            <button className="shopping-remove-item" type="button" onClick={() => removeItem(item)} aria-label={`Eliminar ${item.displayName}`} title="Eliminar">
+                              <MinusIcon />
+                            </button>
+                          </div>
+                        );
+                      })}
+                    </div>
+                  </div>
+                );
+              })}
+            </div>
+          ) : (
+            <div className="shopping-categories">
+              <div className="shopping-bulk-actions">
+                <button
+                  className="kitchen-button ghost shopping-bulk-button"
+                  type="button"
+                  onClick={() => {
+                    if (window.confirm("¿Desmarcar todo lo comprado de esta semana?")) {
+                      void setAllItemsStatus("pending");
+                    }
+                  }}
+                >
+                  Desmarcar todo
+                </button>
+              </div>
+              {!Array.isArray(purchasedByStoreDay) ? (
+                <div className="shopping-empty-state"><EmptyStateIcon /><h4>No se pudo cargar la lista.</h4></div>
+              ) : purchasedByStoreDay.length === 0 ? (
+                <div className="shopping-empty-state"><EmptyHistoryIcon /><h4>No hay nada comprado esta semana.</h4></div>
+              ) : purchasedByStoreDay.map((group) => (
+                <div className="shopping-category-card shopping-purchased-card" key={`${group.purchasedDate}-${group.storeId || "none"}`}>
+                  <h4>Comprado por <span>{group.purchasedByName || "Usuario"}</span> · <em>{group.storeName || "Sin supermercado"}</em> · {formatTripDate(group.purchasedDate)}</h4>
+                  <div className="shopping-items-list shopping-items-list-purchased">
+                    {group.items.map((item) => {
+                      const key = itemKey(item);
+                      return (
+                        <div className={`shopping-item purchased ${transitioningItemKey === key ? "is-leaving" : ""} ${recentlyMovedItemKey === key ? "is-entering" : ""}`} key={key}>
+                          <button className="shopping-check is-checked" type="button" onClick={() => setItemStatus(item, "pending")}><span className="shopping-check-dot">✓</span></button>
+                          <span className="shopping-item-text">{item.displayName}</span>
+                          {item.occurrences > 1 ? <span className="shopping-item-amount">x{item.occurrences}</span> : null}
+                          <select className="kitchen-select shopping-store-select-compact" value={item.storeId || ""} onChange={(event) => updatePurchasedItemStore(item, event.target.value)}>
+                            <option value="">Sin supermercado</option>
+                            {stores.map((store) => (
+                              <option key={store._id} value={store._id}>{store.name}</option>
+                            ))}
+                          </select>
+                          <button className="shopping-remove-item" type="button" onClick={() => removeItem(item)} aria-label={`Eliminar ${item.displayName}`} title="Eliminar">
+                            <MinusIcon />
+                          </button>
+                        </div>
+                      );
+                    })}
+                  </div>
+                </div>
+              ))}
+            </div>
+          )}
+        </div>
+      </div>
+    </KitchenLayout>
+  );
+}
